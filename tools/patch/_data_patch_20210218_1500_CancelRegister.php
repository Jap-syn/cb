<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20210218_1500_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK50383431',
'AK50369122',
'AK50402393',
'AK50370793',
'AK50370794',
'AK50394835',
'AK50383736',
'AK50338276',
'AK50344837',
'AK50390997',
'AK50369618',
'AK50368430',
'AK50368751',
'AK50359732',
'AK50368972',
'AK50355498',
'AK50360039',
'AK50358199',
'AK50338128',
'AK50397611',
'AK50398222',
'AK50366642',
'AK50365472',
'AK50363575',
'AK50399566',
'AK50397237',
'AK50367247',
'AK50398938',
'AK50342640',
'AK50371434',
'AK50352075',
'AK50418486',
'AK50344396',
'AK50373107',
'AK50340818',
'AK50343668',
'AK50343190',
'AK50342708',
'AK50347691',
'AK50345484',
'AK50338255',
'AK50381975',
'AK50407263',
'AK50373481',
'AK50391504',
'AK50396677',
'AK50338678',
'AK50434196',
'AK50432184',
'AK50431909',
'AK50405076',
'AK50369085',
'AK50400343',
'AK50389382',
'AK50362198',
'AK50342277',
'AK50386141',
'AK50432049',
'AK50429674',
'AK50343340',
'AK50370108',
'AK50337291',
'AK50342458',
'AK50401557',
'AK50366987',
'AK50435139',
'AK50373656',
'AK50353617',
'AK50356301',
'AK50364161',
'AK50340120',
'AK49635315',
'AK50365656',
'AK50388272',
'AK49619361',
'AK50361679',
'AK49604440',
'AK50354854',
'AK50351344',
'AK50435025',
'AK50368574',
'AK50374968',
'AK50342498',
'AK50444277',
'AK50341329',
'AK50382075',
'AK50405354',
'AK50357667',
'AK50354743',
'AK50358778',
'AK50370701',
'AK50434416',
'AK50353623',
'AK50371319',
'AK50352979',
'AK50341830',
'AK50398812',
'AK50434177',
'AK50397576',
'AK50430771',
'AK50367140',
'AK50365847',
'AK50446529',
'AK50446975',
'AK50393648',
'AK50365875',
'AK50346442',
'AK50355925',
'AK50427538',
'AK50390953',
'AK50432325',
'AK50391270',
'AK50429177',
'AK50366440',
'AK50363223',
'AK50396185',
'AK50431641',
'AK50969694',
'AK50391227',
'AK50344518',
'AK50407061',
'AK50383944',
'AK50399823',
'AK50338981',
'AK50391767',
'AK50448401',
'AK50366443',
'AK50371372',
'AK50367181',
'AK50398086',
'AK50390750',
'AK50402017',
'AK50376931',
'AK50433170',
'AK50431117',
'AK50394465',
'AK50429508',
'AK50355613',
'AK50385784',
'AK50344363',
'AK50445511',
'AK50371921',
'AK50381745',
'AK50400021',
'AK50388414',
'AK50404720',
'AK50448661',
'AK50411708',
'AK50396859',
'AK50343553',
'AK50360360',
'AK50368900',
'AK50382100',
'AK50364651',
'AK50337975',
'AK50447963',
'AK50403089',
'AK50399404',
'AK50350981',
'AK50379403',
'AK50402014',
'AK50445776',
'AK50360968',
'AK50366129',
'AK50354917',
'AK50446904',
'AK50353124',
'AK50348342',
'AK50430713',
'AK50426815',
'AK50353644',
'AK50434719',
'AK50369981',
'AK50405784',
'AK50386877',
'AK50360105',
'AK50433339',
'AK50400008',
'AK50393911',
'AK50445689',
'AK50415110',
'AK50384561',
'AK50374429',
'AK50391989',
'AK50370711',
'AK50379097',
'AK50370244',
'AK50969567',
'AK50349829',
'AK50378035',
'AK50368355',
'AK50368793',
'AK50348848',
'AK50355185',
'AK50363747',
'AK50362645',
'AK50400147',
'AK50400714',
'AK50418554',
'AK50372450',
'AK50431671',
'AK50432048',
'AK50338295',
'AK50405462',
'AK50356688',
'AK50362257',
'AK50358694',
'AK50372334',
'AK50405840',
'AK50339855',
'AK50380093',
'AK50371067',
'AK50363992',
'AK50357918',
'AK50342945',
'AK50430547',
'AK50364201',
'AK50404309',
'AK50431102',
'AK50404322',
'AK50447824',
'AK50403245',
'AK50348384',
'AK50384780',
'AK50350251',
'AK50416071',
'AK50373881',
'AK50401163',
'AK50355863',
'AK50406735',
'AK50434595',
'AK50360526',
'AK50431666',
'AK50432108',
'AK50432958',
'AK50415698',
'AK50374399',
'AK50384496',
'AK50380219',
'AK50403520',
'AK50373070',
'AK50434351',
'AK50389161',
'AK50397534',
'AK50432284',
'AK50350668',
'AK50344949',
'AK50372539',
'AK50373852',
'AK50339461',
'AK50415133',
'AK50434134',
'AK50434215',
'AK50407716',
'AK50401896',
'AK50358891',
'AK50386120',
'AK50396520',
'AK50368520',
'AK50390011',
'AK50397121',
'AK50354872',
'AK50370503',
'AK50359684',
'AK50357885',
'AK50434866',
'AK50368037',
'AK50345010',
'AK50430921',
'AK50446883',
'AK50337776',
'AK50373190',
'AK50385022',
'AK50418010',
'AK50376618',
'AK50369492',
'AK50392794',
'AK50408290',
'AK50352070',
'AK50390051',
'AK50395151',
'AK50388752',
'AK50444473',
'AK50381464',
'AK50369184',
'AK50379694',
'AK50402265',
'AK50365995',
'AK50406416',
'AK50356747',
'AK50366168',
'AK50395188',
'AK50370869',
'AK50341980',
'AK50346535',
'AK50348428',
'AK50364320',
'AK50433700',
'AK50419160',
'AK50359990',
'AK50407111',
'AK50381321',
'AK50430731',
'AK50376033',
'AK50434633',
'AK50357154',
'AK50372675',
'AK50363237',
'AK50372157',
'AK50432478',
'AK50374799',
'AK50376797',
'AK50379136',
'AK50353187',
'AK50354465',
'AK50343063',
'AK50397451',
'AK50410520',
'AK50350031',
'AK50404374',
'AK50367576',
'AK50374517',
'AK50368678',
'AK50340239',
'AK50388267',
'AK50418848',
'AK50344410',
'AK50339513',
'AK50402277',
'AK50371240',
'AK50349979',
'AK50677665',
'AK50362163',
'AK50353815',
'AK50394697',
'AK50347979',
'AK50677500',
'AK50375070',
'AK50387172',
'AK50369307',
'AK50348856',
'AK50347057',
'AK50404489',
'AK50362300',
'AK50398300',
'AK50443431',
'AK50365041',
'AK50401561',
'AK50366771',
'AK50403912',
'AK50426912',
'AK50397762',
'AK50383172',
'AK50371413',
'AK50361174',
'AK50354815',
'AK50379625',
'AK50384435',
'AK50354535',
'AK50395345',
'AK50376365',
'AK50432726',
'AK50350856',
'AK50356586',
'AK50394596',
'AK50401277',
'AK50391118',
'AK50367718',
'AK50448568',
'AK50386288',
'AK50401239',
'AK50395799',
'AK50347194',
'AK50358880',
'AK50344688',
'AK50362701',
'AK50362182',
'AK50376383',
'AK50377924',
'AK50410825',
'AK50374506',
'AK50375366',
'AK50404886',
'AK50428318',
'AK50339780',
'AK50337735',
'AK50340137',
'AK50432929',
'AK50337261',
'AK50393669',
'AK50339606',
'AK50965982',
'AK50969734',
'AK50429536',
'AK50409756',
'AK50338958',
'AK50448543',
'AK50392145',
'AK50396567',
'AK50371502',
'AK50396892',
'AK50405194',
'AK50433787',
'AK50370338',
'AK50434948',
'AK50215784',
'AK50378941',
'AK50354170',
'AK50396910',
'AK50432750',
'AK50354360',
'AK50399680',
'AK50357390',
'AK50370931',
'AK50350541',
'AK50372261',
'AK50350381',
'AK50363872',
'AK50389892',
'AK50394533',
'AK50379543',
'AK50380354',
'AK50357495',
'AK50398816',
'AK50390207',
'AK50381448',
'AK50344521',
'AK50338149',
'AK50418262',
'AK50356244',
'AK50448137',
'AK50431351',
'AK50376223',
'AK50404373',
'AK50387930',
'AK50367817',
'AK50353903',
'AK50387712',
'AK50393459',
'AK50447700',
'AK50349120',
'AK50378339',
'AK50359569',
'AK50397978',
'AK50387202',
'AK50377901',
'AK50388813',
'AK49530408',
'AK50404689',
'AK50390870',
'AK50417931',
'AK50426522',
'AK50388865',
'AK49601185',
'AK48805570',
'AK48799285',
'AK50341042',
'AK50375548',
'AK50345559',
'AK49630807',
'AK50389533',
'AK50354146',
'AK49502475',
'AK48802176',
'AK50409094',
'AK49523118',
'AK48785211',
'AK50118671',
'AK48806370',
'AK48040202',
'AK50969570',
'AK50969661',
'AK50969671',
'AK50969623',
'AK50966033',
'AK50966034',
'AK50969576',
'AK50966017',
'AK50966027',
'AK50966037',
'AK50969637',
'AK50969739',
'AK50677551',
'AK50677661',
'AK50677672',
'AK50677613',
'AK50677655',
'AK50677629',
'AK50677659',
'AK50677679',
'AK50432100',
'AK50366100',
'AK50388100',
'AK50367200',
'AK50356300',
'AK50373400',
'AK50359700',
'AK50432900',
'AK50397910',
'AK50356020',
'AK50434120',
'AK50430220',
'AK50350220',
'AK50357920',
'AK50384230',
'AK50368230',
'AK50403330',
'AK50355330',
'AK50401430',
'AK50393430',
'AK50434430',
'AK50374630',
'AK50375930',
'AK50394140',
'AK50375140',
'AK50389140',
'AK50432240',
'AK50411440',
'AK50371440',
'AK50391440',
'AK50352840',
'AK50427150',
'AK50403450',
'AK50433950',
'AK50406060',
'AK50354160',
'AK50368260',
'AK50403660',
'AK50374860',
'AK50355860',
'AK50404070',
'AK50444170',
'AK50384470',
'AK50398670',
'AK50371770',
'AK50427770',
'AK50389770',
'AK50353970',
'AK50363080',
'AK50435080',
'AK50380180',
'AK50385180',
'AK50378280',
'AK50382480',
'AK50447480',
'AK50382680',
'AK50370980',
'AK50435090',
'AK50444190',
'AK50378390',
'AK50393690',
'AK50353890',
'AK50374890',
'AK50397990',
'AK50431601',
'AK50444701',
'AK50361801',
'AK50369801',
'AK50353901',
'AK50391011',
'AK50413011',
'AK50429311',
'AK50393711',
'AK50444711',
'AK50443811',
'AK50393811',
'AK50378911',
'AK50432121',
'AK50368121',
'AK50402721',
'AK50368031',
'AK50432431',
'AK50357631',
'AK50400831',
'AK50445831',
'AK50349831',
'AK50407931',
'AK50366041',
'AK50369041',
'AK50387641',
'AK50351841',
'AK50368841',
'AK50433941',
'AK50434941',
'AK50397251',
'AK50364351',
'AK50368351',
'AK50365951',
'AK50397951',
'AK50400061',
'AK50382061',
'AK50398061',
'AK50361161',
'AK50388161',
'AK50400361',
'AK50444361',
'AK50359561',
'AK50434661',
'AK50367761',
'AK50378761',
'AK50398861',
'AK50374961',
'AK50358171',
'AK50402471',
'AK50360671',
'AK50366671',
'AK50367671',
'AK50404871',
'AK50434871',
'AK50378081',
'AK50360281',
'AK50366281',
'AK50393581',
'AK50430981',
'AK50368981',
'AK50400091',
'AK50403191',
'AK50431291',
'AK50433391',
'AK50384391',
'AK50359391',
'AK50446891',
'AK50392102',
'AK50428302',
'AK50401402',
'AK50446502',
'AK50360602',
'AK50370602',
'AK50388602',
'AK50385702',
'AK50356702',
'AK50388702',
'AK50397802',
'AK50397012',
'AK50379012',
'AK50401112',
'AK50352312',
'AK50383312',
'AK50446512',
'AK50391612',
'AK50399612',
'AK50384812',
'AK50393022',
'AK50375522',
'AK50446522',
'AK50406722',
'AK50368722',
'AK50367922',
'AK50368132',
'AK50373532',
'AK50397532',
'AK50388632',
'AK50367832',
'AK50444932',
'AK50369042',
'AK50434542',
'AK50376942',
'AK50435052',
'AK50390152',
'AK50393352',
'AK50365352',
'AK50358452',
'AK50399452',
'AK50433752',
'AK50357162',
'AK50368162',
'AK50372262',
'AK50379762',
'AK50391962',
'AK50433472',
'AK50392572',
'AK50429672',
'AK50405772',
'AK50445872',
'AK50381972',
'AK50399082',
'AK50405182',
'AK50377182',
'AK50401482',
'AK50393482',
'AK50366582',
'AK50392782',
'AK50369982',
'AK50447592',
'AK50390692',
'AK50362892',
'AK50431992',
'AK50385992',
'AK50354203',
'AK50394303',
'AK50403503',
'AK50358703',
'AK50403803',
'AK50403113',
'AK50434413',
'AK50446413',
'AK50349513',
'AK50431613',
'AK50432613',
'AK50379613',
'AK50444913',
'AK50389123',
'AK50445223',
'AK50393323',
'AK50433423',
'AK50351823',
'AK50387823',
'AK50433923',
'AK50426923',
'AK50390233',
'AK50381333',
'AK50431633',
'AK50381633',
'AK50365833',
'AK50431933',
'AK50368933',
'AK50387043',
'AK50404343',
'AK50384443',
'AK50381543',
'AK50349543',
'AK50431743',
'AK50382943',
'AK50403053',
'AK50369153',
'AK50370353',
'AK50395653',
'AK50387753',
'AK50446853',
'AK50396063',
'AK50384263',
'AK50375463',
'AK50385663',
'AK50432273',
'AK50373273',
'AK50427273',
'AK50447373',
'AK50366473',
'AK50418473',
'AK50363673',
'AK50443773',
'AK50430973',
'AK50352083',
'AK50374083',
'AK50407183',
'AK50400283',
'AK50361383',
'AK50355683',
'AK50445783',
'AK50417783',
'AK50426883',
'AK50444093',
'AK50368093',
'AK50445393',
'AK50409693',
'AK50372893',
'AK50405893',
'AK50359893',
'AK50360993',
'AK50399993',
'AK50381004',
'AK50371104',
'AK50448104',
'AK50434204',
'AK50405014',
'AK50355014',
'AK50390214',
'AK50390314',
'AK50371314',
'AK50368814',
'AK50401914',
'AK50365024',
'AK50430124',
'AK50365124',
'AK50349624',
'AK50397924',
'AK50390034',
'AK50431034',
'AK50384134',
'AK50371234',
'AK50432734',
'AK50410644',
'AK50391844',
'AK50349844',
'AK50429154',
'AK50361654',
'AK50393654',
'AK50406654',
'AK50393754',
'AK50386954',
'AK50401364',
'AK50448464',
'AK50372664',
'AK50443964',
'AK50430274',
'AK50356474',
'AK50405574',
'AK50399774',
'AK50434874',
'AK50431974',
'AK50359974',
'AK50401084',
'AK50351084',
'AK50380184',
'AK50419284',
'AK50434384',
'AK50366584',
'AK50444684',
'AK50366684',
'AK50379684',
'AK50373884',
'AK50381094',
'AK50396094',
'AK50363894',
'AK50430994',
'AK50356994',
'AK50370205',
'AK50434305',
'AK50405305',
'AK50355405',
'AK50370605',
'AK50396805',
'AK50387805',
'AK50358805',
'AK50400115',
'AK50371115',
'AK50404215',
'AK50398215',
'AK50365315',
'AK50361615',
'AK50362615',
'AK50392615',
'AK50404615',
'AK50351025',
'AK50401225',
'AK50433425',
'AK50434525',
'AK50393625',
'AK50388625',
'AK50388825',
'AK50383925',
'AK50374925',
'AK50379235',
'AK50371435',
'AK50404435',
'AK50365435',
'AK50433935',
'AK50404935',
'AK50395045',
'AK50366345',
'AK50400445',
'AK50397545',
'AK50379845',
'AK50388255',
'AK50405355',
'AK50380455',
'AK50364455',
'AK50434755',
'AK50353165',
'AK50392465',
'AK50409465',
'AK50396565',
'AK50388665',
'AK50431965',
'AK50362175',
'AK50397475',
'AK50393575',
'AK50374975',
'AK50358085',
'AK50393185',
'AK50417585',
'AK50428685',
'AK50393885',
'AK50382295',
'AK50431495',
'AK50357895',
'AK50390006',
'AK50433106',
'AK50401406',
'AK50431406',
'AK50350706',
'AK50359806',
'AK50433016',
'AK50402116',
'AK50401216',
'AK50373216',
'AK50370316',
'AK50373316',
'AK50381416',
'AK50382616',
'AK50426616',
'AK50445716',
'AK50385716',
'AK50399716',
'AK50369916',
'AK50374126',
'AK50388126',
'AK50402326',
'AK50408236',
'AK50379236',
'AK50388336',
'AK50375436',
'AK50390936',
'AK50367936',
'AK50397936',
'AK50392046',
'AK50398346',
'AK50352446',
'AK50373446',
'AK50443646',
'AK50363646',
'AK50383746',
'AK50379846',
'AK50390256',
'AK50378256',
'AK50390456',
'AK50388456',
'AK50400756',
'AK50395756',
'AK50387756',
'AK50364956',
'AK50403066',
'AK50372166',
'AK50399166',
'AK50397266',
'AK50405366',
'AK50391666',
'AK50399666',
'AK50375966',
'AK50404076',
'AK50379176',
'AK50444276',
'AK50379276',
'AK50365576',
'AK50401976',
'AK50372186',
'AK50372286',
'AK50370386',
'AK50435386',
'AK50368586',
'AK50396686',
'AK50394886',
'AK50367986',
'AK50358986',
'AK50446096',
'AK50432296',
'AK50395296',
'AK50406296',
'AK50362596',
'AK50369596',
'AK50357796',
'AK50388796',
'AK50354207',
'AK50364307',
'AK50374507',
'AK50392807',
'AK50432907',
'AK50404517',
'AK50378517',
'AK50400327',
'AK50445327',
'AK50366427',
'AK50393527',
'AK50397727',
'AK50364927',
'AK50364037',
'AK50352137',
'AK50352537',
'AK50409637',
'AK50382737',
'AK50356937',
'AK50401147',
'AK50362147',
'AK50379247',
'AK50373647',
'AK50407647',
'AK50403057',
'AK50372357',
'AK50394457',
'AK50372857',
'AK50362957',
'AK50384957',
'AK50379957',
'AK50429067',
'AK50390467',
'AK50431467',
'AK50433767',
'AK50354767',
'AK50362967',
'AK50381377',
'AK50391577',
'AK50368577',
'AK50392777',
'AK50431977',
'AK50407087',
'AK50401287',
'AK50358287',
'AK50399287',
'AK50443687',
'AK50368787',
'AK50378887',
'AK50411297',
'AK50392397',
'AK50366397',
'AK50398397',
'AK50357797',
'AK50381008',
'AK50368008',
'AK50386108',
'AK50382408',
'AK50397508',
'AK50354608',
'AK50352708',
'AK50397808',
'AK50372018',
'AK50427718',
'AK50359718',
'AK50395128',
'AK50394228',
'AK50391728',
'AK50353928',
'AK50395138',
'AK50429138',
'AK50375238',
'AK50445338',
'AK50400438',
'AK50447438',
'AK50366538',
'AK50430738',
'AK50402738',
'AK50406148',
'AK50363248',
'AK50404248',
'AK50394248',
'AK50433748',
'AK50357748',
'AK50431948',
'AK50364948',
'AK50444358',
'AK50430858',
'AK50380858',
'AK50363858',
'AK50373858',
'AK50392958',
'AK50433958',
'AK50402168',
'AK50400368',
'AK50352278',
'AK50367278',
'AK50406578',
'AK50353778',
'AK50407088',
'AK50397088',
'AK50384388',
'AK50385488',
'AK50360588',
'AK50395688',
'AK50375788',
'AK50381888',
'AK50428888',
'AK50379988',
'AK50402098',
'AK50386098',
'AK50389198',
'AK50351498',
'AK50380798',
'AK50372009',
'AK50431309',
'AK50399709',
'AK50349809',
'AK50378119',
'AK50401219',
'AK50363219',
'AK50401319',
'AK50374619',
'AK50368619',
'AK50364919',
'AK50362029',
'AK50359329',
'AK50363429',
'AK50444629',
'AK50386629',
'AK50363729',
'AK50433039',
'AK50394039',
'AK50396039',
'AK50429339',
'AK50407539',
'AK50443739',
'AK50435049',
'AK50364149',
'AK50391249',
'AK50386249',
'AK50365749',
'AK50404059',
'AK50431159',
'AK50447259',
'AK50434859',
'AK50351959',
'AK50396959',
'AK50370069',
'AK50407569',
'AK50405769',
'AK50397769',
'AK50399969',
'AK50434079',
'AK50362179',
'AK50427579',
'AK50445679',
'AK50390879',
'AK50403879',
'AK50431979',
'AK50444979',
'AK50349389',
'AK50387489',
'AK50399589',
'AK50373789',
'AK50392099',
'AK50435099',
'AK50404199',
'AK50357199',
'AK50368299',
'AK50406399',
'AK50431499',
'AK50447799',
'AK50392999',
'AK50349100',
'AK50345300',
'AK50345700',
'AK50343310',
'AK50339720',
'AK50343730',
'AK50347240',
'AK50339240',
'AK50341340',
'AK50347150',
'AK50342460',
'AK50347660',
'AK50338660',
'AK50340570',
'AK50342690',
'AK50339501',
'AK50340211',
'AK50346911',
'AK50337721',
'AK50347821',
'AK50338841',
'AK50337551',
'AK50348471',
'AK50348771',
'AK50337781',
'AK50349191',
'AK50338991',
'AK50338312',
'AK50340042',
'AK50339752',
'AK50340162',
'AK50347562',
'AK50346482',
'AK50344782',
'AK50341303',
'AK50348603',
'AK50338523',
'AK50344923',
'AK50345133',
'AK50340433',
'AK50349143',
'AK50340643',
'AK50338263',
'AK50347763',
'AK50338763',
'AK50347573',
'AK50338183',
'AK50339683',
'AK50346493',
'AK50338304',
'AK50342914',
'AK50342924',
'AK50347924',
'AK50338474',
'AK50346574',
'AK50347674',
'AK50341084',
'AK50339345',
'AK50345155',
'AK50347465',
'AK50344865',
'AK50338275',
'AK50341375',
'AK50341975',
'AK50340585',
'AK50347595',
'AK50340695',
'AK50340206',
'AK50346336',
'AK50343356',
'AK50348166',
'AK50344476',
'AK50347386',
'AK50347096',
'AK50344207',
'AK50337607',
'AK50345917',
'AK50339227',
'AK50344357',
'AK50344457',
'AK50348377',
'AK50338308',
'AK50349308',
'AK50338418',
'AK50346718',
'AK50337928',
'AK50338248',
'AK50340448',
'AK50345268',
'AK50340668',
'AK50339878',
'AK50341388',
'AK50346598',
'AK50344709',
'AK50339419',
'AK50340519',
'AK50340719',
'AK50345529',
'AK50348629',
'AK50346369',
'AK50339199',
'AK50346999',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20210218_1500_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
