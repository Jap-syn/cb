<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20200213_1500_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK41814300',
'AK41818300',
'AK41822400',
'AK41787400',
'AK41778500',
'AK41795600',
'AK41764700',
'AK41818800',
'AK41788900',
'AK41759010',
'AK41788110',
'AK41798110',
'AK41792210',
'AK41780510',
'AK41783810',
'AK41803910',
'AK41789910',
'AK41817520',
'AK41768720',
'AK41783820',
'AK41778820',
'AK41812030',
'AK41154030',
'AK41802130',
'AK41816130',
'AK41791230',
'AK41770330',
'AK41790330',
'AK41790630',
'AK41787630',
'AK41772930',
'AK41822240',
'AK41763540',
'AK41784540',
'AK41790640',
'AK41787740',
'AK41795840',
'AK41769840',
'AK41796940',
'AK41773050',
'AK41823150',
'AK41762250',
'AK41778350',
'AK41783450',
'AK41778450',
'AK41814550',
'AK41818550',
'AK41821650',
'AK41763650',
'AK41788650',
'AK41819650',
'AK41772750',
'AK41767850',
'AK41779850',
'AK41822060',
'AK41806060',
'AK41758060',
'AK41779060',
'AK41802160',
'AK41785460',
'AK41795460',
'AK41765560',
'AK41787660',
'AK41814960',
'AK41792070',
'AK41824070',
'AK41768070',
'AK41759070',
'AK41781270',
'AK41809270',
'AK41822370',
'AK41816370',
'AK41767370',
'AK41782470',
'AK41704470',
'AK41818470',
'AK41792570',
'AK41823570',
'AK41821670',
'AK41761670',
'AK41765670',
'AK41785670',
'AK41793870',
'AK41758180',
'AK41787280',
'AK41779280',
'AK41141380',
'AK41812480',
'AK41778480',
'AK41821580',
'AK41782580',
'AK41805580',
'AK41806580',
'AK41788780',
'AK41772880',
'AK41779880',
'AK41790980',
'AK41814980',
'AK41757980',
'AK41763290',
'AK41765290',
'AK41806390',
'AK41784490',
'AK41147490',
'AK41767490',
'AK41798590',
'AK41787690',
'AK41807790',
'AK41787990',
'AK41771001',
'AK41793101',
'AK41792201',
'AK41769201',
'AK41779301',
'AK41766401',
'AK41782501',
'AK41792501',
'AK41815501',
'AK41789501',
'AK41812601',
'AK41787701',
'AK41785801',
'AK41773011',
'AK41807011',
'AK41808011',
'AK41786111',
'AK41762311',
'AK41785311',
'AK41796311',
'AK41779311',
'AK41806411',
'AK41822611',
'AK41768611',
'AK41787711',
'AK41795811',
'AK41778911',
'AK41792221',
'AK41818321',
'AK41765421',
'AK41759421',
'AK41782521',
'AK41758521',
'AK41762721',
'AK41765821',
'AK41820921',
'AK41798031',
'AK41769031',
'AK41766131',
'AK41778131',
'AK41798231',
'AK41764331',
'AK41792431',
'AK41758431',
'AK41790531',
'AK41824531',
'AK41758531',
'AK41787731',
'AK41791831',
'AK41803341',
'AK41782441',
'AK41808441',
'AK41780541',
'AK41806641',
'AK41780741',
'AK40686841',
'AK41821941',
'AK41802941',
'AK41767941',
'AK41788941',
'AK41704051',
'AK41792251',
'AK41778251',
'AK41784351',
'AK41758451',
'AK41792551',
'AK41817551',
'AK41787851',
'AK41815061',
'AK41788261',
'AK41820361',
'AK41704461',
'AK41812561',
'AK41783761',
'AK41765171',
'AK41809171',
'AK41771271',
'AK41765271',
'AK41784371',
'AK41787371',
'AK41821471',
'AK41783571',
'AK41826571',
'AK41778571',
'AK41137671',
'AK41784871',
'AK41788871',
'AK41785971',
'AK41822081',
'AK41807081',
'AK41793181',
'AK41786181',
'AK41759181',
'AK41790281',
'AK41822281',
'AK41792481',
'AK41704481',
'AK41817481',
'AK41798191',
'AK41788291',
'AK41792491',
'AK41791691',
'AK41759691',
'AK41792791',
'AK41811891',
'AK41764991',
'AK41807002',
'AK41758102',
'AK41820302',
'AK41783602',
'AK41821702',
'AK41787702',
'AK41788702',
'AK41782902',
'AK41771012',
'AK41762112',
'AK41793112',
'AK41808112',
'AK41793212',
'AK41801412',
'AK41803412',
'AK41824412',
'AK41788412',
'AK41792512',
'AK41809512',
'AK41780712',
'AK41768812',
'AK41789812',
'AK41901022',
'AK41704022',
'AK41765022',
'AK41783122',
'AK41768122',
'AK41823322',
'AK41817422',
'AK41790522',
'AK41772522',
'AK41792522',
'AK41779522',
'AK41782722',
'AK41816722',
'AK41764922',
'AK41819922',
'AK41789922',
'AK41805032',
'AK41819232',
'AK41772332',
'AK41764332',
'AK41788332',
'AK41761432',
'AK41758432',
'AK41820532',
'AK41815532',
'AK41816532',
'AK41759532',
'AK41815732',
'AK41793832',
'AK41805832',
'AK41806932',
'AK41809932',
'AK41765042',
'AK41814242',
'AK41798242',
'AK41809242',
'AK41762542',
'AK41824642',
'AK41827842',
'AK41787052',
'AK41779052',
'AK41766152',
'AK41768152',
'AK41779252',
'AK41787352',
'AK41788352',
'AK41128552',
'AK41759552',
'AK41780652',
'AK41787652',
'AK41803752',
'AK41793852',
'AK41793062',
'AK41768062',
'AK41793162',
'AK41766162',
'AK41772362',
'AK41787362',
'AK41788362',
'AK41761462',
'AK41759462',
'AK41759562',
'AK41820762',
'AK41783762',
'AK41784762',
'AK41766762',
'AK41767762',
'AK41816172',
'AK41768172',
'AK41766272',
'AK41778372',
'AK41820572',
'AK41781672',
'AK41769672',
'AK41782772',
'AK41788772',
'AK41805872',
'AK41821182',
'AK41780282',
'AK41785282',
'AK41782482',
'AK41792482',
'AK41778582',
'AK41781682',
'AK41792682',
'AK41768682',
'AK41784782',
'AK41811982',
'AK41782092',
'AK41792192',
'AK41704192',
'AK41803292',
'AK41786292',
'AK41771392',
'AK41772392',
'AK41762492',
'AK41766592',
'AK41765792',
'AK41793892',
'AK41811992',
'AK41758003',
'AK41822103',
'AK41764303',
'AK41779303',
'AK41786403',
'AK41767403',
'AK41784503',
'AK41813603',
'AK41784603',
'AK41782703',
'AK41761803',
'AK41772803',
'AK41779803',
'AK41768013',
'AK41821213',
'AK41784313',
'AK41809313',
'AK41785413',
'AK41778413',
'AK41803513',
'AK41769513',
'AK41820613',
'AK41785613',
'AK41816713',
'AK41783813',
'AK41770123',
'AK41782123',
'AK41772223',
'AK41784423',
'AK41770523',
'AK41792523',
'AK41802623',
'AK41779623',
'AK41809723',
'AK41769923',
'AK41800033',
'AK41780033',
'AK41812033',
'AK41758333',
'AK41782533',
'AK41762733',
'AK41781043',
'AK41763043',
'AK41768043',
'AK41773143',
'AK41808143',
'AK41704243',
'AK41814343',
'AK41785343',
'AK41765443',
'AK41784543',
'AK41808543',
'AK41819053',
'AK41782153',
'AK41769253',
'AK41822353',
'AK41798353',
'AK41792453',
'AK41790553',
'AK41793553',
'AK41764853',
'AK41768163',
'AK41773263',
'AK41764263',
'AK41802463',
'AK41789563',
'AK41761663',
'AK41815663',
'AK41785763',
'AK41153863',
'AK41810963',
'AK41785963',
'AK41819073',
'AK41771173',
'AK41793173',
'AK41758273',
'AK41812473',
'AK41763773',
'AK41779873',
'AK41758973',
'AK40499973',
'AK41792083',
'AK41763083',
'AK41790183',
'AK41765183',
'AK41792383',
'AK41788483',
'AK41795683',
'AK41789783',
'AK41785983',
'AK41814193',
'AK41795193',
'AK41778293',
'AK41813593',
'AK41805793',
'AK41812893',
'AK41821993',
'AK41765004',
'AK41769104',
'AK41773204',
'AK41807204',
'AK41813304',
'AK41785304',
'AK41784404',
'AK41768404',
'AK41779404',
'AK41778504',
'AK41766604',
'AK41787604',
'AK41819804',
'AK41781014',
'AK41769014',
'AK41773114',
'AK41792214',
'AK41763214',
'AK41781314',
'AK41767314',
'AK41814414',
'AK41815514',
'AK41791614',
'AK41783614',
'AK41787714',
'AK41703814',
'AK41767814',
'AK41812024',
'AK41808124',
'AK41150324',
'AK41779324',
'AK41758424',
'AK41781524',
'AK41769524',
'AK41822624',
'AK41766624',
'AK41787724',
'AK41799724',
'AK41819824',
'AK41792924',
'AK41816924',
'AK41771034',
'AK41796034',
'AK41784134',
'AK41766134',
'AK41797134',
'AK41783234',
'AK41784234',
'AK41764334',
'AK41780434',
'AK41801434',
'AK41816434',
'AK41778434',
'AK41769434',
'AK41780534',
'AK41819534',
'AK41781634',
'AK41793144',
'AK41793444',
'AK41766444',
'AK41790544',
'AK41824544',
'AK41789744',
'AK41764844',
'AK41816844',
'AK41780944',
'AK41785944',
'AK41779944',
'AK41801254',
'AK41797354',
'AK41758454',
'AK41778454',
'AK41792754',
'AK41825754',
'AK41809754',
'AK41823854',
'AK41816854',
'AK41703954',
'AK41782064',
'AK41793064',
'AK41808064',
'AK41768064',
'AK41798064',
'AK41762164',
'AK41788264',
'AK41808364',
'AK41784464',
'AK41779464',
'AK41790564',
'AK41804664',
'AK41817174',
'AK41784274',
'AK41779374',
'AK41772474',
'AK41768474',
'AK41790574',
'AK41761674',
'AK41766674',
'AK41792874',
'AK41811974',
'AK41792974',
'AK41812084',
'AK41792084',
'AK41758084',
'AK41765184',
'AK41795384',
'AK41768384',
'AK41779384',
'AK41792484',
'AK41769484',
'AK41803584',
'AK41845584',
'AK41787684',
'AK41767884',
'AK41766094',
'AK41818094',
'AK41758094',
'AK41792194',
'AK41813194',
'AK41824194',
'AK41789194',
'AK41812294',
'AK41808394',
'AK41820494',
'AK41795494',
'AK41790694',
'AK41796694',
'AK41758794',
'AK41798994',
'AK41783005',
'AK41845205',
'AK41781405',
'AK41800505',
'AK41782705',
'AK41793705',
'AK41782805',
'AK41765015',
'AK41780115',
'AK41771115',
'AK41813115',
'AK41817115',
'AK41799215',
'AK41786315',
'AK41768315',
'AK41826415',
'AK41791515',
'AK41786515',
'AK41782615',
'AK41783615',
'AK41759615',
'AK41792715',
'AK41805815',
'AK39765815',
'AK41789815',
'AK41784025',
'AK41817025',
'AK41818025',
'AK41788025',
'AK41766125',
'AK41807125',
'AK41788325',
'AK41784425',
'AK41821625',
'AK41787725',
'AK41785925',
'AK41789135',
'AK41792235',
'AK41771335',
'AK41772335',
'AK41822435',
'AK41762435',
'AK41767635',
'AK41780735',
'AK41821835',
'AK41772835',
'AK41780935',
'AK41766045',
'AK41141145',
'AK41826145',
'AK41822245',
'AK41772245',
'AK41822345',
'AK41803345',
'AK41764345',
'AK41820545',
'AK41790545',
'AK41769545',
'AK41820645',
'AK41780645',
'AK41793645',
'AK41788745',
'AK41770945',
'AK41805945',
'AK41758055',
'AK41801155',
'AK41824155',
'AK41759255',
'AK41769255',
'AK41791355',
'AK41822355',
'AK41129355',
'AK41787755',
'AK41770855',
'AK41805955',
'AK41816955',
'AK41827955',
'AK41820165',
'AK41793165',
'AK41704365',
'AK41787465',
'AK41783765',
'AK41805765',
'AK41769865',
'AK41764965',
'AK41785965',
'AK41815075',
'AK41768075',
'AK41821275',
'AK41788375',
'AK41808575',
'AK41801875',
'AK41785875',
'AK41772975',
'AK41773085',
'AK41792185',
'AK41768185',
'AK41803285',
'AK41779285',
'AK41806385',
'AK41808385',
'AK41782485',
'AK41793485',
'AK41778485',
'AK41784585',
'AK41780685',
'AK41761685',
'AK41778885',
'AK41757985',
'AK41793095',
'AK41778195',
'AK41799195',
'AK41767495',
'AK41787495',
'AK41786795',
'AK41813995',
'AK41772006',
'AK41792106',
'AK41782306',
'AK41790406',
'AK41788506',
'AK41769506',
'AK41792806',
'AK41783806',
'AK41772906',
'AK41782016',
'AK41768116',
'AK41791216',
'AK41787216',
'AK41797216',
'AK41797316',
'AK41788416',
'AK41761516',
'AK41788516',
'AK41809516',
'AK41819516',
'AK41780616',
'AK41812716',
'AK41825816',
'AK41821916',
'AK41809916',
'AK41770126',
'AK41792126',
'AK41803126',
'AK41781226',
'AK41766226',
'AK41799226',
'AK41821326',
'AK41821426',
'AK41782426',
'AK41758426',
'AK41790526',
'AK41779526',
'AK41782626',
'AK41758626',
'AK41799626',
'AK41787726',
'AK41812826',
'AK41792826',
'AK41795826',
'AK41808036',
'AK41813436',
'AK41766436',
'AK41780636',
'AK41827636',
'AK41790736',
'AK41784836',
'AK40497836',
'AK41793146',
'AK41767146',
'AK41822246',
'AK41808546',
'AK41818646',
'AK41759646',
'AK41703746',
'AK41787746',
'AK41770846',
'AK41783846',
'AK41793846',
'AK41816946',
'AK41763056',
'AK41785056',
'AK41764156',
'AK41817156',
'AK41821356',
'AK41761556',
'AK41817556',
'AK41759556',
'AK41784756',
'AK41769856',
'AK41779856',
'AK41822066',
'AK41824066',
'AK41762266',
'AK41778366',
'AK41786466',
'AK41758466',
'AK41789666',
'AK41767766',
'AK41799866',
'AK41761966',
'AK41790076',
'AK41768076',
'AK41792176',
'AK41780576',
'AK41787576',
'AK41783776',
'AK41769776',
'AK41801976',
'AK41802976',
'AK41817286',
'AK41768286',
'AK41813486',
'AK41765686',
'AK41816986',
'AK41818096',
'AK41759096',
'AK41792196',
'AK41779196',
'AK41764296',
'AK41801396',
'AK41781396',
'AK41784496',
'AK41800596',
'AK41787596',
'AK41780796',
'AK41781796',
'AK41784796',
'AK41803007',
'AK41786007',
'AK40493107',
'AK41779307',
'AK41766407',
'AK41766607',
'AK41768707',
'AK41783807',
'AK41799807',
'AK41822217',
'AK41793317',
'AK41766317',
'AK41779317',
'AK41802417',
'AK41781517',
'AK41792517',
'AK41761817',
'AK41783817',
'AK41812917',
'AK41798917',
'AK41824027',
'AK41789027',
'AK41816127',
'AK41786127',
'AK41768127',
'AK41812227',
'AK41803227',
'AK41784327',
'AK41807427',
'AK41786627',
'AK41783927',
'AK41788927',
'AK41812137',
'AK41771237',
'AK41763237',
'AK41847337',
'AK41818437',
'AK41778437',
'AK41809437',
'AK41792537',
'AK41801637',
'AK41827837',
'AK41793937',
'AK41824937',
'AK41802047',
'AK41765047',
'AK41798047',
'AK41779147',
'AK41812247',
'AK41798247',
'AK41765447',
'AK41788447',
'AK41778547',
'AK41786647',
'AK41799647',
'AK41791747',
'AK41802747',
'AK41787747',
'AK41769747',
'AK41790847',
'AK41811947',
'AK41792257',
'AK41791557',
'AK41793657',
'AK41761757',
'AK41787757',
'AK41784857',
'AK41768857',
'AK41811957',
'AK41757957',
'AK41813067',
'AK41758267',
'AK41793367',
'AK41803567',
'AK41787567',
'AK41799767',
'AK41791177',
'AK41793177',
'AK41803277',
'AK41824277',
'AK41807377',
'AK41788377',
'AK41792477',
'AK41807677',
'AK41797087',
'AK41815187',
'AK41762287',
'AK41766287',
'AK41793687',
'AK41768787',
'AK41778787',
'AK41779787',
'AK41809887',
'AK41703987',
'AK41823987',
'AK41793097',
'AK41704097',
'AK41797097',
'AK41759297',
'AK41769397',
'AK41787697',
'AK41845897',
'AK41818897',
'AK41779897',
'AK41821997',
'AK41806997',
'AK41819997',
'AK41771008',
'AK41793108',
'AK41799208',
'AK41788508',
'AK41793708',
'AK41787708',
'AK41783808',
'AK41796908',
'AK41793018',
'AK41765018',
'AK41826018',
'AK41796118',
'AK41771218',
'AK41792218',
'AK41766218',
'AK41818218',
'AK41764318',
'AK41793418',
'AK41758418',
'AK41787718',
'AK41820818',
'AK41805918',
'AK41783128',
'AK41765128',
'AK41767128',
'AK41821328',
'AK41766328',
'AK41792428',
'AK41779828',
'AK41816928',
'AK41798928',
'AK41793138',
'AK41808138',
'AK41798138',
'AK41782238',
'AK41793238',
'AK41821338',
'AK41798338',
'AK41779338',
'AK41761438',
'AK41817438',
'AK41153538',
'AK41785538',
'AK41811638',
'AK41792638',
'AK41792048',
'AK41770148',
'AK41824148',
'AK41766248',
'AK41796248',
'AK41798248',
'AK41819348',
'AK41778548',
'AK41765648',
'AK41785648',
'AK41791848',
'AK41793848',
'AK41787948',
'AK41773058',
'AK41765158',
'AK41764358',
'AK41795358',
'AK41766358',
'AK41778358',
'AK41790458',
'AK41782458',
'AK41778458',
'AK41779458',
'AK41761658',
'AK41802758',
'AK41767758',
'AK41782958',
'AK41757958',
'AK41807068',
'AK41819068',
'AK41802268',
'AK41759268',
'AK41789268',
'AK41785368',
'AK41779368',
'AK41761468',
'AK41762668',
'AK41820768',
'AK41821768',
'AK41771768',
'AK41785868',
'AK41787868',
'AK41763968',
'AK41762078',
'AK41782078',
'AK41823078',
'AK41808078',
'AK41788078',
'AK41783378',
'AK41787378',
'AK41770478',
'AK41792478',
'AK41824478',
'AK41844478',
'AK41759478',
'AK41779478',
'AK41790578',
'AK41792578',
'AK41793578',
'AK41761778',
'AK41785778',
'AK41811978',
'AK41795978',
'AK41763088',
'AK41814088',
'AK41758088',
'AK41792388',
'AK41789788',
'AK41782988',
'AK41823988',
'AK41821098',
'AK41808098',
'AK41821198',
'AK41779498',
'AK41764698',
'AK41783798',
'AK41793798',
'AK41789798',
'AK41823998',
'AK41783009',
'AK41798009',
'AK41820109',
'AK41803109',
'AK41808109',
'AK41792309',
'AK41763409',
'AK41798609',
'AK41767809',
'AK41814119',
'AK41780219',
'AK41792219',
'AK41765419',
'AK41789519',
'AK41758719',
'AK41768719',
'AK41812819',
'AK41795819',
'AK41770919',
'AK41779029',
'AK41783129',
'AK41787129',
'AK41821229',
'AK41812229',
'AK41782229',
'AK41779229',
'AK41761529',
'AK41814529',
'AK41768529',
'AK41761629',
'AK41784629',
'AK41822139',
'AK41818339',
'AK41778339',
'AK41763439',
'AK41788439',
'AK41789439',
'AK41817639',
'AK41787639',
'AK41788639',
'AK41787739',
'AK41803839',
'AK41793839',
'AK41787839',
'AK41816939',
'AK41795149',
'AK41788349',
'AK41782449',
'AK41820549',
'AK41809549',
'AK41817649',
'AK41812749',
'AK41787749',
'AK41767949',
'AK41768259',
'AK41779259',
'AK41793459',
'AK41778559',
'AK41783759',
'AK41793759',
'AK41758759',
'AK41789859',
'AK41808959',
'AK41809959',
'AK41821069',
'AK41824069',
'AK41795269',
'AK41778269',
'AK41766369',
'AK41793569',
'AK41761669',
'AK41786769',
'AK41758769',
'AK41785869',
'AK41846969',
'AK41797179',
'AK41784279',
'AK41786279',
'AK41809279',
'AK41801479',
'AK41780579',
'AK41784879',
'AK41758879',
'AK41764979',
'AK41819189',
'AK41763289',
'AK41768289',
'AK41779289',
'AK41788389',
'AK41787489',
'AK41779789',
'AK41770199',
'AK41785199',
'AK41779299',
'AK41824399',
'AK41808499',
'AK41770599',
'AK41822599',
'AK41824599',
'AK41820699',
'AK41816799',
'AK41826999',
'AK41798999',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20200213_1500_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
