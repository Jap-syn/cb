<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20210209_1550_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK50252000',
'AK50104100',
'AK50916100',
'AK50329100',
'AK50700400',
'AK50658700',
'AB49583900',
'AK50525900',
'AK49879900',
'AK50703010',
'AK50212210',
'AK49974210',
'AK50284510',
'AK50873910',
'AK50525910',
'AK49879910',
'AK50276020',
'AK50190120',
'AK50651420',
'AK49896620',
'AK50525720',
'AK50198720',
'AK50892920',
'AK50466920',
'AK50057920',
'AK49879920',
'AK50844030',
'AK49985130',
'AK50916130',
'AK49818130',
'AK50916230',
'AK50700330',
'AK50700430',
'AK50651430',
'AK50284430',
'AK50229430',
'AK50587530',
'AK50198730',
'AK49879730',
'AK49996830',
'AK50057830',
'AK50892930',
'AK50313930',
'AK50057930',
'AK49879930',
'AB49589930',
'AK50171040',
'AK50471240',
'AK50684240',
'AK49818240',
'AK50700340',
'AK50080340',
'AK50600740',
'AK50543840',
'AK50251940',
'AK50892940',
'AK50058050',
'AK50489050',
'AK50449150',
'AK50471250',
'AK50684250',
'AK50526350',
'AK50543750',
'AK50073750',
'AK49879750',
'AK50525850',
'AK50892950',
'AK50313950',
'AK50088950',
'AK49879950',
'AK50089060',
'AK50657260',
'AK49468260',
'AK50684360',
'AK49879860',
'AK50892960',
'AK50088960',
'AK50171070',
'AK49421170',
'AK50350270',
'AK50631270',
'AK50795270',
'AK49868370',
'AK49997470',
'AK50904570',
'AK50449670',
'AK49811770',
'AK50791870',
'AB49583870',
'AK50892970',
'AK50058080',
'AK50916180',
'AB49586180',
'AK50684280',
'AK50700380',
'AK49855380',
'AK50252580',
'AK50904580',
'AK50855780',
'AK49879780',
'AK49879880',
'AK50692980',
'AK50700290',
'AK50665390',
'AK50526390',
'AK50190690',
'AK50478690',
'AK50073790',
'AK50798790',
'AK49879790',
'AK50265101',
'AK50212201',
'AK49974201',
'AK50700301',
'AK50684301',
'AK50855701',
'AB49585701',
'AB49586801',
'AK50321901',
'AK49879901',
'AK50314011',
'AK50089111',
'AK50589111',
'AK49818211',
'AK50449211',
'AK50700311',
'AK50526311',
'AK50657411',
'AK50621711',
'AK50855711',
'AK50726911',
'AK50252021',
'AK50314021',
'AK50270321',
'AK49772421',
'AK50229421',
'AK50224521',
'AK50424721',
'AK50840821',
'AB49583821',
'AK50892921',
'AK50795921',
'AK50844031',
'AB49585031',
'AK50916131',
'AK49974231',
'AK50684231',
'AK50916231',
'AK50284431',
'AK50587431',
'AK50229431',
'AK50600731',
'AB49583831',
'AK50853931',
'AK50088931',
'AK50089041',
'AK50700241',
'AK50486241',
'AK50526341',
'AK50700441',
'AK49772541',
'AK49895641',
'AK50600741',
'AK50525841',
'AK50251941',
'AK50873941',
'AK50795941',
'AK49879941',
'AK50171051',
'AK50314051',
'AK50351151',
'AK51178151',
'AK50700251',
'AK49974251',
'AK50526251',
'AK50684351',
'AK50526351',
'AK50004851',
'AK50057851',
'AK49879851',
'AK50699851',
'AK50532951',
'AK50892951',
'AK50238951',
'AK50529951',
'AK50089061',
'AK49974161',
'AK50471261',
'AK50684361',
'AK49843461',
'AK50526461',
'AK50892961',
'AK50314071',
'AK50079071',
'AK50030171',
'AK49818171',
'AB49585271',
'AK50651371',
'AK50252571',
'AK50190671',
'AK50855771',
'AK50855871',
'AK49879871',
'AK50699871',
'AK50699971',
'AK49974181',
'AK50665381',
'AK50657481',
'AK50198681',
'AK50543781',
'AK50057781',
'AK50349781',
'AB49585881',
'AK49879881',
'AK50251981',
'AK50525981',
'AK49974191',
'AK50138191',
'AK50684291',
'AK50526291',
'AK50242691',
'AK50665691',
'AK50198691',
'AK50073791',
'AK49879891',
'AK50313991',
'AK50057991',
'AK50088991',
'AK50252002',
'AK50314002',
'AK49818102',
'AK50089102',
'AK50212202',
'AK49974202',
'AK50449202',
'AK49847402',
'AK50657402',
'AK50587402',
'AK50284502',
'AK50296502',
'AK50525802',
'AK50795902',
'AK50057902',
'AK50212212',
'AK49818212',
'AK50151512',
'AK50284512',
'AK50855712',
'AK49837712',
'AK50963812',
'AK50525812',
'AK51382912',
'AK50692912',
'AK49879912',
'AK50252022',
'AK50058022',
'AK50030122',
'AK50190122',
'AK50684322',
'AK50229422',
'AK50424722',
'AK50004822',
'AK50525822',
'AK50892922',
'AK49974132',
'AK50575132',
'AK50963232',
'AK50916232',
'AK50526332',
'AK50138332',
'AK50700432',
'AK49550832',
'AK50855832',
'AK50892932',
'AK50275932',
'AK50057932',
'AK50088932',
'AK50171042',
'AK50089042',
'AK49974142',
'AK50549142',
'AK50700242',
'AK50700342',
'AK50684342',
'AK50436342',
'AK50526442',
'AK50657442',
'AK50313542',
'AK50543742',
'AK50008742',
'AK50892942',
'AK49879942',
'AK50314052',
'AK50089052',
'AK50736152',
'AK49974252',
'AK50270352',
'AK49763352',
'AK50021452',
'AK50224552',
'AK50057752',
'AK50073852',
'AK50251952',
'AK50892952',
'AK49879952',
'AK50171062',
'AK50489262',
'AK50526362',
'AK50700462',
'AK50322562',
'AK50525962',
'AK50314072',
'AK50526072',
'AK50058072',
'AK50700472',
'AK50252572',
'AK50665672',
'AK50892972',
'AK50575082',
'AK49818082',
'AK49974182',
'AK50631382',
'AK50665382',
'AK50058582',
'AK49903782',
'AK50525782',
'AK49879882',
'AK50618982',
'AK50843092',
'AK50225092',
'AK49145092',
'AK50575092',
'AK50089092',
'AK50449192',
'AK50700292',
'AK50631292',
'AK49843492',
'AB49586792',
'AK51382892',
'AK49879892',
'AK50251992',
'AK50449203',
'AK50425403',
'AK50855703',
'AK50004803',
'AK49879903',
'AK50526013',
'AK50252113',
'AK50030213',
'AK49974213',
'AB49589213',
'AK50270413',
'AK50613513',
'AK50349713',
'AK49879813',
'AK50251913',
'AK50089023',
'AK50042123',
'AK49818123',
'AK50684223',
'AK49866223',
'AK50526323',
'AK50229423',
'AK49858523',
'AK50543723',
'AK50855723',
'AK50892923',
'AK49875923',
'AK50449033',
'AK50351133',
'AK50568233',
'AK49772333',
'AK50284433',
'AK50307433',
'AK50198533',
'AK50198733',
'AK49879733',
'AK50004833',
'AK50057833',
'AK50832933',
'AK50692933',
'AK50088933',
'AK49879933',
'AK49974243',
'AK49818243',
'AK50795343',
'AK50526343',
'AB49589343',
'AK50684443',
'AK50855643',
'AK50191743',
'AK49879743',
'AK49879943',
'AK50526053',
'AK50089053',
'AK49818153',
'AK50486253',
'AK50700353',
'AK49763353',
'AK50700453',
'AK50021453',
'AK49818453',
'AK50263553',
'AK50600753',
'AK49879753',
'AK49960853',
'AK50892953',
'AK50814463',
'AK50263563',
'AK50543763',
'AK50969763',
'AK49879863',
'AK50088963',
'AB49586073',
'AK50270373',
'AK50684373',
'AK50489473',
'AK50465573',
'AK50525673',
'AK49879773',
'AK50855873',
'AK50575083',
'AK50651383',
'AK50665383',
'AK50904583',
'AK50525683',
'AK50855683',
'AK50004783',
'AK49879783',
'AK49623883',
'AK49879883',
'AK50526093',
'AK50058093',
'AK50198493',
'AK50534793',
'AK49879793',
'AK49879893',
'AK50301993',
'AK50088993',
'AK50252004',
'AK50314004',
'AK50058004',
'AK50058104',
'AK50657404',
'AK50543804',
'AK49879804',
'AK50251904',
'AK51382904',
'AK50592904',
'AK50057904',
'AK50088904',
'AK50058014',
'AK50916114',
'AK49818114',
'AK50506414',
'AK50190714',
'AK50004714',
'AK50478714',
'AB49588714',
'AK50507814',
'AK50089024',
'AK50042124',
'AK49869124',
'AK49974224',
'AB49587324',
'AK50526424',
'AK50657424',
'AK50229424',
'AK50313524',
'AK50424724',
'AK49879724',
'AK50050824',
'AK50699824',
'AK49879924',
'AK50699924',
'AB49585034',
'AK50284434',
'AK50543734',
'AK50904734',
'AB49588734',
'AK50057834',
'AK50892934',
'AK50351044',
'AK50089044',
'AK49974144',
'AK49974244',
'AK50270344',
'AK50465344',
'AK50198444',
'AB49589644',
'AK50557744',
'AK50699844',
'AK50088944',
'AK49879944',
'AK50171054',
'AK49836154',
'AK50138154',
'AK50420454',
'AK50021454',
'AK50600754',
'AK50525754',
'AK49887754',
'AK49879854',
'AK50892954',
'AK50057954',
'AK49879954',
'AK50574064',
'AK49896064',
'AK50700364',
'AK50700464',
'AK50814464',
'AK50284564',
'AK50759564',
'AK50198664',
'AK50572764',
'AK50865764',
'AK50791864',
'AK49879864',
'AK50892964',
'AK50758074',
'AK49974174',
'AK50645174',
'AK50270374',
'AK50284474',
'AK50657474',
'AK50198474',
'AK50198574',
'AK50624674',
'AB49586874',
'AK49879874',
'AK50699874',
'AK50313974',
'AK50314084',
'AK49974184',
'AB49588184',
'AK50700284',
'AK49891284',
'AK50665384',
'AK50284484',
'AK50572784',
'AK50004784',
'AK49879784',
'AK49879884',
'AK50088984',
'AK50819984',
'AK50575094',
'AK50526094',
'AK50449094',
'AK49974194',
'AK50526394',
'AK50587494',
'AK50284594',
'AK50437594',
'AK49895694',
'AK49879794',
'AK50873894',
'AK50301994',
'AK50212205',
'AK50449205',
'AK50156505',
'AK50306705',
'AK50525805',
'AK50493905',
'AK50575015',
'AK50058015',
'AK50351115',
'AK50518115',
'AK50648115',
'AK49974215',
'AK50526315',
'AK50513515',
'AK50855615',
'AK49879715',
'AK50251915',
'AK50263915',
'AK50057915',
'AK50252025',
'AK50089025',
'AB49585125',
'AK50684225',
'AK50229425',
'AK50284525',
'AK49680725',
'AK50295725',
'AK50759725',
'AK50099825',
'AK50892925',
'AK50057925',
'AK49974235',
'AK50631335',
'AK50648435',
'AK50855735',
'AK50543835',
'AK50832935',
'AK50892935',
'AK50313935',
'AK49974145',
'AK50700245',
'AB50239245',
'AK50284445',
'AK50284545',
'AK50855745',
'AK50892945',
'AK50837945',
'AK50252055',
'AK50684355',
'AK50190755',
'AK49887755',
'AK50323955',
'AK50916165',
'AK50526265',
'AK50700465',
'AK50855765',
'AK50251965',
'AK50892965',
'AK50448965',
'AK50265075',
'AK50526075',
'AK50198475',
'AK50600675',
'AK49879775',
'AK50600875',
'AK50970975',
'AK50892975',
'AK50295975',
'AK50642185',
'AK50525785',
'AK50088885',
'AK49818095',
'AK49818195',
'AK49868195',
'AK50526295',
'AK50700395',
'AK50526395',
'AK50023495',
'AK50855795',
'AK50301995',
'AK50138006',
'AK50030106',
'AK49145106',
'AK50212206',
'AK50123206',
'AK50225306',
'AK50657406',
'AB49587406',
'AK50156506',
'AB49587706',
'AK50532806',
'AK49879906',
'AK50138016',
'AK50089016',
'AK50489016',
'AK49954216',
'AK50270316',
'AK50523316',
'AK50518316',
'AK50198516',
'AK50855616',
'AK50563716',
'AK49879816',
'AK49879916',
'AK49818226',
'AK50700326',
'AK49843326',
'AK50684326',
'AK50651426',
'AK50526426',
'AK50229426',
'AK50855626',
'AK50647626',
'AK50424726',
'AK50855726',
'AK50099826',
'AK50892926',
'AK49879926',
'AK50171036',
'AK50575036',
'AK49974136',
'AK50537136',
'AK50700336',
'AK50740336',
'AK50284436',
'AK50489436',
'AK50855636',
'AB49585636',
'AK50832936',
'AK50892936',
'AK50313936',
'AK49879936',
'AK49974246',
'AK50739246',
'AK50700346',
'AK50700446',
'AK50284546',
'AK50600646',
'AK50057846',
'AK50892946',
'AK49703946',
'AK49879946',
'AK50699946',
'AK50171056',
'AK49974156',
'AK50700256',
'AK50506356',
'AK48727556',
'AK50525756',
'AK49850856',
'AK50892956',
'AK50224956',
'AK49879956',
'AK50252066',
'AK50537066',
'AK50058066',
'AK50030166',
'AK50684266',
'AK49968266',
'AB49588266',
'AK50700466',
'AK50218466',
'AK50790666',
'AK50525666',
'AK50729766',
'AK50057866',
'AK49879866',
'AK50892966',
'AK50057966',
'AB49589076',
'AB49588176',
'AK50601276',
'AK49859676',
'AK50892976',
'AK50057976',
'AK50088976',
'AK50631186',
'AK50642186',
'AK49974186',
'AK50526286',
'AK50492586',
'AK50581686',
'AB49585686',
'AK50840786',
'AK49879786',
'AK50532886',
'AK49879886',
'AK50313986',
'AK50314096',
'AK50575096',
'AK49818096',
'AK50138096',
'AK49974196',
'AK50631296',
'AK50587396',
'AK50073796',
'AK50592896',
'AK50088896',
'AK49879896',
'AK50699896',
'AK50088996',
'AK50765007',
'AK49818207',
'AK49868307',
'AK50657407',
'AK50156507',
'AK50657507',
'AK50073707',
'AK50543807',
'AK50525807',
'AK50525907',
'AK49879907',
'AK50089117',
'AK50785217',
'AK50916217',
'AK50651317',
'AK50284417',
'AK50488417',
'AB49584617',
'AK50507817',
'AK49879917',
'AK50058027',
'AK50240127',
'AK49818127',
'AK50804227',
'AK50700427',
'AK49585427',
'AK50229427',
'AK50270527',
'AK50198527',
'AB49968627',
'AK50424727',
'AK50099827',
'AK50892927',
'AK50314037',
'AK50526037',
'AK50449037',
'AK49985237',
'AK50518237',
'AK50657437',
'AK50525637',
'AK50709637',
'AK49582737',
'AK49879737',
'AK50543837',
'AK50892937',
'AK50275937',
'AK49026937',
'AK50314047',
'AK50058047',
'AK50651347',
'AK50526447',
'AK50525647',
'AK50478647',
'AK50532947',
'AK50892947',
'AK50873947',
'AK49950157',
'AK50080357',
'AK50218457',
'AK50190657',
'AK50314657',
'AB49589657',
'AK50516757',
'AK49887757',
'AK49879857',
'AK50251957',
'AK50892957',
'AK49879957',
'AK50449167',
'AK50350267',
'AK50700467',
'AK50568467',
'AK50873867',
'AK50057867',
'AK49879867',
'AK50251967',
'AK50892967',
'AK50314077',
'AK50575077',
'AK50224177',
'AK50526277',
'AK50855677',
'AK50478677',
'AB49585777',
'AK50699877',
'AK50892977',
'AK50313977',
'AK50065977',
'AK50314087',
'AK50058087',
'AK50916187',
'AK50796187',
'AK50350387',
'AK50518387',
'AK50600687',
'AK50692987',
'AB49586987',
'AK50488987',
'AK50030097',
'AK49818097',
'AK49974197',
'AK50700297',
'AK50700397',
'AK50284397',
'AK50049597',
'AK50532797',
'AK50855897',
'AK50795897',
'AK49879897',
'AK50448997',
'AK50589108',
'AK50212208',
'AK50700308',
'AK50684408',
'AK50506408',
'AK50526408',
'AK50600708',
'AK50525908',
'AK49879908',
'AK50252018',
'AK50089018',
'AK50916118',
'AK50518118',
'AK49839118',
'AK50212218',
'AK50684218',
'AK50421318',
'AK50157318',
'AK50518318',
'AK50526418',
'AK50284518',
'AK50766618',
'AK49559618',
'AK49879818',
'AK50591028',
'AK50518128',
'AK49974228',
'AK50700328',
'AK50023428',
'AK50212528',
'AK50218528',
'AK50198528',
'AK50600728',
'AK50424728',
'AK50057828',
'AK50251928',
'AK50892928',
'AK50525928',
'AK50171038',
'AK49974138',
'AK49974238',
'AK50700338',
'AK49833338',
'AK50526338',
'AK50350738',
'AK50313938',
'AK49879938',
'AB49590048',
'AK50171048',
'AK50252048',
'AK50700448',
'AK50526448',
'AK50787648',
'AK50057748',
'AK50855848',
'AK50892948',
'AK50795948',
'AK50238948',
'AK50171058',
'AK50574058',
'AK50526058',
'AK51007058',
'AK50030158',
'AK50645158',
'AK49818258',
'AK50840458',
'AK50526458',
'AB49587658',
'AK49879858',
'AK49879958',
'AK50699958',
'AK50171068',
'AK50422068',
'AK49974168',
'AB49585168',
'AK50700268',
'AK49932468',
'AK50263568',
'AB49589568',
'AK50624668',
'AK50855668',
'AK51119668',
'AK50543768',
'AK49879768',
'AK50791868',
'AK49879868',
'AK50252078',
'AK49896078',
'AK50351178',
'AK49818178',
'AK50284478',
'AK50581678',
'AB49588678',
'AK50692878',
'AB49583878',
'AK50525878',
'AB49588878',
'AK49879878',
'AK49935978',
'AK49749978',
'AK50631388',
'AK50532788',
'AK50525988',
'AK50030098',
'AK50843098',
'AK50584098',
'AK49974198',
'AK50284398',
'AK50478598',
'AB49753698',
'AK50306698',
'AK49727698',
'AK49811798',
'AK50543798',
'AK49879798',
'AK50525898',
'AK50795898',
'AK50575009',
'AK50351209',
'AK49974209',
'AK50526209',
'AK49818209',
'AK50700309',
'AK50855609',
'AK50330709',
'AK50190709',
'AK50321909',
'AK50795909',
'AK50088909',
'AK49879909',
'AK50203019',
'AK50526019',
'AK50449019',
'AK50089019',
'AK50820119',
'AK50030119',
'AB49588119',
'AK50089119',
'AK50212219',
'AK49974219',
'AK50270319',
'AK49875319',
'AK50284519',
'AK50855619',
'AK50855719',
'AK49879719',
'AK49879819',
'AK50892919',
'AK50795919',
'AK50466919',
'AK49879919',
'AK50030129',
'AB49590129',
'AK49974129',
'AK50537129',
'AK50212229',
'AK50684329',
'AK50795329',
'AK50700429',
'AK50270429',
'AK50218429',
'AK50229429',
'AK50139429',
'AK50657529',
'AK50543729',
'AK50073729',
'AK50892929',
'AK49974239',
'AK50916239',
'AK49818239',
'AK50700339',
'AB49585339',
'AK50700439',
'AK50657439',
'AK50671539',
'AK50190639',
'AK50154639',
'AK50557739',
'AK50855839',
'AB49585839',
'AK49879839',
'AK50892939',
'AK50057939',
'AK50088939',
'AB49587249',
'AK50700349',
'AK50631349',
'AK50700449',
'AK50478649',
'AK50198649',
'AK50073749',
'AK50525749',
'AK50892949',
'AK50525949',
'AK50057949',
'AK50314059',
'AK50089059',
'AK50631359',
'AB49587459',
'AK50855659',
'AK50198659',
'AK49850859',
'AK50892959',
'AK50525959',
'AK50645069',
'AK49836169',
'AK50138169',
'AK50873369',
'AB49587369',
'AK50243469',
'AB49584469',
'AK50492569',
'AK50465569',
'AK50198669',
'AK49559769',
'AK50543869',
'AK49879869',
'AK50699869',
'AK50251969',
'AK50532969',
'AK50892969',
'AK50916179',
'AK50526379',
'AK50518379',
'AK50657479',
'AK50004679',
'AK50532779',
'AK49879779',
'AK50543879',
'AK49879879',
'AK50892979',
'AK50587489',
'AK50710589',
'AB49585689',
'AK50004789',
'AK49879889',
'AK49666099',
'AK50861199',
'AK49810399',
'AK50270399',
'AK50198599',
'AK50073799',
'AK49879799',
'AK50795899',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20210209_1550_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
