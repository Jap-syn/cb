<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20201014_1000_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK48529040',
'AK47840001',
'AK48190651',
'AK47814781',
'AK47814812',
'AK47840022',
'AK47840032',
'AK48358272',
'AK48554233',
'AK47814773',
'AK47839914',
'AK47839934',
'AK48072464',
'AK48358284',
'AK48554205',
'AK47839905',
'AK47840055',
'AK48461265',
'AK48072475',
'AK47814785',
'AK48529046',
'AK47814846',
'AK48250027',
'AK48190647',
'AK48358577',
'AK47977128',
'AK47840029',
'AK48222349',
'AK47814789',
'AK48333699',
'AK47167270',
'AK47160592',
'AK47187048',
'AK47157615',
'AK46600081',
'AK47102429',
'AK47165562',
'AK47100961',
'AK46509770',
'AK47184917',
'AK47117726',
'AK47169579',
'AK47138606',
'AK47116549',
'AK47157142',
'AK47130567',
'AK47141669',
'AK47139708',
'AK47155191',
'AK47162334',
'AK47150924',
'AK47160958',
'AK44552220',
'AK45038809',
'AK47103204',
'AK47132286',
'AK47160756',
'AK47118677',
'AK47144266',
'AK45704958',
'AK47149730',
'AK47140314',
'AK47114227',
'AK47140040',
'AK47152300',
'AK47107826',
'AK46373485',
'AK46512628',
'AK46541818',
'AK46499127',
'AK46541938',
'AK46590207',
'AK46567091',
'AK46540327',
'AK46597855',
'AK46581058',
'AK46557392',
'AK46594636',
'AK46542577',
'AK46478934',
'AK46700481',
'AK46563140',
'AK46529374',
'AK46556140',
'AK46530015',
'AK46562931',
'AK47165005',
'AK46510086',
'AK47176408',
'AK47143824',
'AK46541385',
'AK46578484',
'AK46550173',
'AK46373846',
'AK46507896',
'AK46371708',
'AK46554058',
'AK46560551',
'AK46556174',
'AK46563748',
'AK46569131',
'AK46567479',
'AK46556253',
'AK46561143',
'AK46555660',
'AK45056207',
'AK46543205',
'AK46603127',
'AK46566235',
'AK47119611',
'AK47169602',
'AK47137891',
'AK47126506',
'AK47127607',
'AK47162330',
'AK47159732',
'AK47116285',
'AK47193734',
'AK47138160',
'AK47141541',
'AK47124887',
'AK47153398',
'AK46569807',
'AK46569798',
'AK46533921',
'AK46556308',
'AK46509650',
'AK46503178',
'AK46538904',
'AK46487261',
'AK46611219',
'AK46602627',
'AK47159052',
'AK47166051',
'AK47155403',
'AK46992783',
'AK47167741',
'AK47156750',
'AK46531978',
'AK46614463',
'AK46545632',
'AK46371662',
'AK46372889',
'AK46510410',
'AK46544521',
'AK46615116',
'AK46539911',
'AK46549674',
'AK46506789',
'AK47176811',
'AK47147931',
'AK47147928',
'AK47139521',
'AK47152056',
'AK47193751',
'AK47154272',
'AK47193753',
'AK47156697',
'AK47116139',
'AK47156010',
'AK47187609',
'AK47100620',
'AK47132999',
'AK47134149',
'AK47134364',
'AK47142070',
'AK47156772',
'AK47185691',
'AK47157274',
'AK47171493',
'AK46579822',
'AK47122310',
'AK47147040',
'AK47153789',
'AK47161934',
'AK47178486',
'AK47161929',
'AK47175925',
'AK47177399',
'AK47109331',
'AK46509243',
'AK47125894',
'AK47155653',
'AK47114399',
'AK47130544',
'AK47127808',
'AK47156373',
'AK47153374',
'AK47156376',
'AK47111562',
'AK47445902',
'AK46556118',
'AK47100832',
'AK45029393',
'AK46488086',
'AK47164590',
'AK47156110',
'AK47162353',
'AK47172553',
'AK47141972',
'AK47110164',
'AK47124007',
'AK47125214',
'AK47167234',
'AK47162538',
'AK47167685',
'AK47154705',
'AK46609496',
'AK46618616',
'AK47170931',
'AK47171607',
'AK46528949',
'AK47104974',
'AK47171554',
'AK47116005',
'AK47122392',
'AK47106408',
'AK47115853',
'AK46509972',
'AK46557128',
'AK47144245',
'AK47165250',
'AK46478843',
'AK47117813',
'AK47147578',
'AK47188440',
'AK47106468',
'AK47113769',
'AK47116836',
'AK47173360',
'AK45728108',
'AK46596267',
'AK47116564',
'AK46489424',
'AK47173478',
'AK46562301',
'AK47161389',
'AK46512560',
'AK45705803',
'AK45739696',
'AK47159723',
'AK47144492',
'AK47139366',
'AK46501674',
'AK47112624',
'AK46615388',
'AK47130033',
'AK46508029',
'AK47153489',
'AK46572167',
'AK47158911',
'AK47147521',
'AK47142995',
'AK47176299',
'AK47155226',
'AK47170528',
'AK47180004',
'AK46523627',
'AK47126182',
'AK47143125',
'AK45652282',
'AK47128235',
'AK46537567',
'AK46519102',
'AK47101018',
'AK45686458',
'AK47137969',
'AK46489378',
'AK46520113',
'AK47171080',
'AK47155069',
'AK47155219',
'AK45660869',
'AK45030045',
'AK47115961',
'AK47118820',
'AK47162586',
'AK47141888',
'AK47163447',
'AK47112410',
'AK47170208',
'AK47141162',
'AK45036484',
'AK45651516',
'AK47144468',
'AK47139634',
'AK47140282',
'AK47186032',
'AK47177310',
'AK47164013',
'AK47165393',
'AK47155924',
'AK47175184',
'AK47153495',
'AK47172078',
'AK47120900',
'AK47143445',
'AK47115889',
'AK47155832',
'AK47151925',
'AK47188736',
'AK47181538',
'AK47167977',
'AK47142806',
'AK47134119',
'AK46475204',
'AK46524000',
'AK46532736',
'AK46532650',
'AK47146878',
'AK47174048',
'AK47110310',
'AK47120905',
'AK47113873',
'AK47168315',
'AK46469787',
'AK47184751',
'AK47162237',
'AK47153293',
'AK47177551',
'AK46528243',
'AK46504202',
'AK46540514',
'AK46564629',
'AK46512677',
'AK46470804',
'AK46543153',
'AK46494988',
'AK46513043',
'AK46475900',
'AK46497899',
'AK46570323',
'AK46514170',
'AK45643524',
'AK47101058',
'AK46591994',
'AK46526538',
'AK46595672',
'AK46506301',
'AK46562446',
'AK46548653',
'AK46569308',
'AK46517720',
'AK46537821',
'AK46520843',
'AK46552307',
'AK46564817',
'AK46372935',
'AK46575086',
'AK46549940',
'AK46498786',
'AK46580764',
'AK46592757',
'AK46700810',
'AK46607011',
'AK46546240',
'AK46549577',
'AK46562228',
'AK46556545',
'AK46540310',
'AK46553509',
'AK46469947',
'AK46493685',
'AK46610856',
'AK46557056',
'AK46557050',
'AK46536732',
'AK46563371',
'AK46554462',
'AK46529055',
'AK46556167',
'AK46545718',
'AK46609350',
'AK46556730',
'AK46536832',
'AK46543274',
'AK46555056',
'AK46562819',
'AK46475936',
'AK46527951',
'AK46548702',
'AK46512506',
'AK46372131',
'AK46508419',
'AK46549164',
'AK47122978',
'AK47160536',
'AK47116427',
'AK47100595',
'AK47118587',
'AK47154212',
'AK47115355',
'AK47177930',
'AK47142179',
'AK45655664',
'AK46577108',
'AK46555871',
'AK46555818',
'AK46535613',
'AK46518163',
'AK47114243',
'AK47171075',
'AK47145667',
'AK47164702',
'AK47106801',
'AK47126058',
'AK46517330',
'AK47103284',
'AK47138843',
'AK47134403',
'AK47180284',
'AK47143805',
'AK47116556',
'AK47175358',
'AK47112666',
'AK47152122',
'AK47166226',
'AK47180362',
'AK47167214',
'AK47104307',
'AK47173873',
'AK47123668',
'AK47150708',
'AK47141861',
'AK47166039',
'AK47117452',
'AK47139033',
'AK47117520',
'AK47140204',
'AK47189145',
'AK47154480',
'AK47157328',
'AK47166360',
'AK47135720',
'AK47169584',
'AK47131601',
'AK47165512',
'AK47166605',
'AK47112857',
'AK47151090',
'AK47109868',
'AK47152611',
'AK47157115',
'AK47152177',
'AK47174522',
'AK47109333',
'AK47111204',
'AK47163198',
'AK47159000',
'AK47161410',
'AK47165253',
'AK47165256',
'AK47144833',
'AK47144645',
'AK47116909',
'AK46510098',
'AK47122179',
'AK47148533',
'AK46482649',
'AK47187340',
'AK47127858',
'AK47123706',
'AK47107949',
'AK47138073',
'AK47180480',
'AK47135933',
'AK47125471',
'AK47188035',
'AK47133598',
'AK47109775',
'AK47101237',
'AK47155494',
'AK47150258',
'AK47188047',
'AK47105544',
'AK47115161',
'AK47172030',
'AK47127450',
'AK47135998',
'AK47156523',
'AK47148274',
'AK47121024',
'AK47160819',
'AK47121589',
'AK47128596',
'AK47145902',
'AK47171628',
'AK47159661',
'AK47155429',
'AK47109280',
'AK47110605',
'AK47141833',
'AK47140627',
'AK47117787',
'AK47139718',
'AK47153163',
'AK47156911',
'AK47166512',
'AK47127221',
'AK47105075',
'AK47174661',
'AK47128497',
'AK47164289',
'AK47124208',
'AK47162154',
'AK47130009',
'AK47162042',
'AK47144873',
'AK47148052',
'AK47163973',
'AK47169939',
'AK47117600',
'AK47125921',
'AK47137062',
'AK47109317',
'AK47130291',
'AK47189169',
'AK47155066',
'AK47141251',
'AK47106480',
'AK47106350',
'AK47116821',
'AK47165374',
'AK47159098',
'AK47167559',
'AK47118717',
'AK47151495',
'AK47157386',
'AK47158377',
'AK47164609',
'AK47150929',
'AK47159124',
'AK47179959',
'AK47129498',
'AK47111600',
'AK47115903',
'AK47136776',
'AK47169805',
'AK47137260',
'AK47126265',
'AK47142749',
'AK46993251',
'AK47125466',
'AK47145614',
'AK47153394',
'AK47133122',
'AK47141914',
'AK47124267',
'AK47167264',
'AK47187346',
'AK47155486',
'AK47153018',
'AK47181869',
'AK47148979',
'AK47114844',
'AK47140664',
'AK47142386',
'AK47142005',
'AK47475708',
'AK47188634',
'AK47105017',
'AK47165066',
'AK47133035',
'AK47139025',
'AK47178772',
'AK47169116',
'AK46513323',
'AK46549937',
'AK46527575',
'AK47124075',
'AK47475706',
'AK46548027',
'AK46470386',
'AK46522696',
'AK47141529',
'AK47114405',
'AK46500574',
'AK46473865',
'AK46635550',
'AK46568768',
'AK47124909',
'AK47171364',
'AK47139626',
'AK47164211',
'AK47169195',
'AK46477571',
'AK47185511',
'AK47177293',
'AK47118822',
'AK47112498',
'AK47145097',
'AK47167197',
'AK47137994',
'AK47155046',
'AK47171030',
'AK47149476',
'AK47174627',
'AK47126344',
'AK47170765',
'AK47138530',
'AK47144444',
'AK46993803',
'AK47163804',
'AK47179985',
'AK47187077',
'AK47172326',
'AK47164646',
'AK47164749',
'AK47135691',
'AK47105093',
'AK47109476',
'AK47152093',
'AK47129210',
'AK47119790',
'AK47142877',
'AK47163896',
'AK47165683',
'AK47143066',
'AK47123637',
'AK47160340',
'AK47117503',
'AK47155297',
'AK47141954',
'AK47108849',
'AK47186792',
'AK47171007',
'AK47142113',
'AK47152202',
'AK47163392',
'AK47179927',
'AK47164948',
'AK47155878',
'AK47103545',
'AK46596537',
'AK47119116',
'AK47193744',
'AK47187067',
'AK47169253',
'AK47151454',
'AK47167675',
'AK47167678',
'AK46515022',
'AK46474143',
'AK46468780',
'AK46543121',
'AK46481678',
'AK47101028',
'AK47155964',
'AK47142305',
'AK47117485',
'AK46546512',
'AK47163396',
'AK47139222',
'AK47122234',
'AK47166167',
'AK47100838',
'AK46555876',
'AK46512563',
'AK46492763',
'AK46500381',
'AK46572309',
'AK46555863',
'AK46489842',
'AK46534812',
'AK45651578',
'AK46582595',
'AK46590365',
'AK46566510',
'AK46555354',
'AK46478303',
'AK47141963',
'AK46519092',
'AK47164905',
'AK47162615',
'AK47141852',
'AK47158652',
'AK47128310',
'AK47106719',
'AK47140598',
'AK47116067',
'AK47170817',
'AK47151851',
'AK47124213',
'AK46534555',
'AK46609508',
'AK46479328',
'AK47164891',
'AK46512294',
'AK47163195',
'AK47163952',
'AK47121640',
'AK47171335',
'AK47159520',
'AK47119715',
'AK47109475',
'AK47169267',
'AK47142899',
'AK47164955',
'AK47114873',
'AK47143016',
'AK46993201',
'AK47138735',
'AK47117002',
'AK47171841',
'AK47164959',
'AK47154473',
'AK46546425',
'AK46593367',
'AK46546726',
'AK46610600',
'AK46515931',
'AK46475631',
'AK46491674',
'AK46475922',
'AK46512355',
'AK46536751',
'AK46570895',
'AK46510542',
'AK46474110',
'AK46573965',
'AK46574404',
'AK46569683',
'AK46500330',
'AK46566682',
'AK46513185',
'AK46502952',
'AK46501189',
'AK46595665',
'AK46555224',
'AK46576049',
'AK46527347',
'AK46612690',
'AK46473815',
'AK46372169',
'AK46512345',
'AK46549947',
'AK46575275',
'AK46540647',
'AK46609248',
'AK46584873',
'AK46579206',
'AK46512370',
'AK46596952',
'AK46572703',
'AK46555586',
'AK46527423',
'AK46513102',
'AK46613710',
'AK46569675',
'AK46528012',
'AK47156082',
'AK47186143',
'AK47175719',
'AK47118300',
'AK47152260',
'AK47155335',
'AK47167188',
'AK47143934',
'AK47140648',
'AK47147062',
'AK47140059',
'AK47177176',
'AK47146609',
'AK47131895',
'AK47167167',
'AK47140683',
'AK46549955',
'AK46478989',
'AK46700046',
'AK46372824',
'AK46582776',
'AK46569373',
'AK46505436',
'AK46556963',
'AK46560375',
'AK46566068',
'AK46549168',
'AK46559833',
'AK46578826',
'AK46564981',
'AK46567499',
'AK46529105',
'AK46559418',
'AK46541671',
'AK46574461',
'AK46477580',
'AK46473561',
'AK46521711',
'AK46587256',
'AK46470758',
'AK46596771',
'AK46529947',
'AK46371990',
'AK46575120',
'AK46563198',
'AK46602983',
'AK46555002',
'AK46556752',
'AK46537855',
'AK46593945',
'AK46617680',
'AK46566602',
'AK46565793',
'AK46571073',
'AK46606489',
'AK46512710',
'AK46547767',
'AK46557214',
'AK46557326',
'AK46486040',
'AK46569550',
'AK46546470',
'AK46483865',
'AK46598095',
'AK46550308',
'AK46549945',
'AK46555395',
'AK46548635',
'AK46564978',
'AK46578503',
'AK46482324',
'AK46526459',
'AK46537805',
'AK46538437',
'AK46556114',
'AK46519065',
'AK46592764',
'AK46601396',
'AK46556135',
'AK46557318',
'AK46508728',
'AK46373441',
'AK46565322',
'AK46469895',
'AK46477104',
'AK47113764',
'AK47142350',
'AK47142405',
'AK47123606',
'AK47164694',
'AK47125824',
'AK47175497',
'AK46569805',
'AK46513514',
'AK46508976',
'AK46496443',
'AK46587319',
'AK46586364',
'AK46543683',
'AK46511856',
'AK46511838',
'AK46530185',
'AK46564846',
'AK46557208',
'AK46469647',
'AK46476164',
'AK46536680',
'AK46556744',
'AK46533297',
'AK46478983',
'AK46546053',
'AK47134371',
'AK47101426',
'AK46549951',
'AK46539706',
'AK46533928',
'AK46473542',
'AK46536114',
'AK46475790',
'AK46585361',
'AK46541592',
'AK47124243',
'AK46538204',
'AK46700090',
'AK46585430',
'AK46588675',
'AK46530415',
'AK46512145',
'AK46559106',
'AK46501539',
'AK46474118',
'AK46620057',
'AK47171260',
'AK47155778',
'AK46568569',
'AK46568046',
'AK46502823',
'AK46511900',
'AK46570301',
'AK46554261',
'AK46568086',
'AK46541075',
'AK46549557',
'AK46557405',
'AK46502029',
'AK46532696',
'AK46528173',
'AK46477376',
'AK46550839',
'AK46555453',
'AK46516000',
'AK46571066',
'AK46543783',
'AK46570333',
'AK46548117',
'AK46592000',
'AK46566644',
'AK46601426',
'AK46568798',
'AK46532720',
'AK46609805',
'AK46532921',
'AK46535108',
'AK46549958',
'AK46491166',
'AK46515400',
'AK46548291',
'AK46568824',
'AK46547865',
'AK46548775',
'AK46562081',
'AK46530422',
'AK46511172',
'AK46554905',
'AK46532708',
'AK46511342',
'AK46536640',
'AK46557042',
'AK46526129',
'AK46473032',
'AK46520852',
'AK46491235',
'AK46477678',
'AK46562305',
'AK46499775',
'AK46528183',
'AK46537382',
'AK46503756',
'AK46478908',
'AK46571809',
'AK46582623',
'AK46530367',
'AK46569638',
'AK46556558',
'AK46566963',
'AK46557854',
'AK46549688',
'AK46603721',
'AK46700449',
'AK46572184',
'AK46553182',
'AK46609819',
'AK46470677',
'AK47143273',
'AK47130884',
'AK47163741',
'AK47163782',
'AK47165054',
'AK47142803',
'AK47134044',
'AK47118227',
'AK47173832',
'AK47174118',
'AK46568025',
'AK47151634',
'AK47140228',
'AK46573344',
'AK46568780',
'AK45702301',
'AK45035762',
'AK46537145',
'AK46372228',
'AK46536081',
'AK47187000',
'AK47152200',
'AK47162200',
'AK47163610',
'AK47163710',
'AK47155710',
'AK47175810',
'AK47175020',
'AK47148020',
'AK47174320',
'AK47166620',
'AK47186820',
'AK47147030',
'AK47163230',
'AK47155230',
'AK47170930',
'AK47170040',
'AK47177040',
'AK47188140',
'AK47155240',
'AK47146240',
'AK47158440',
'AK47171540',
'AK47155740',
'AK47168740',
'AK47166940',
'AK47171450',
'AK47165750',
'AK47176850',
'AK47152060',
'AK47151160',
'AK47149160',
'AK47162260',
'AK47168360',
'AK47164460',
'AK47173560',
'AK47159560',
'AK47157470',
'AK47162870',
'AK47168970',
'AK47148080',
'AK47155380',
'AK47165580',
'AK47192880',
'AK47166980',
'AK47173190',
'AK47174290',
'AK47152490',
'AK47162490',
'AK47148790',
'AK47148001',
'AK47173101',
'AK47155201',
'AK47155501',
'AK47158701',
'AK47179701',
'AK47181801',
'AK47150011',
'AK47160211',
'AK47173311',
'AK47150511',
'AK47185811',
'AK47152321',
'AK47164321',
'AK47166821',
'AK47175921',
'AK47177921',
'AK47157131',
'AK47155231',
'AK47165631',
'AK47168631',
'AK47177731',
'AK47155831',
'AK47187931',
'AK47164041',
'AK47186241',
'AK47149341',
'AK47155451',
'AK47166451',
'AK47167261',
'AK47171861',
'AK47165961',
'AK47148671',
'AK47186971',
'AK47162381',
'AK47163681',
'AK47180981',
'AK47147291',
'AK47154591',
'AK47146202',
'AK47179202',
'AK47164402',
'AK47176802',
'AK47186512',
'AK47165712',
'AK47166812',
'AK47151912',
'AK47162122',
'AK47148122',
'AK47181522',
'AK47160032',
'AK47177032',
'AK47163432',
'AK47187432',
'AK47158432',
'AK47155532',
'AK47185632',
'AK47172732',
'AK47169732',
'AK47146832',
'AK47166932',
'AK47158042',
'AK47165142',
'AK47161442',
'AK47188542',
'AK47179052',
'AK47151152',
'AK47178352',
'AK47185652',
'AK47193752',
'AK47149752',
'AK47150162',
'AK47154162',
'AK47150262',
'AK47155662',
'AK47156662',
'AK47170762',
'AK47176962',
'AK47165072',
'AK47154172',
'AK47186472',
'AK47163572',
'AK47157672',
'AK47179192',
'AK47156692',
'AK47188692',
'AK47188892',
'AK47189303',
'AK47163603',
'AK47164113',
'AK47163313',
'AK47171513',
'AK47161613',
'AK47163713',
'AK47163913',
'AK47168323',
'AK47165623',
'AK47148923',
'AK47185033',
'AK47149233',
'AK47152333',
'AK47184533',
'AK47187533',
'AK47176833',
'AK47170933',
'AK47161933',
'AK47176143',
'AK47157343',
'AK47146443',
'AK47164543',
'AK47156153',
'AK47150253',
'AK47158253',
'AK47188453',
'AK47146553',
'AK47150953',
'AK47158163',
'AK47162363',
'AK47164463',
'AK47167563',
'AK47156663',
'AK47161963',
'AK47163373',
'AK47181673',
'AK47170773',
'AK47146773',
'AK47164973',
'AK47163083',
'AK47175083',
'AK47172283',
'AK47163483',
'AK47149883',
'AK47150983',
'AK47171983',
'AK47152593',
'AK47157693',
'AK47169693',
'AK47162993',
'AK47169004',
'AK47164504',
'AK47180804',
'AK47162414',
'AK47155614',
'AK47166714',
'AK47152024',
'AK47188124',
'AK47162224',
'AK47174224',
'AK47157224',
'AK47159724',
'AK47165234',
'AK47177234',
'AK47158434',
'AK47170044',
'AK47155244',
'AK47157244',
'AK47187644',
'AK47163844',
'AK47163054',
'AK47188054',
'AK47167254',
'AK47156454',
'AK47150754',
'AK47154754',
'AK47153954',
'AK47166064',
'AK47163264',
'AK47166964',
'AK47169964',
'AK47157374',
'AK47187374',
'AK47163874',
'AK47174874',
'AK47189184',
'AK47172284',
'AK47169784',
'AK47146194',
'AK47168494',
'AK47172794',
'AK47171005',
'AK47177405',
'AK47151505',
'AK47186905',
'AK47169015',
'AK47186415',
'AK47178515',
'AK47154615',
'AK47146615',
'AK47151815',
'AK47165915',
'AK47155225',
'AK47149625',
'AK47160925',
'AK47152925',
'AK47186925',
'AK47159925',
'AK47160335',
'AK47164435',
'AK47161835',
'AK47152145',
'AK47189345',
'AK47156645',
'AK47165745',
'AK47166945',
'AK47169945',
'AK47147155',
'AK47181555',
'AK47164555',
'AK47147065',
'AK47166765',
'AK47162175',
'AK47157175',
'AK47166675',
'AK47173775',
'AK47163185',
'AK47152485',
'AK47166885',
'AK47165985',
'AK47155095',
'AK47172295',
'AK47173695',
'AK47186795',
'AK47146895',
'AK47154406',
'AK47156506',
'AK47161116',
'AK47164716',
'AK47152426',
'AK47167426',
'AK47178526',
'AK47154036',
'AK47155036',
'AK47177036',
'AK47152136',
'AK47152236',
'AK47153536',
'AK47187636',
'AK47165246',
'AK47157646',
'AK47151056',
'AK47159256',
'AK47166756',
'AK47163066',
'AK47154166',
'AK47155366',
'AK47153766',
'AK47171376',
'AK47166086',
'AK47164686',
'AK47171886',
'AK47154296',
'AK47147596',
'AK47165696',
'AK47164996',
'AK47169007',
'AK47157507',
'AK47152607',
'AK47163607',
'AK47150017',
'AK47161517',
'AK47171517',
'AK47152917',
'AK47189327',
'AK47171037',
'AK47167037',
'AK47163737',
'AK47156047',
'AK47158347',
'AK47155847',
'AK47162947',
'AK47154357',
'AK47157557',
'AK47193757',
'AK47164167',
'AK47167267',
'AK47161367',
'AK47156367',
'AK47165567',
'AK47155867',
'AK47167177',
'AK47155477',
'AK47175877',
'AK47150587',
'AK47163787',
'AK47178887',
'AK47152197',
'AK47161497',
'AK47154997',
'AK47152008',
'AK47165008',
'AK47187008',
'AK47186608',
'AK47151808',
'AK47159808',
'AK47158818',
'AK47160028',
'AK47153128',
'AK47152328',
'AK47166628',
'AK47166728',
'AK47150538',
'AK47186638',
'AK47155448',
'AK47175448',
'AK47163648',
'AK47180058',
'AK47147258',
'AK47153358',
'AK47170458',
'AK47166658',
'AK47163758',
'AK47146858',
'AK47156858',
'AK47151168',
'AK47146168',
'AK47154268',
'AK47163468',
'AK47180568',
'AK47150668',
'AK47165278',
'AK47179578',
'AK47153678',
'AK47163778',
'AK47175188',
'AK47185288',
'AK47181388',
'AK47153388',
'AK47167388',
'AK47187388',
'AK47148488',
'AK47188488',
'AK47162788',
'AK47150888',
'AK47155198',
'AK47150298',
'AK47176298',
'AK47167298',
'AK47148298',
'AK47162598',
'AK47153009',
'AK47189209',
'AK47152309',
'AK47173409',
'AK47148409',
'AK47177509',
'AK47157609',
'AK47162909',
'AK47156019',
'AK47175219',
'AK47167319',
'AK47179419',
'AK47161129',
'AK47149129',
'AK47179229',
'AK47152529',
'AK47158829',
'AK47154039',
'AK47154239',
'AK47173739',
'AK47165939',
'AK47162149',
'AK47148249',
'AK47172849',
'AK47155259',
'AK47173559',
'AK47151659',
'AK47169659',
'AK47193759',
'AK47168859',
'AK47150959',
'AK47160269',
'AK47170569',
'AK47160669',
'AK47186969',
'AK47188579',
'AK47169679',
'AK47177889',
'AK47165989',
'AK47186989',
'AK47167989',
'AK47156299',
'AK47158599',
'AK47146699',
'AK47147799',
'AK47154899',
'AK47155899',
'AK47142265',
'AK47144100',
'AK47141500',
'AK47140220',
'AK47142220',
'AK47140320',
'AK47140620',
'AK47117230',
'AK47127230',
'AK47140140',
'AK47142140',
'AK47118460',
'AK47138460',
'AK47140560',
'AK47106660',
'AK47130760',
'AK47137960',
'AK47122170',
'AK47141570',
'AK47140080',
'AK47141080',
'AK47139080',
'AK47135280',
'AK47141580',
'AK47141680',
'AK47104680',
'AK47127090',
'AK47103290',
'AK47141390',
'AK47140201',
'AK47117301',
'AK47131501',
'AK47114701',
'AK47141511',
'AK47143511',
'AK47141911',
'AK47124121',
'AK47112621',
'AK47136621',
'AK47142031',
'AK47139231',
'AK47104531',
'AK47101041',
'AK47117041',
'AK47116141',
'AK47142241',
'AK47136241',
'AK47140841',
'AK47136151',
'AK47116061',
'AK47140261',
'AK47139461',
'AK47125561',
'AK47131861',
'AK47111171',
'AK47122271',
'AK47136271',
'AK47103471',
'AK47116671',
'AK47134281',
'AK47139981',
'AK47118291',
'AK47103791',
'AK47144891',
'AK47141991',
'AK47105991',
'AK47107202',
'AK47106402',
'AK47142712',
'AK47141222',
'AK47115322',
'AK47117822',
'AK47109232',
'AK47140332',
'AK47124332',
'AK47118332',
'AK47124832',
'AK47117142',
'AK47107242',
'AK47118242',
'AK47108342',
'AK47121442',
'AK47142642',
'AK47131942',
'AK47126052',
'AK47142352',
'AK47103552',
'AK47136552',
'AK47142752',
'AK47144952',
'AK47139952',
'AK47127562',
'AK47102962',
'AK47122962',
'AK47138072',
'AK47102272',
'AK47140372',
'AK47139972',
'AK47142382',
'AK47118382',
'AK47134482',
'AK47105582',
'AK47141782',
'AK47116882',
'AK47130092',
'AK47141192',
'AK47115692',
'AK47138003',
'AK47113103',
'AK47133203',
'AK47106303',
'AK47125603',
'AK47117803',
'AK47124013',
'AK47106413',
'AK47126413',
'AK47117613',
'AK47102713',
'AK47117713',
'AK47104813',
'AK47142913',
'AK47143123',
'AK47116523',
'AK47107033',
'AK47141533',
'AK47108533',
'AK47140733',
'AK47113733',
'AK47143733',
'AK47142833',
'AK47144443',
'AK47115543',
'AK47142743',
'AK47141843',
'AK47145153',
'AK47105453',
'AK47118453',
'AK47128753',
'AK47114853',
'AK47118063',
'AK47127363',
'AK47138463',
'AK47129763',
'AK47127863',
'AK47137863',
'AK47142073',
'AK47142173',
'AK47144173',
'AK47141873',
'AK47135283',
'AK47135883',
'AK47139193',
'AK47133204',
'AK47120704',
'AK47144704',
'AK47137804',
'AK47111914',
'AK47117024',
'AK47142424',
'AK47140524',
'AK47106724',
'AK47127724',
'AK47140134',
'AK47143134',
'AK47104734',
'AK47125734',
'AK47129734',
'AK47119934',
'AK47140144',
'AK47118444',
'AK47140544',
'AK47116744',
'AK47141944',
'AK47143054',
'AK47144054',
'AK47140154',
'AK47141254',
'AK47142254',
'AK47142354',
'AK47114454',
'AK47106454',
'AK47144554',
'AK47106754',
'AK47112074',
'AK47105774',
'AK47138974',
'AK47122084',
'AK47137484',
'AK47128484',
'AK47138594',
'AK47118794',
'AK47104005',
'AK47140105',
'AK47137205',
'AK47130405',
'AK47142115',
'AK47115315',
'AK47115815',
'AK47140125',
'AK47124325',
'AK47107325',
'AK47140725',
'AK47142725',
'AK47108725',
'AK47109725',
'AK47141335',
'AK47141435',
'AK47118435',
'AK47124345',
'AK47117945',
'AK47110155',
'AK47142855',
'AK47140275',
'AK47136375',
'AK47108375',
'AK47119675',
'AK47144775',
'AK47140385',
'AK47127985',
'AK47140095',
'AK47126195',
'AK47144395',
'AK47145495',
'AK47124895',
'AK47115206',
'AK47102506',
'AK47100606',
'AK47141806',
'AK47124906',
'AK47140416',
'AK47142516',
'AK47139616',
'AK47120716',
'AK47110816',
'AK47106126',
'AK47126226',
'AK47134326',
'AK47111726',
'AK47102726',
'AK47112036',
'AK47102536',
'AK47143836',
'AK47143146',
'AK47132246',
'AK47107346',
'AK47143156',
'AK47129456',
'AK47125656',
'AK47108756',
'AK47102856',
'AK47140066',
'AK47141466',
'AK47105566',
'AK47101076',
'AK47141276',
'AK47117276',
'AK47138476',
'AK47136086',
'AK47141186',
'AK47133586',
'AK47114986',
'AK47140396',
'AK47144396',
'AK47102496',
'AK47144596',
'AK47138696',
'AK47127996',
'AK47118207',
'AK47143507',
'AK47142607',
'AK47140317',
'AK47131517',
'AK47101817',
'AK47126817',
'AK47144137',
'AK47126637',
'AK47140937',
'AK47106047',
'AK47127047',
'AK47141247',
'AK47132347',
'AK47104547',
'AK47116057',
'AK47144157',
'AK47138157',
'AK47139157',
'AK47128257',
'AK47131757',
'AK47115757',
'AK47142857',
'AK47137957',
'AK47114167',
'AK47116167',
'AK47107267',
'AK47142467',
'AK47135567',
'AK47142667',
'AK47107177',
'AK47142377',
'AK47144377',
'AK47141477',
'AK47118577',
'AK47141777',
'AK47119087',
'AK47143187',
'AK47125187',
'AK47139287',
'AK47140987',
'AK47142987',
'AK47134987',
'AK47140197',
'AK47122497',
'AK47130797',
'AK47144797',
'AK47122897',
'AK47128897',
'AK47141997',
'AK47134997',
'AK47118108',
'AK47121808',
'AK47141908',
'AK47118218',
'AK47115418',
'AK47113618',
'AK47126618',
'AK47141818',
'AK47108818',
'AK47129918',
'AK47142128',
'AK47102928',
'AK47144048',
'AK47120448',
'AK47103548',
'AK47121848',
'AK47141658',
'AK47117168',
'AK47128168',
'AK47140468',
'AK47121468',
'AK47140868',
'AK47143278',
'AK47102778',
'AK47143878',
'AK47115878',
'AK47108288',
'AK47140588',
'AK47134888',
'AK47123098',
'AK47138598',
'AK47119598',
'AK47138409',
'AK47117509',
'AK47107609',
'AK47105709',
'AK47109619',
'AK47139919',
'AK47144129',
'AK47101629',
'AK47141629',
'AK47144729',
'AK47136829',
'AK47101929',
'AK47141239',
'AK47142339',
'AK47140439',
'AK47138439',
'AK47141939',
'AK47144149',
'AK47120349',
'AK47116449',
'AK47108449',
'AK47141749',
'AK47141059',
'AK47139959',
'AK47143069',
'AK47112569',
'AK47122569',
'AK47101669',
'AK47105669',
'AK47115869',
'AK47137079',
'AK47119179',
'AK47102379',
'AK47102479',
'AK47143089',
'AK47125689',
'AK47114889',
'AK47106399',
'AK47114599',
'AK46992940',
'AK46992790',
'AK46992432',
'AK46993072',
'AK46992553',
'AK46992583',
'AK46993793',
'AK46993934',
'AK46993305',
'AK46992656',
'AK46993538',
'AK46993198',
'AK46992319',
'AK46993149',
'AK46994623',
'AK46993937',
'AK47166481',
'AK47193747',
'AK47193048',
'AK47166455',
'AK46488441',
'AK46533576',
'AK46600343',
'AK46533609',
'AK47104790',
'AK47172515',
'AK47108926',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20201014_1000_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
