<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20201111_1445_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK45640370',
'AK45727434',
'AK46468920',
'AK46489914',
'AK46506092',
'AK46554593',
'AK47133338',
'AK47144675',
'AK47145809',
'AK47154133',
'AK47161907',
'AK47169136',
'AK47924469',
'AK47924754',
'AK47924807',
'AK47924851',
'AK47924976',
'AK47925075',
'AK47925153',
'AK47925248',
'AK47925423',
'AK47925856',
'AK47925994',
'AK47926011',
'AK47926218',
'AK47926290',
'AK47926640',
'AK47926650',
'AK47926723',
'AK47927222',
'AK47927658',
'AK47927761',
'AK47927898',
'AK47928058',
'AK47928075',
'AK47928343',
'AK47928390',
'AK47928655',
'AK47928665',
'AK47928668',
'AK47928723',
'AK47928804',
'AK47929100',
'AK47929242',
'AK47929263',
'AK47929296',
'AK47929422',
'AK47929437',
'AK47929589',
'AK47929624',
'AK47929709',
'AK47929764',
'AK47929965',
'AK47930393',
'AK47930399',
'AK47930576',
'AK47930579',
'AK47930636',
'AK47930951',
'AK47931251',
'AK47931360',
'AK47931494',
'AK47932156',
'AK47932223',
'AK47932672',
'AK47932799',
'AK47933220',
'AK47933360',
'AK47933400',
'AK47933569',
'AK47933773',
'AK47934111',
'AK47934318',
'AK47934342',
'AK47934657',
'AK47934870',
'AK47935237',
'AK47935356',
'AK47935363',
'AK47935549',
'AK47935563',
'AK47935630',
'AK47935663',
'AK47935686',
'AK47936073',
'AK47936203',
'AK47936513',
'AK47936725',
'AK47936770',
'AK47936775',
'AK47936912',
'AK47936946',
'AK47936952',
'AK47937051',
'AK47937063',
'AK47937319',
'AK47937327',
'AK47937340',
'AK47937366',
'AK47937523',
'AK47937563',
'AK47937573',
'AK47937684',
'AK47937880',
'AK47937912',
'AK47937940',
'AK47938045',
'AK47938187',
'AK47938492',
'AK47938756',
'AK47938815',
'AK47938903',
'AK47938955',
'AK47939142',
'AK47939190',
'AK47939256',
'AK47939534',
'AK47939578',
'AK47939582',
'AK47939604',
'AK47939633',
'AK47939706',
'AK47939738',
'AK47940226',
'AK47940283',
'AK47940287',
'AK47940314',
'AK47940405',
'AK47940444',
'AK47940544',
'AK47940548',
'AK47940563',
'AK47940616',
'AK47940630',
'AK47940655',
'AK47940687',
'AK47940841',
'AK47940895',
'AK47940961',
'AK47941010',
'AK47941016',
'AK47941030',
'AK47941058',
'AK47941104',
'AK47941110',
'AK47941118',
'AK47941211',
'AK47941580',
'AK47941681',
'AK47941761',
'AK47941911',
'AK47942285',
'AK47942317',
'AK47942610',
'AK47943046',
'AK47943376',
'AK47943488',
'AK47943626',
'AK47943963',
'AK47944053',
'AK47944114',
'AK47944188',
'AK47944201',
'AK47944209',
'AK47944243',
'AK47944244',
'AK47944249',
'AK47944250',
'AK47944288',
'AK47944334',
'AK47944345',
'AK47944400',
'AK47944405',
'AK47944429',
'AK47944439',
'AK47944456',
'AK47944458',
'AK47944470',
'AK47944479',
'AK47944481',
'AK47944491',
'AK47944502',
'AK47944503',
'AK47944519',
'AK47944520',
'AK47944557',
'AK47944590',
'AK47944616',
'AK47944713',
'AK47944819',
'AK47944831',
'AK47945118',
'AK47945210',
'AK47945285',
'AK47945301',
'AK47945635',
'AK47945808',
'AK47945894',
'AK47946048',
'AK47946096',
'AK47946172',
'AK47946191',
'AK47946228',
'AK47946303',
'AK47946307',
'AK47946467',
'AK47946468',
'AK47946569',
'AK47946627',
'AK47946649',
'AK47946780',
'AK47946879',
'AK47947023',
'AK47947052',
'AK47947076',
'AK47947127',
'AK47947141',
'AK47947175',
'AK47947268',
'AK47947405',
'AK47947453',
'AK47947549',
'AK47947565',
'AK47947651',
'AK47947758',
'AK47947795',
'AK47947889',
'AK47947914',
'AK47947970',
'AK47947980',
'AK47948056',
'AK47948080',
'AK47948168',
'AK47948270',
'AK47948445',
'AK47948640',
'AK47948989',
'AK47949123',
'AK47949158',
'AK47949225',
'AK47949229',
'AK47949240',
'AK47949242',
'AK47949275',
'AK47949278',
'AK47949468',
'AK47949498',
'AK47949595',
'AK47949861',
'AK47950130',
'AK47950160',
'AK47950177',
'AK47950311',
'AK47950374',
'AK47950529',
'AK47950583',
'AK47950735',
'AK47950788',
'AK47951149',
'AK47951246',
'AK47951364',
'AK47951587',
'AK47951607',
'AK47951667',
'AK47951685',
'AK47951702',
'AK47951734',
'AK47951818',
'AK47951833',
'AK47951842',
'AK47952359',
'AK47952485',
'AK47952493',
'AK47952505',
'AK47952519',
'AK47952610',
'AK47952781',
'AK47953116',
'AK47953122',
'AK47953169',
'AK47953326',
'AK47953387',
'AK47953407',
'AK47953455',
'AK47953483',
'AK47954093',
'AK47954282',
'AK47954617',
'AK47954768',
'AK47954825',
'AK47954914',
'AK47954932',
'AK47955188',
'AK47955331',
'AK47955425',
'AK47955810',
'AK47956176',
'AK47956229',
'AK47956354',
'AK47956521',
'AK47956543',
'AK47956893',
'AK47957305',
'AK47957366',
'AK47957383',
'AK47957436',
'AK47957583',
'AK47957697',
'AK47957969',
'AK47958672',
'AK47958922',
'AK47958968',
'AK47959083',
'AK47959193',
'AK47959608',
'AK47959823',
'AK47959833',
'AK47959842',
'AK47960061',
'AK47961000',
'AK47961036',
'AK47961091',
'AK47961138',
'AK47961195',
'AK47962943',
'AK47963328',
'AK47963656',
'AK47963714',
'AK47963799',
'AK47964045',
'AK47964236',
'AK47965147',
'AK47965324',
'AK47965548',
'AK47965600',
'AK47965679',
'AK47965746',
'AK47965837',
'AK47965866',
'AK47965881',
'AK47965938',
'AK47965941',
'AK47965979',
'AK47965995',
'AK47966064',
'AK47966086',
'AK47966231',
'AK47966312',
'AK47966325',
'AK47966339',
'AK47966351',
'AK47966398',
'AK47966409',
'AK47966549',
'AK47966563',
'AK47966596',
'AK47966783',
'AK47967006',
'AK47967139',
'AK47967158',
'AK47967999',
'AK47968075',
'AK47968130',
'AK47968294',
'AK47968301',
'AK47968722',
'AK47968742',
'AK47968816',
'AK47969001',
'AK47969003',
'AK47969105',
'AK47969256',
'AK47969520',
'AK47969801',
'AK47969903',
'AK47969936',
'AK47970076',
'AK47970170',
'AK47970219',
'AK47970351',
'AK47970680',
'AK47970941',
'AK47971013',
'AK47971062',
'AK47971081',
'AK47971094',
'AK47971103',
'AK47971167',
'AK47971734',
'AK47971791',
'AK47971888',
'AK47971949',
'AK47972160',
'AK47972378',
'AK47972427',
'AK47972665',
'AK47972713',
'AK47972748',
'AK47972881',
'AK47972957',
'AK47973196',
'AK47973216',
'AK47973251',
'AK47973317',
'AK47973510',
'AK47973619',
'AK47973654',
'AK47974268',
'AK47974283',
'AK47974603',
'AK47974624',
'AK47974653',
'AK47974713',
'AK47974752',
'AK47974782',
'AK47974909',
'AK47975062',
'AK47975303',
'AK47975401',
'AK47975413',
'AK47975630',
'AK47975754',
'AK47975835',
'AK47976113',
'AK47976132',
'AK47976258',
'AK47976407',
'AK47976620',
'AK47976663',
'AK47976809',
'AK47976863',
'AK47976925',
'AK47977081',
'AK47977094',
'AK47977133',
'AK47977165',
'AK47977218',
'AK47977225',
'AK47977463',
'AK47977486',
'AK47977522',
'AK47977573',
'AK47977738',
'AK47978245',
'AK47978256',
'AK47978514',
'AK47978593',
'AK47978656',
'AK47978676',
'AK47979113',
'AK47979131',
'AK47979214',
'AK47979246',
'AK47979390',
'AK47979463',
'AK47979612',
'AK47979721',
'AK47979900',
'AK47980096',
'AK47980108',
'AK47980660',
'AK47980732',
'AK47980872',
'AK47980923',
'AK47980962',
'AK47980976',
'AK47981009',
'AK47981059',
'AK47981228',
'AK47981529',
'AK47981610',
'AK47982057',
'AK47982164',
'AK47983262',
'AK47983778',
'AK47983956',
'AK47983981',
'AK47984366',
'AK47984643',
'AK47984926',
'AK47985122',
'AK47985430',
'AK47985711',
'AK47985732',
'AK47985823',
'AK47985869',
'AK47985924',
'AK47985951',
'AK47986002',
'AK47986038',
'AK47986647',
'AK47987168',
'AK47987768',
'AK47987900',
'AK47987952',
'AK47987982',
'AK47988027',
'AK47989096',
'AK47989809',
'AK47990443',
'AK47990610',
'AK47990689',
'AK47991237',
'AK47991324',
'AK47991331',
'AK47991635',
'AK47992510',
'AK47992513',
'AK47992520',
'AK47992529',
'AK47992589',
'AK47992859',
'AK47992864',
'AK47992935',
'AK47992984',
'AK47993055',
'AK47993073',
'AK47993078',
'AK47993225',
'AK47993275',
'AK47993564',
'AK47993636',
'AK47993881',
'AK47994154',
'AK47994239',
'AK47994336',
'AK47994522',
'AK47994551',
'AK47994639',
'AK47994662',
'AK47994882',
'AK47994978',
'AK47995099',
'AK47995173',
'AK47995264',
'AK47995306',
'AK47995507',
'AK47995678',
'AK47995737',
'AK47995889',
'AK47995897',
'AK47995909',
'AK47996107',
'AK47996364',
'AK47996458',
'AK47996550',
'AK47996675',
'AK47996734',
'AK47996881',
'AK47997071',
'AK47997252',
'AK47997520',
'AK47997542',
'AK47997549',
'AK47997942',
'AK47997959',
'AK47997967',
'AK47998094',
'AK47998167',
'AK47998206',
'AK47998304',
'AK47998337',
'AK47998339',
'AK47998389',
'AK47998503',
'AK47998661',
'AK47999018',
'AK47999307',
'AK47999452',
'AK47999590',
'AK48000154',
'AK48000453',
'AK48000657',
'AK48000740',
'AK48000745',
'AK48000903',
'AK48000925',
'AK48000949',
'AK48000963',
'AK48000964',
'AK48000980',
'AK48001036',
'AK48001059',
'AK48001066',
'AK48001101',
'AK48001107',
'AK48001111',
'AK48001195',
'AK48001264',
'AK48001331',
'AK48001365',
'AK48001412',
'AK48001467',
'AK48001474',
'AK48001519',
'AK48001541',
'AK48001626',
'AK48001638',
'AK48001666',
'AK48001695',
'AK48001714',
'AK48001726',
'AK48001762',
'AK48001777',
'AK48001823',
'AK48001833',
'AK48001837',
'AK48001866',
'AK48001903',
'AK48001935',
'AK48001977',
'AK48001980',
'AK48002015',
'AK48002024',
'AK48002047',
'AK48002111',
'AK48002134',
'AK48002139',
'AK48002193',
'AK48002208',
'AK48002225',
'AK48002254',
'AK48002259',
'AK48002357',
'AK48002389',
'AK48002405',
'AK48002462',
'AK48002478',
'AK48002551',
'AK48002598',
'AK48002632',
'AK48002710',
'AK48002721',
'AK48002798',
'AK48002866',
'AK48002931',
'AK48002940',
'AK48002942',
'AK48003100',
'AK48003128',
'AK48003156',
'AK48003317',
'AK48003479',
'AK48003489',
'AK48003562',
'AK48003757',
'AK48003919',
'AK48003969',
'AK48004430',
'AK48004579',
'AK48004593',
'AK48004900',
'AK48004987',
'AK48005096',
'AK48005243',
'AK48005543',
'AK48005985',
'AK48006088',
'AK48006093',
'AK48006320',
'AK48006558',
'AK48006763',
'AK48006975',
'AK48007168',
'AK48007283',
'AK48007533',
'AK48007539',
'AK48007546',
'AK48007712',
'AK48007758',
'AK48007786',
'AK48007923',
'AK48007950',
'AK48007953',
'AK48007956',
'AK48008078',
'AK48008136',
'AK48008144',
'AK48008153',
'AK48008197',
'AK48008387',
'AK48008412',
'AK48008418',
'AK48008597',
'AK48008634',
'AK48008894',
'AK48009096',
'AK48009224',
'AK48009282',
'AK48009309',
'AK48009349',
'AK48009425',
'AK48009544',
'AK48009610',
'AK48009728',
'AK48009734',
'AK48009874',
'AK48009883',
'AK48009893',
'AK48009952',
'AK48010057',
'AK48010076',
'AK48010313',
'AK48010337',
'AK48010425',
'AK48010522',
'AK48010571',
'AK48010574',
'AK48010665',
'AK48010823',
'AK48011063',
'AK48011080',
'AK48011087',
'AK48011114',
'AK48011184',
'AK48011207',
'AK48011220',
'AK48011226',
'AK48011360',
'AK48011370',
'AK48011443',
'AK48011549',
'AK48011660',
'AK48011663',
'AK48011674',
'AK48011745',
'AK48011759',
'AK48011849',
'AK48011852',
'AK48011857',
'AK48011868',
'AK48012022',
'AK48012146',
'AK48012224',
'AK48012360',
'AK48012430',
'AK48012457',
'AK48012472',
'AK48012558',
'AK48012621',
'AK48012711',
'AK48012993',
'AK48013169',
'AK48013211',
'AK48013260',
'AK48013346',
'AK48013352',
'AK48013432',
'AK48013746',
'AK48013786',
'AK48013953',
'AK48014041',
'AK48014212',
'AK48014541',
'AK48014545',
'AK48014650',
'AK48014757',
'AK48014765',
'AK48014905',
'AK48015147',
'AK48015176',
'AK48015553',
'AK48015617',
'AK48015676',
'AK48015748',
'AK48016162',
'AK48016190',
'AK48016210',
'AK48016306',
'AK48016418',
'AK48016610',
'AK48016976',
'AK48017164',
'AK48017453',
'AK48017809',
'AK48017839',
'AK48017878',
'AK48017917',
'AK48018044',
'AK48018045',
'AK48018254',
'AK48018463',
'AK48018599',
'AK48018649',
'AK48018674',
'AK48018678',
'AK48018773',
'AK48018875',
'AK48019117',
'AK48019266',
'AK48019273',
'AK48019343',
'AK48019432',
'AK48019438',
'AK48019511',
'AK48019618',
'AK48019747',
'AK48020000',
'AK48020075',
'AK48020079',
'AK48020115',
'AK48020128',
'AK48020196',
'AK48020268',
'AK48020382',
'AK48020392',
'AK48020419',
'AK48020436',
'AK48020506',
'AK48020523',
'AK48020641',
'AK48020669',
'AK48020711',
'AK48020808',
'AK48020950',
'AK48021033',
'AK48021098',
'AK48021159',
'AK48021208',
'AK48021270',
'AK48021380',
'AK48021390',
'AK48021623',
'AK48021644',
'AK48021798',
'AK48021809',
'AK48021913',
'AK48021956',
'AK48022096',
'AK48022292',
'AK48022353',
'AK48022400',
'AK48022408',
'AK48022509',
'AK48022528',
'AK48022552',
'AK48022597',
'AK48022733',
'AK48022822',
'AK48022895',
'AK48022929',
'AK48022933',
'AK48023004',
'AK48023085',
'AK48023172',
'AK48023189',
'AK48023190',
'AK48023192',
'AK48023199',
'AK48023205',
'AK48023213',
'AK48023226',
'AK48023234',
'AK48023241',
'AK48023278',
'AK48023306',
'AK48023327',
'AK48023374',
'AK48023389',
'AK48023423',
'AK48023462',
'AK48023522',
'AK48023548',
'AK48023585',
'AK48023621',
'AK48023686',
'AK48023717',
'AK48023722',
'AK48023723',
'AK48023858',
'AK48023862',
'AK48023866',
'AK48023871',
'AK48023908',
'AK48023911',
'AK48023924',
'AK48023936',
'AK48024047',
'AK48024060',
'AK48024063',
'AK48024067',
'AK48024070',
'AK48024084',
'AK48024091',
'AK48024143',
'AK48024148',
'AK48024179',
'AK48024181',
'AK48024205',
'AK48024296',
'AK48024367',
'AK48024368',
'AK48024381',
'AK48024457',
'AK48024490',
'AK48024494',
'AK48024528',
'AK48024543',
'AK48024549',
'AK48024554',
'AK48024719',
'AK48024724',
'AK48024751',
'AK48024782',
'AK48024805',
'AK48024931',
'AK48024998',
'AK48025009',
'AK48025025',
'AK48025044',
'AK48025127',
'AK48025163',
'AK48025218',
'AK48025231',
'AK48025233',
'AK48025240',
'AK48025251',
'AK48025265',
'AK48025278',
'AK48025281',
'AK48025300',
'AK48025321',
'AK48025341',
'AK48025344',
'AK48025376',
'AK48025427',
'AK48025440',
'AK48025450',
'AK48025522',
'AK48025532',
'AK48025547',
'AK48025619',
'AK48025645',
'AK48025665',
'AK48025713',
'AK48025764',
'AK48025791',
'AK48026011',
'AK48026030',
'AK48026038',
'AK48026049',
'AK48026118',
'AK48026143',
'AK48026144',
'AK48026147',
'AK48026155',
'AK48026201',
'AK48026254',
'AK48026275',
'AK48026278',
'AK48026292',
'AK48026402',
'AK48026609',
'AK48026661',
'AK48026861',
'AK48026875',
'AK48027065',
'AK48027103',
'AK48027113',
'AK48027433',
'AK48027510',
'AK48027516',
'AK48027605',
'AK48027619',
'AK48027667',
'AK48027704',
'AK48027834',
'AK48027923',
'AK48027961',
'AK48027996',
'AK48028089',
'AK48028130',
'AK48028253',
'AK48028257',
'AK48028339',
'AK48028389',
'AK48028406',
'AK48028409',
'AK48028467',
'AK48028555',
'AK48028568',
'AK48028589',
'AK48028592',
'AK48028597',
'AK48028658',
'AK48028686',
'AK48028804',
'AK48028817',
'AK48028898',
'AK48028930',
'AK48029018',
'AK48029031',
'AK48029080',
'AK48029110',
'AK48029119',
'AK48029386',
'AK48029425',
'AK48029448',
'AK48029503',
'AK48029534',
'AK48029693',
'AK48029708',
'AK48029710',
'AK48029732',
'AK48029743',
'AK48029748',
'AK48029824',
'AK48029975',
'AK48029995',
'AK48030075',
'AK48030095',
'AK48030103',
'AK48030123',
'AK48030134',
'AK48030160',
'AK48030418',
'AK48030505',
'AK48030654',
'AK48031055',
'AK48031258',
'AK48031389',
'AK48031465',
'AK48031783',
'AK48031833',
'AK48032401',
'AK48033509',
'AK48033817',
'AK48033906',
'AK48033912',
'AK48033925',
'AK48033992',
'AK48033993',
'AK48034011',
'AK48034069',
'AK48034114',
'AK48034143',
'AK48034157',
'AK48034207',
'AK48034307',
'AK48034341',
'AK48034344',
'AK48034405',
'AK48034501',
'AK48034666',
'AK48034668',
'AK48034785',
'AK48034834',
'AK48034866',
'AK48035222',
'AK48035245',
'AK48035308',
'AK48035341',
'AK48035447',
'AK48035819',
'AK48036176',
'AK48036305',
'AK48036332',
'AK48036504',
'AK48036510',
'AK48036801',
'AK48036806',
'AK48036808',
'AK48036868',
'AK48036968',
'AK48037083',
'AK48037115',
'AK48037187',
'AK48037303',
'AK48037312',
'AK48037386',
'AK48037455',
'AK48037503',
'AK48037583',
'AK48037632',
'AK48037656',
'AK48037732',
'AK48037741',
'AK48037840',
'AK48037844',
'AK48038038',
'AK48038040',
'AK48038043',
'AK48038111',
'AK48038168',
'AK48038244',
'AK48038275',
'AK48038279',
'AK48038409',
'AK48038437',
'AK48038456',
'AK48038472',
'AK48038747',
'AK48039053',
'AK48039135',
'AK48039366',
'AK48039377',
'AK48039399',
'AK48039408',
'AK48039601',
'AK48039948',
'AK48040172',
'AK48040187',
'AK48040295',
'AK48040324',
'AK48040335',
'AK48040389',
'AK48040696',
'AK48040754',
'AK48040777',
'AK48040796',
'AK48040966',
'AK48040998',
'AK48041056',
'AK48041245',
'AK48041507',
'AK48041603',
'AK48042419',
'AK48042484',
'AK48042796',
'AK48042887',
'AK48043023',
'AK48044061',
'AK48044386',
'AK48044644',
'AK48044861',
'AK48045157',
'AK48045587',
'AK48045693',
'AK48046245',
'AK48046791',
'AK48046837',
'AK48047105',
'AK48047228',
'AK48047531',
'AK48047546',
'AK48047856',
'AK48048367',
'AK48048692',
'AK48048741',
'AK48049101',
'AK48049242',
'AK48049521',
'AK48049817',
'AK48050614',
'AK48050665',
'AK48051276',
'AK48051309',
'AK48051324',
'AK48051405',
'AK48051611',
'AK48051705',
'AK48051976',
'AK48052088',
'AK48052097',
'AK48052198',
'AK48052393',
'AK48052872',
'AK48053045',
'AK48053485',
'AK48053487',
'AK48053513',
'AK48053553',
'AK48053618',
'AK48053712',
'AK48053739',
'AK48053865',
'AK48053947',
'AK48053982',
'AK48054462',
'AK48054592',
'AK48055251',
'AK48055267',
'AK48055558',
'AK48055570',
'AK48055615',
'AK48055628',
'AK48055685',
'AK48055688',
'AK48055730',
'AK48055848',
'AK48055983',
'AK48056505',
'AK48056536',
'AK48057006',
'AK48057420',
'AK48057537',
'AK48057692',
'AK48057861',
'AK48057972',
'AK48057982',
'AK48058000',
'AK48058098',
'AK48058104',
'AK48058202',
'AK48058518',
'AK48058552',
'AK48058693',
'AK48190796',
'AK48192817',
'AK48192853',
'AK48192919',
'AK48193037',
'AK48193345',
'AK48193349',
'AK48193361',
'AK48193392',
'AK48193408',
'AK48193471',
'AK48193508',
'AK48193510',
'AK48193539',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20201111_1445_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
