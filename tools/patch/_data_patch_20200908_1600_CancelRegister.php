<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20200817_1400_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK46568100',
'AK46525200',
'AK46586200',
'AK46587200',
'AK46555400',
'AK46471500',
'AK46563500',
'AK46534500',
'AK46570800',
'AK46575800',
'AK46560900',
'AK46553900',
'AK46593900',
'AK46556900',
'AK46566110',
'AK46552310',
'AK46521410',
'AK46556410',
'AK46571510',
'AK46570610',
'AK46544610',
'AK46554610',
'AK46498610',
'AK46532710',
'AK46506710',
'AK46511810',
'AK46605810',
'AK46542910',
'AK46570020',
'AK46558120',
'AK46556320',
'AK46372420',
'AK46515420',
'AK45006420',
'AK46538420',
'AK46559720',
'AK46590820',
'AK44994820',
'AK46568820',
'AK46601920',
'AK46513030',
'AK46500130',
'AK46515630',
'AK46566830',
'AK46550930',
'AK46525930',
'AK44999930',
'AK46557040',
'AK46579040',
'AK46591240',
'AK46574340',
'AK46491440',
'AK46546440',
'AK46572540',
'AK46563540',
'AK46549540',
'AK46590740',
'AK46554740',
'AK46555740',
'AK46532840',
'AK46699840',
'AK46538940',
'AK46502150',
'AK46599150',
'AK46555250',
'AK46585250',
'AK46570350',
'AK46503350',
'AK46498350',
'AK46591550',
'AK46569650',
'AK46574850',
'AK46540950',
'AK46513160',
'AK46494360',
'AK46568360',
'AK46490460',
'AK46497560',
'AK46482860',
'AK46491960',
'AK46562960',
'AK46596370',
'AK46539370',
'AK46512470',
'AK46372470',
'AK46563570',
'AK46512670',
'AK46570770',
'AK46567870',
'AK46487970',
'AK46550080',
'AK46501080',
'AK46533080',
'AK46519080',
'AK46570180',
'AK46553180',
'AK46546180',
'AK46549180',
'AK46593280',
'AK46555380',
'AK46597380',
'AK46700580',
'AK46514580',
'AK46498580',
'AK46598680',
'AK46611780',
'AK46545880',
'AK46558880',
'AK46558980',
'AK46534190',
'AK46568290',
'AK46478390',
'AK46372490',
'AK46555790',
'AK46599790',
'AK46557001',
'AK46564301',
'AK46600401',
'AK46602401',
'AK46512401',
'AK46584401',
'AK46615401',
'AK46532601',
'AK46556901',
'AK46529901',
'AK46550011',
'AK46489011',
'AK46501211',
'AK46557311',
'AK46570411',
'AK46526411',
'AK46500611',
'AK46570611',
'AK46572711',
'AK46575711',
'AK46569711',
'AK46493811',
'AK46565121',
'AK46576121',
'AK46547121',
'AK46609221',
'AK46521321',
'AK46552421',
'AK46558421',
'AK46548621',
'AK46501721',
'AK46563721',
'AK46569921',
'AK46554131',
'AK46585131',
'AK46497131',
'AK46603231',
'AK46555231',
'AK46526231',
'AK46597331',
'AK46555831',
'AK46537831',
'AK46607931',
'AK46570041',
'AK46600141',
'AK46556141',
'AK46547141',
'AK46504241',
'AK46497241',
'AK46555341',
'AK46538341',
'AK46538441',
'AK46594641',
'AK46616641',
'AK46551741',
'AK46555741',
'AK46475741',
'AK45717741',
'AK46546841',
'AK46538841',
'AK46513151',
'AK46700251',
'AK46482251',
'AK46553351',
'AK46583351',
'AK46579451',
'AK46559651',
'AK46555751',
'AK46604851',
'AK46509851',
'AK46570951',
'AK46590951',
'AK46532951',
'AK46544951',
'AK46599951',
'AK46500161',
'AK46540161',
'AK46470161',
'AK46596261',
'AK46480461',
'AK46611461',
'AK46512461',
'AK46532661',
'AK46538661',
'AK46700761',
'AK46498861',
'AK46561071',
'AK46523171',
'AK46581271',
'AK46549371',
'AK46570471',
'AK46553471',
'AK46560571',
'AK46532671',
'AK46553771',
'AK46497771',
'AK46549771',
'AK46556181',
'AK46561381',
'AK46616581',
'AK46610681',
'AK46511881',
'AK46563881',
'AK46555881',
'AK46570191',
'AK46474191',
'AK46513291',
'AK46561391',
'AK46581391',
'AK46554391',
'AK46470891',
'AK46580891',
'AK46540991',
'AK46551991',
'AK46555991',
'AK46576991',
'AK46573102',
'AK46534102',
'AK46568102',
'AK46553202',
'AK46569202',
'AK46563402',
'AK46553502',
'AK46547502',
'AK46567702',
'AK45714112',
'AK46553212',
'AK46556212',
'AK46565312',
'AK46584412',
'AK46595712',
'AK46556712',
'AK46507712',
'AK46512812',
'AK46586812',
'AK46569912',
'AK46560122',
'AK46556122',
'AK46580222',
'AK46474422',
'AK46533622',
'AK46548622',
'AK46555722',
'AK46548722',
'AK46526822',
'AK46609822',
'AK46533922',
'AK46597922',
'AK45659922',
'AK46569922',
'AK46557032',
'AK46559032',
'AK46579032',
'AK46501232',
'AK46533232',
'AK46538232',
'AK46578232',
'AK46596332',
'AK46572432',
'AK46544432',
'AK46566432',
'AK46569532',
'AK46534832',
'AK46556832',
'AK46498932',
'AK46373042',
'AK46536042',
'AK46556142',
'AK46554242',
'AK46508242',
'AK46538342',
'AK46470442',
'AK46544542',
'AK46615542',
'AK46500642',
'AK46503642',
'AK46473642',
'AK46526642',
'AK46553742',
'AK46592842',
'AK46573842',
'AK46562942',
'AK45723052',
'AK46509052',
'AK46602152',
'AK46540252',
'AK46556452',
'AK46555552',
'AK46527652',
'AK46477652',
'AK46538852',
'AK46548952',
'AK46480062',
'AK46560262',
'AK46572262',
'AK46552362',
'AK46470462',
'AK46505462',
'AK46555662',
'AK46571762',
'AK46564862',
'AK46568862',
'AK46589862',
'AK46514962',
'AK46565962',
'AK46480172',
'AK46611172',
'AK46567172',
'AK46538272',
'AK46591372',
'AK46561472',
'AK46589472',
'AK46491572',
'AK46513672',
'AK46563672',
'AK46545672',
'AK46569672',
'AK46556872',
'AK46555972',
'AK46549972',
'AK46537082',
'AK46548182',
'AK46595282',
'AK46546282',
'AK46551882',
'AK46542882',
'AK46593882',
'AK46554882',
'AK46541982',
'AK46575982',
'AK46507092',
'AK46506192',
'AK46508492',
'AK46611692',
'AK46545692',
'AK46517792',
'AK46513892',
'AK46573892',
'AK46565992',
'AK46557003',
'AK45658003',
'AK46529003',
'AK46557103',
'AK46558103',
'AK46577203',
'AK46499203',
'AK46591303',
'AK46577303',
'AK46553503',
'AK46373503',
'AK46512603',
'AK46555603',
'AK46555703',
'AK46548803',
'AK46548903',
'AK46512013',
'AK46534013',
'AK46574013',
'AK46558013',
'AK46611113',
'AK46548113',
'AK46515213',
'AK46569313',
'AK46537513',
'AK46528613',
'AK46505913',
'AK46577913',
'AK46536023',
'AK46515523',
'AK46580623',
'AK46565623',
'AK46564723',
'AK46557723',
'AK46582923',
'AK46573133',
'AK46575133',
'AK46556133',
'AK46555233',
'AK46530333',
'AK46373333',
'AK46373433',
'AK46519533',
'AK46513833',
'AK46534833',
'AK46513933',
'AK46514933',
'AK46512343',
'AK46528343',
'AK46700443',
'AK46532743',
'AK46372743',
'AK46483743',
'AK46604943',
'AK46557253',
'AK46502353',
'AK46569653',
'AK45694953',
'AK46569953',
'AK46573063',
'AK46547163',
'AK46569263',
'AK46508363',
'AK46530463',
'AK46563463',
'AK46541563',
'AK46517763',
'AK46546073',
'AK46538073',
'AK46538273',
'AK46532573',
'AK46570673',
'AK46554773',
'AK46574773',
'AK46556773',
'AK46517773',
'AK46570873',
'AK46527873',
'AK46559873',
'AK46528083',
'AK46609083',
'AK46533183',
'AK46545283',
'AK46534383',
'AK46589483',
'AK46530583',
'AK46592683',
'AK46537683',
'AK46554783',
'AK46511883',
'AK46545883',
'AK46565983',
'AK46552093',
'AK46373093',
'AK46556093',
'AK46557093',
'AK46551493',
'AK46556493',
'AK46514593',
'AK46561793',
'AK46533004',
'AK46546004',
'AK46570104',
'AK46557104',
'AK46487304',
'AK46538304',
'AK46494404',
'AK46512504',
'AK46548804',
'AK46569804',
'AK46530904',
'AK46476904',
'AK46556014',
'AK46563114',
'AK46524114',
'AK46565314',
'AK46547314',
'AK45008314',
'AK46533414',
'AK46559514',
'AK46561614',
'AK46605714',
'AK46547714',
'AK46572914',
'AK46533914',
'AK46373224',
'AK46556524',
'AK46509524',
'AK46515624',
'AK46555624',
'AK45686624',
'AK46552924',
'AK46545924',
'AK46538924',
'AK46575034',
'AK46580134',
'AK46553134',
'AK46584334',
'AK46503434',
'AK46512534',
'AK45748634',
'AK46511834',
'AK46474834',
'AK46555834',
'AK46566834',
'AK46577834',
'AK46569834',
'AK46511934',
'AK46532934',
'AK45653044',
'AK46533244',
'AK46554244',
'AK46556244',
'AK45001544',
'AK46563544',
'AK46556644',
'AK46528644',
'AK46583744',
'AK46569744',
'AK46537844',
'AK46589844',
'AK46580944',
'AK46513944',
'AK46557944',
'AK46552354',
'AK46582554',
'AK46555754',
'AK46565754',
'AK46546754',
'AK46533954',
'AK46570164',
'AK45694364',
'AK46500564',
'AK46564564',
'AK46514664',
'AK46556664',
'AK46499664',
'AK46554764',
'AK46609764',
'AK46571864',
'AK46560964',
'AK46549964',
'AK46589964',
'AK46562074',
'AK46557274',
'AK46568374',
'AK46530474',
'AK46562474',
'AK46536674',
'AK46501774',
'AK46546874',
'AK46541974',
'AK46552974',
'AK46553974',
'AK46549974',
'AK46560084',
'AK46542184',
'AK46573184',
'AK46556184',
'AK46512284',
'AK46538284',
'AK46502384',
'AK46543384',
'AK46509384',
'AK46599384',
'AK46544484',
'AK46492584',
'AK46514584',
'AK46505584',
'AK46529584',
'AK46613684',
'AK46510784',
'AK46555784',
'AK46523884',
'AK46558884',
'AK46562984',
'AK46549984',
'AK46556094',
'AK46608094',
'AK46504294',
'AK46556294',
'AK46529294',
'AK46570394',
'AK46480394',
'AK46570494',
'AK46578594',
'AK46569694',
'AK46579694',
'AK46493994',
'AK46588994',
'AK46547005',
'AK46557005',
'AK46556105',
'AK46548105',
'AK46558105',
'AK46470405',
'AK46538405',
'AK46558405',
'AK46568405',
'AK46553505',
'AK46493505',
'AK46515505',
'AK46547505',
'AK46500605',
'AK46504605',
'AK46523705',
'AK46534805',
'AK46589905',
'AK46565015',
'AK46536015',
'AK46500115',
'AK46564215',
'AK46559315',
'AK46527415',
'AK46556815',
'AK46569815',
'AK46560915',
'AK46470915',
'AK46544025',
'AK46585025',
'AK46545125',
'AK46533225',
'AK46555225',
'AK46581525',
'AK46544625',
'AK46541725',
'AK46572725',
'AK46534825',
'AK46548825',
'AK46520925',
'AK46613925',
'AK46561035',
'AK46546035',
'AK46533135',
'AK46526135',
'AK46569135',
'AK46510435',
'AK46538435',
'AK46556635',
'AK46578635',
'AK46499635',
'AK46553735',
'AK46556735',
'AK46602835',
'AK46514835',
'AK46569835',
'AK46547045',
'AK46518045',
'AK46580145',
'AK44602145',
'AK46601245',
'AK46554245',
'AK46594345',
'AK46538345',
'AK46587545',
'AK46532645',
'AK46559745',
'AK46569745',
'AK46500055',
'AK45650055',
'AK46477155',
'AK46373255',
'AK46554355',
'AK46542455',
'AK46573455',
'AK46609455',
'AK46556555',
'AK46587855',
'AK46498855',
'AK45004165',
'AK46529265',
'AK46555965',
'AK46556965',
'AK46566075',
'AK46478075',
'AK46579075',
'AK46567275',
'AK46529275',
'AK46469275',
'AK45724375',
'AK46557375',
'AK46571475',
'AK46572575',
'AK46556575',
'AK46555675',
'AK46614775',
'AK46548975',
'AK46550185',
'AK46526285',
'AK46527285',
'AK46529485',
'AK46569585',
'AK46578685',
'AK46555785',
'AK46514885',
'AK46574985',
'AK46546195',
'AK46556195',
'AK46553995',
'AK46556106',
'AK46509106',
'AK46548206',
'AK46553306',
'AK46566306',
'AK46553506',
'AK46542606',
'AK46556706',
'AK46529706',
'AK46538906',
'AK46593116',
'AK46578216',
'AK46545316',
'AK46527316',
'AK46595416',
'AK46577416',
'AK46550516',
'AK46529516',
'AK46569616',
'AK46541716',
'AK46567816',
'AK46476916',
'AK45662126',
'AK46565126',
'AK45721426',
'AK46528426',
'AK46548426',
'AK46553526',
'AK46593526',
'AK46512626',
'AK46535626',
'AK46513236',
'AK46372336',
'AK46555436',
'AK46525636',
'AK46523736',
'AK45688736',
'AK46478836',
'AK46542936',
'AK46556936',
'AK46569936',
'AK46615046',
'AK46513246',
'AK46587246',
'AK46563546',
'AK46569546',
'AK46509646',
'AK46588746',
'AK46512946',
'AK46554256',
'AK46556256',
'AK46576256',
'AK46607256',
'AK46510656',
'AK46575656',
'AK46527656',
'AK46556756',
'AK46550956',
'AK46470956',
'AK46533956',
'AK46578956',
'AK46533166',
'AK46573166',
'AK46559166',
'AK46547266',
'AK46548266',
'AK45039266',
'AK46574366',
'AK46538366',
'AK46510466',
'AK46556466',
'AK46528466',
'AK46549466',
'AK46700566',
'AK46512766',
'AK46512866',
'AK46519866',
'AK46525966',
'AK46556076',
'AK46487176',
'AK46532276',
'AK46584276',
'AK46584376',
'AK46557376',
'AK46491576',
'AK46553676',
'AK46536676',
'AK46512776',
'AK46553776',
'AK46588776',
'AK46533286',
'AK46538286',
'AK46520386',
'AK46556386',
'AK46505486',
'AK46541586',
'AK46563586',
'AK46556586',
'AK46550686',
'AK46556786',
'AK46511886',
'AK46555986',
'AK46596986',
'AK46546096',
'AK46512196',
'AK46547196',
'AK46502396',
'AK46554496',
'AK46700596',
'AK46555696',
'AK46511796',
'AK46534796',
'AK46595796',
'AK46539796',
'AK46579896',
'AK46589896',
'AK46478007',
'AK46501207',
'AK46575307',
'AK46500507',
'AK46373507',
'AK46546507',
'AK46588507',
'AK46535607',
'AK46577607',
'AK46500707',
'AK46576707',
'AK46538807',
'AK46542017',
'AK46572017',
'AK46556117',
'AK46547217',
'AK46531317',
'AK46555417',
'AK46470517',
'AK46593517',
'AK46548617',
'AK46560817',
'AK46526817',
'AK46557027',
'AK46571127',
'AK46556127',
'AK46568127',
'AK46540227',
'AK46555227',
'AK46567227',
'AK46596327',
'AK46555427',
'AK46576427',
'AK46570527',
'AK46502527',
'AK46547627',
'AK46553727',
'AK46573827',
'AK46598827',
'AK46493037',
'AK46519037',
'AK46602137',
'AK46556137',
'AK46563237',
'AK46485237',
'AK46569337',
'AK46540537',
'AK46552537',
'AK46564047',
'AK46557047',
'AK46562147',
'AK46572447',
'AK46518447',
'AK46700547',
'AK46512547',
'AK46567547',
'AK46569547',
'AK46565647',
'AK46372747',
'AK46492747',
'AK46553747',
'AK46569747',
'AK46509847',
'AK46540057',
'AK46547157',
'AK46547257',
'AK46529257',
'AK46564357',
'AK46607357',
'AK46548557',
'AK46578757',
'AK46556857',
'AK46587857',
'AK46537167',
'AK46527267',
'AK45704367',
'AK46575367',
'AK46512467',
'AK46700667',
'AK46545667',
'AK46548667',
'AK46509667',
'AK46610767',
'AK46556967',
'AK46604077',
'AK46599277',
'AK46557377',
'AK46520477',
'AK46602677',
'AK46505677',
'AK46567777',
'AK46556877',
'AK46568877',
'AK46599977',
'AK46572087',
'AK46556087',
'AK46372187',
'AK46546187',
'AK46597287',
'AK46558287',
'AK46500387',
'AK46551387',
'AK46515587',
'AK46547787',
'AK46609987',
'AK46612197',
'AK46572197',
'AK46568297',
'AK46563397',
'AK46538397',
'AK46512497',
'AK46610697',
'AK46579697',
'AK46491797',
'AK46469797',
'AK46477897',
'AK46512108',
'AK46573108',
'AK46548108',
'AK46558108',
'AK46542308',
'AK46582308',
'AK46515408',
'AK46553508',
'AK46556508',
'AK46554608',
'AK46549708',
'AK46579808',
'AK46512908',
'AK46532908',
'AK46564908',
'AK46556908',
'AK46514018',
'AK46512218',
'AK46479218',
'AK46566318',
'AK46552418',
'AK46515418',
'AK46529418',
'AK46515518',
'AK46555518',
'AK46555618',
'AK46548618',
'AK46522718',
'AK46557718',
'AK46512918',
'AK46477918',
'AK46593028',
'AK46538228',
'AK46590328',
'AK46568328',
'AK46592428',
'AK46373428',
'AK46565428',
'AK46539428',
'AK46550528',
'AK46513528',
'AK46581628',
'AK46549828',
'AK46550138',
'AK46575138',
'AK46593238',
'AK46498338',
'AK46563438',
'AK46544538',
'AK46545838',
'AK46556838',
'AK46564938',
'AK46525048',
'AK46528048',
'AK46579048',
'AK46493148',
'AK46554248',
'AK46547348',
'AK45639548',
'AK45621648',
'AK46532648',
'AK46511848',
'AK46540948',
'AK46580158',
'AK46549158',
'AK46562258',
'AK46556258',
'AK46531358',
'AK46566458',
'AK46573658',
'AK46564658',
'AK46555658',
'AK46578758',
'AK46511858',
'AK46558368',
'AK46614468',
'AK46373568',
'AK46555768',
'AK46578868',
'AK46490968',
'AK46552178',
'AK46635478',
'AK46598578',
'AK46547678',
'AK46556878',
'AK46608978',
'AK46533088',
'AK46557088',
'AK46549288',
'AK46568388',
'AK46544488',
'AK46581588',
'AK46512588',
'AK46594588',
'AK46546588',
'AK46511688',
'AK46608688',
'AK46548688',
'AK46480788',
'AK46560888',
'AK46571988',
'AK46558098',
'AK46547198',
'AK46569198',
'AK46550298',
'AK46547398',
'AK46556498',
'AK46586598',
'AK46372798',
'AK46529898',
'AK46577998',
'AK46528998',
'AK46546009',
'AK46568109',
'AK46588209',
'AK46578309',
'AK46556409',
'AK46548409',
'AK46532509',
'AK46565609',
'AK46556609',
'AK46528609',
'AK46526809',
'AK46472909',
'AK46557119',
'AK46516219',
'AK46478319',
'AK46492419',
'AK46548419',
'AK46571519',
'AK46505519',
'AK46606719',
'AK46528719',
'AK46511819',
'AK46512819',
'AK46508819',
'AK46553919',
'AK46558919',
'AK46591029',
'AK46568029',
'AK46501229',
'AK46577229',
'AK46551329',
'AK46506329',
'AK46577329',
'AK46548329',
'AK46512429',
'AK46598529',
'AK46561629',
'AK46532729',
'AK46572729',
'AK46553729',
'AK46556729',
'AK46545929',
'AK46497929',
'AK46572039',
'AK46529039',
'AK46531139',
'AK46570239',
'AK46571239',
'AK46581239',
'AK46537239',
'AK46597339',
'AK46562439',
'AK46572439',
'AK46550539',
'AK46481539',
'AK46526639',
'AK46571739',
'AK46551939',
'AK46529939',
'AK46536049',
'AK46555149',
'AK46570249',
'AK46574249',
'AK46538249',
'AK46501349',
'AK46579349',
'AK46549449',
'AK46556549',
'AK46556649',
'AK46516949',
'AK46556159',
'AK46533259',
'AK46564259',
'AK46538259',
'AK46488259',
'AK46499259',
'AK46557459',
'AK46568559',
'AK45705659',
'AK46515659',
'AK46563959',
'AK44994959',
'AK46500069',
'AK46571169',
'AK46544169',
'AK46555169',
'AK46500269',
'AK46566269',
'AK46496269',
'AK46560469',
'AK46555469',
'AK46700569',
'AK46555669',
'AK46570179',
'AK46541379',
'AK46512479',
'AK46543479',
'AK46565479',
'AK46556479',
'AK46531679',
'AK46573879',
'AK46564879',
'AK46371979',
'AK46573189',
'AK46552289',
'AK46556289',
'AK46519389',
'AK46555489',
'AK46556489',
'AK46502689',
'AK46549789',
'AK46561889',
'AK46498889',
'AK46372989',
'AK46557099',
'AK46546399',
'AK46555499',
'AK46549499',
'AK46535599',
'AK46480699',
'AK46556699',
'AK46547799',
'AK46477899',
'AK46556999',
'AK46538999',
'AK46569999',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20200817_1400_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
