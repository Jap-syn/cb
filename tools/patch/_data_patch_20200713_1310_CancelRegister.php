<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20200713_1310_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK45016420',
'AK45075628',
'AK45031316',
'AK45012040',
'AK45030220',
'AK45014955',
'AK45017012',
'AK45048933',
'AK45043904',
'AK45044085',
'AK45039430',
'AK45034589',
'AK45028279',
'AK45027220',
'AK45027170',
'AK45026724',
'AK45026042',
'AK45025791',
'AK45025693',
'AK45025264',
'AK45022868',
'AK45018622',
'AK45017762',
'AK45013785',
'AK45009151',
'AK45001532',
'AK45067856',
'AK45054972',
'AK44432135',
'AK45051201',
'AK45050294',
'AK44610679',
'AK45039373',
'AK45039112',
'AK44549830',
'AK45036310',
'AK45034734',
'AK45030156',
'AK45030068',
'AK44932305',
'AK45027800',
'AK45021515',
'AK45015860',
'AK45069960',
'AK44430825',
'AK45067517',
'AK45052904',
'AK45044743',
'AK45038473',
'AK45037066',
'AK43903091',
'AK45034824',
'AK45029750',
'AK44430390',
'AK45054730',
'AK45063151',
'AK45052921',
'AK45043976',
'AK45051272',
'AK45048249',
'AK45035695',
'AK45030742',
'AK44457389',
'AK43884648',
'AK45029456',
'AK45053183',
'AK45025218',
'AK45012439',
'AK45006461',
'AK44061278',
'AK44610074',
'AK45064790',
'AK45065843',
'AK45029635',
'AK45035537',
'AK45027666',
'AK45026610',
'AK45074329',
'AK45042713',
'AK44558626',
'AK45059264',
'AK45050074',
'AK45019017',
'AK44994478',
'AK45030014',
'AK45009464',
'AK45006462',
'AK45052161',
'AK45014908',
'AK45036054',
'AK45036766',
'AK45027554',
'AK45025137',
'AK45010899',
'AK45045033',
'AK45027346',
'AK44932048',
'AK45040279',
'AK45010222',
'AK45032341',
'AK45024564',
'AK45062545',
'AK45045770',
'AK45026541',
'AK45042682',
'AK45052762',
'AK45068418',
'AK45036740',
'AK45052350',
'AK45069729',
'AK45013151',
'AK45039025',
'AK44552512',
'AK45030169',
'AK45009103',
'AK45061971',
'AK45027775',
'AK45046151',
'AK45030407',
'AK45026104',
'AK43915240',
'AK43847889',
'AK45066776',
'AK45034134',
'AK45049962',
'AK45063283',
'AK45018753',
'AK45035816',
'AK45031486',
'AK45049276',
'AK45018068',
'AK45032893',
'AK45050297',
'AK45028988',
'AK45049708',
'AK45064514',
'AK45060611',
'AK45061405',
'AK45026436',
'AK45046296',
'AK45017880',
'AK45009028',
'AK45048649',
'AK45040057',
'AK45010263',
'AK45065210',
'AK45038136',
'AK45009101',
'AK45027173',
'AK45010340',
'AK45057173',
'AK45060886',
'AK45027689',
'AK45069531',
'AK45043535',
'AK45076454',
'AK45026501',
'AK45061481',
'AK45057881',
'AK45034243',
'AK45052393',
'AK45028737',
'AK45035198',
'AK45033929',
'AK45025807',
'AK45020537',
'AK45042084',
'AK45041707',
'AK45032885',
'AK45033977',
'AK45017540',
'AK45024599',
'AK45056016',
'AK45058569',
'AK45027502',
'AK45039421',
'AK45029060',
'AK45046621',
'AK45021080',
'AK45072293',
'AK45040341',
'AK45061074',
'AK45052774',
'AK45049928',
'AK45018496',
'AK45066467',
'AK45062753',
'AK45036704',
'AK45031021',
'AK45027327',
'AK45034417',
'AK45065253',
'AK45072899',
'AK45038900',
'AK45029382',
'AK45037833',
'AK45061424',
'AK45050867',
'AK45060168',
'AK45049249',
'AK45024499',
'AK44932265',
'AK44931884',
'AK45046712',
'AK45067719',
'AK45004407',
'AK45067915',
'AK45037908',
'AK45015601',
'AK45032899',
'AK45025956',
'AK45053657',
'AK45036822',
'AK45193188',
'AK45027372',
'AK45038577',
'AK45049698',
'AK45024083',
'AK45034184',
'AK45052597',
'AK45066590',
'AK45069281',
'AK45068868',
'AK45023947',
'AK45032941',
'AK45013236',
'AK45070907',
'AK45041253',
'AK45046315',
'AK45048268',
'AK45013981',
'AK45023215',
'AK45008467',
'AK45015639',
'AK45045913',
'AK45025960',
'AK45004111',
'AK45024483',
'AK45046432',
'AK45031163',
'AK45032273',
'AK45042858',
'AK44994980',
'AK45025503',
'AK45005455',
'AK45020955',
'AK45007039',
'AK45060570',
'AK45032371',
'AK45036242',
'AK45029077',
'AK45033698',
'AK45012681',
'AK45015352',
'AK45005947',
'AK45006649',
'AK45067844',
'AK45034390',
'AK45043073',
'AK45045808',
'AK44999945',
'AK45010664',
'AK45039488',
'AK45067830',
'AK45070146',
'AK45027219',
'AK44998705',
'AK45063420',
'AK45064536',
'AK45011272',
'AK44997851',
'AK45009889',
'AK45073086',
'AK45032429',
'AK45008290',
'AK45030667',
'AK45034914',
'AK45028030',
'AK45031181',
'AK45059862',
'AK45051995',
'AK45050569',
'AK45013297',
'AK45020000',
'AK45013584',
'AK45020505',
'AK45025645',
'AK44999955',
'AK45027441',
'AK45012802',
'AK44995503',
'AK45009658',
'AK45065222',
'AK45067032',
'AK45059665',
'AK45026865',
'AK45005966',
'AK45066391',
'AK45038141',
'AK45038425',
'AK45034665',
'AK45010763',
'AK45069235',
'AK45048870',
'AK45052096',
'AK45026078',
'AK45015776',
'AK45047078',
'AK45024145',
'AK45006658',
'AK45017339',
'AK45038053',
'AK45063832',
'AK45069542',
'AK45066575',
'AK45074085',
'AK45067207',
'AK45060610',
'AK45029930',
'AK45061540',
'AK45038350',
'AK45047290',
'AK45039041',
'AK45043741',
'AK45028761',
'AK45029581',
'AK45049191',
'AK45060102',
'AK45032922',
'AK45051832',
'AK45047762',
'AK45029172',
'AK45051033',
'AK45044953',
'AK45039873',
'AK45027404',
'AK45051224',
'AK45028174',
'AK45034305',
'AK45042115',
'AK45034535',
'AK45045355',
'AK45062275',
'AK45030316',
'AK45036436',
'AK45036976',
'AK45033207',
'AK45030507',
'AK45044517',
'AK45030737',
'AK45039947',
'AK45047497',
'AK45058897',
'AK45030928',
'AK45046958',
'AK45044498',
'AK45037119',
'AK45030319',
'AK45048329',
'AK45032759',
'AK45031199',
'AK45021581',
'AK45019781',
'AK45009112',
'AK45016022',
'AK45025482',
'AK45012613',
'AK45019814',
'AK44997924',
'AK45015364',
'AK45010874',
'AK45013535',
'AK45020355',
'AK45010197',
'AK44996769',
'AK45006079',
'AK45036669',
'AK45043064',
'AK45129390',
'AK45068428',
'AK45027375',
'AK45027243',
'AK45038110',
'AK45026910',
'AK45026430',
'AK45041750',
'AK45028331',
'AK45027181',
'AK45026381',
'AK45027102',
'AK45026112',
'AK45026912',
'AK45049363',
'AK45042073',
'AK45026404',
'AK45027444',
'AK45026225',
'AK45061295',
'AK45026395',
'AK45026906',
'AK45026326',
'AK45034856',
'AK45060166',
'AK45061566',
'AK45034286',
'AK45029286',
'AK45054007',
'AK45040407',
'AK45026297',
'AK45061808',
'AK45026859',
'AK45025022',
'AK45025342',
'AK45006173',
'AK45019495',
'AK45000776',
'AK45005037',
'AK45012058',
'AK45067242',
'AK45048290',
'AK45033851',
'AK45031642',
'AK45028764',
'AK45037446',
'AK45028227',
'AK45045428',
'AK45047738',
'AK45060258',
'AK45042298',
'AK45029629',
'AK45037669',
'AK45053199',
'AK45025487',
'AK45068274',
'AK45040599',
'AK44995521',
'AK45065611',
'AK45031401',
'AK45048534',
'AK45026645',
'AK45029155',
'AK45050147',
'AK45037147',
'AK45046057',
'AK45046557',
'AK45054128',
'AK45041989',
'AK45015170',
'AK45025941',
'AK44998905',
'AK45015348',
'AK45026752',
'AK45051463',
'AK45067954',
'AK45073027',
'AK45072278',
'AK45028601',
'AK45035911',
'AK45037731',
'AK45051913',
'AK45051363',
'AK45032714',
'AK45039415',
'AK45053325',
'AK45041575',
'AK45041906',
'AK45039486',
'AK45045027',
'AK45028077',
'AK45035177',
'AK45030387',
'AK45028379',
'AK45013220',
'AK45025690',
'AK45008723',
'AK45016595',
'AK45010895',
'AK45020327',
'AK45015157',
'AK45009513',
'AK45020369',
'AK45067632',
'AK45065654',
'AK45067238',
'AK45027250',
'AK45062282',
'AK45047514',
'AK45028234',
'AK45039374',
'AK45029394',
'AK45037215',
'AK45042365',
'AK45031477',
'AK45046998',
'AK45035269',
'AK45025710',
'AK45009525',
'AK45025925',
'AK45006506',
'AK45024568',
'AK45020831',
'AK45032254',
'AK45062741',
'AK45049151',
'AK45030892',
'AK45051485',
'AK45056736',
'AK45037836',
'AK45060178',
'AK45027488',
'AK45037469',
'AK45013720',
'AK45025281',
'AK45002773',
'AK45071463',
'AK45026730',
'AK45026741',
'AK45034171',
'AK45045312',
'AK45029412',
'AK45052232',
'AK45026547',
'AK45041167',
'AK45038008',
'AK45026668',
'AK45027009',
'AK45050329',
'AK45026699',
'AK45064159',
'AK45042962',
'AK45043396',
'AK45010040',
'AK45005990',
'AK45003423',
'AK45027051',
'AK45027044',
'AK45019722',
'AK45001045',
'AK45031810',
'AK45067375',
'AK45014954',
'AK45024720',
'AK45014101',
'AK44932289',
'AK45031336',
'AK45028131',
'AK45023744',
'AK44451439',
'AK45193081',
'AK45192991',
'AK45193152',
'AK45193214',
'AK45192954',
'AK45192995',
'AK45193118',
'AK45065010',
'AK45063310',
'AK45071220',
'AK45063730',
'AK45065050',
'AK45071750',
'AK45068750',
'AK45065460',
'AK45070560',
'AK45069270',
'AK45074570',
'AK45068201',
'AK45067401',
'AK45069621',
'AK45063721',
'AK45070631',
'AK45066341',
'AK45072651',
'AK45068471',
'AK45065571',
'AK45067391',
'AK45064791',
'AK45078991',
'AK45064902',
'AK45065902',
'AK45066612',
'AK45064222',
'AK45076432',
'AK45074542',
'AK45067842',
'AK45072962',
'AK45070282',
'AK45078992',
'AK45063703',
'AK45068013',
'AK45068113',
'AK45066213',
'AK45063923',
'AK45067043',
'AK45066453',
'AK45064773',
'AK45076083',
'AK45067004',
'AK45069224',
'AK45063724',
'AK45064934',
'AK45068644',
'AK45069064',
'AK45067864',
'AK45065684',
'AK45073194',
'AK45067125',
'AK45068225',
'AK45067735',
'AK45077735',
'AK45066745',
'AK45076945',
'AK45069955',
'AK45064116',
'AK45065416',
'AK45066126',
'AK45070226',
'AK45063726',
'AK45063246',
'AK45065346',
'AK45066466',
'AK45063566',
'AK45069666',
'AK45067086',
'AK45065007',
'AK45068417',
'AK45065627',
'AK45067927',
'AK45064537',
'AK45071457',
'AK45067667',
'AK45068967',
'AK45065777',
'AK45067877',
'AK45070587',
'AK45074397',
'AK45072318',
'AK45067728',
'AK45068828',
'AK45067538',
'AK45069638',
'AK45071938',
'AK45070048',
'AK45074148',
'AK45072858',
'AK45065678',
'AK45063778',
'AK45072978',
'AK45075398',
'AK45063498',
'AK45064598',
'AK45064698',
'AK45074798',
'AK45066119',
'AK45065519',
'AK45066629',
'AK45070239',
'AK45074839',
'AK45065249',
'AK45078969',
'AK45064179',
'AK45067379',
'AK45065879',
'AK45065189',
'AK45063789',
'AK45073989',
'AK45037841',
'AK45046000',
'AK45031100',
'AK45046100',
'AK45037300',
'AK45059300',
'AK45048500',
'AK45060600',
'AK45039600',
'AK45051900',
'AK45031110',
'AK45051210',
'AK45031510',
'AK45050610',
'AK45038810',
'AK45037910',
'AK45031020',
'AK45031120',
'AK45055320',
'AK45052420',
'AK45042520',
'AK45050720',
'AK45031720',
'AK45057720',
'AK45028720',
'AK45032820',
'AK45031230',
'AK45042230',
'AK45027230',
'AK45029330',
'AK45059430',
'AK45026530',
'AK45047530',
'AK45041630',
'AK45036730',
'AK45044830',
'AK45026830',
'AK45051240',
'AK45029240',
'AK45041440',
'AK45042540',
'AK45040740',
'AK45052150',
'AK45030250',
'AK45052250',
'AK45034250',
'AK45050350',
'AK45026550',
'AK45027550',
'AK45039550',
'AK45049550',
'AK45053750',
'AK45044750',
'AK45026750',
'AK45030850',
'AK45061850',
'AK45035850',
'AK45050160',
'AK45050360',
'AK45049460',
'AK45028560',
'AK45057660',
'AK45059660',
'AK45030070',
'AK45039470',
'AK45057670',
'AK45035970',
'AK45034280',
'AK45036280',
'AK45041580',
'AK45027580',
'AK45039580',
'AK45027780',
'AK45031880',
'AK45061880',
'AK45027980',
'AK45026090',
'AK45028090',
'AK45043190',
'AK45035390',
'AK45047490',
'AK45029590',
'AK45049690',
'AK45038790',
'AK45029890',
'AK45030101',
'AK45036301',
'AK45056301',
'AK45038301',
'AK45050401',
'AK45026401',
'AK45033601',
'AK45055601',
'AK45026701',
'AK45030901',
'AK45037011',
'AK45045311',
'AK45033411',
'AK45062511',
'AK45028911',
'AK45030021',
'AK45037121',
'AK45034221',
'AK45044321',
'AK45035321',
'AK45029321',
'AK45052421',
'AK45043421',
'AK45027421',
'AK45036621',
'AK45026821',
'AK45037821',
'AK45030921',
'AK45061131',
'AK45027231',
'AK45026331',
'AK45055831',
'AK45060931',
'AK45030041',
'AK45048041',
'AK45031241',
'AK45052241',
'AK45029341',
'AK45026441',
'AK45028441',
'AK45038441',
'AK45044641',
'AK45027641',
'AK45037741',
'AK45038051',
'AK45029051',
'AK45034251',
'AK45049251',
'AK45033451',
'AK45039551',
'AK45038751',
'AK45035851',
'AK45039851',
'AK45054061',
'AK45038061',
'AK45044261',
'AK45027261',
'AK45043561',
'AK45035961',
'AK45037071',
'AK45038071',
'AK45052171',
'AK45031471',
'AK45058471',
'AK45041571',
'AK45032571',
'AK45058671',
'AK45032971',
'AK45037971',
'AK45040081',
'AK45044281',
'AK45030481',
'AK45057481',
'AK45044781',
'AK45032981',
'AK45054091',
'AK45028091',
'AK45029191',
'AK45038291',
'AK45027391',
'AK45029591',
'AK45044791',
'AK45036991',
'AK45031102',
'AK45053102',
'AK45054102',
'AK45043302',
'AK45048302',
'AK45042702',
'AK45046702',
'AK45038802',
'AK45028902',
'AK45038902',
'AK45030012',
'AK45035012',
'AK45035112',
'AK45034312',
'AK45060412',
'AK45044512',
'AK45034612',
'AK45040222',
'AK45027422',
'AK45059422',
'AK45038822',
'AK45059822',
'AK45027032',
'AK45050132',
'AK45060132',
'AK45027132',
'AK45048132',
'AK45032232',
'AK45037232',
'AK45055332',
'AK45034532',
'AK45048932',
'AK45061042',
'AK45028042',
'AK45031342',
'AK45050442',
'AK45046642',
'AK45027052',
'AK45048052',
'AK45029052',
'AK45032252',
'AK45031352',
'AK45043552',
'AK45042752',
'AK45038752',
'AK45062062',
'AK45026362',
'AK45030562',
'AK45048562',
'AK45041662',
'AK45043662',
'AK45053762',
'AK45037962',
'AK45040272',
'AK45029372',
'AK45027472',
'AK45030672',
'AK45038772',
'AK45026872',
'AK45038082',
'AK45030182',
'AK45046182',
'AK45030482',
'AK45037882',
'AK45048882',
'AK45026982',
'AK45048982',
'AK45026092',
'AK45026392',
'AK45034592',
'AK45029592',
'AK45036692',
'AK45049792',
'AK45028892',
'AK45044992',
'AK45036992',
'AK45038992',
'AK45039003',
'AK45031103',
'AK45043103',
'AK45030203',
'AK45047303',
'AK45062603',
'AK45037603',
'AK45051703',
'AK45035903',
'AK45048903',
'AK45041013',
'AK45031113',
'AK45050313',
'AK45061313',
'AK45059413',
'AK45049613',
'AK45062713',
'AK45034813',
'AK45027813',
'AK45038813',
'AK45037913',
'AK45030123',
'AK45052123',
'AK45027223',
'AK45028323',
'AK45029323',
'AK45052423',
'AK45036623',
'AK45050823',
'AK45027033',
'AK45047133',
'AK45041233',
'AK45038233',
'AK45046533',
'AK45045633',
'AK45036733',
'AK45032833',
'AK45040643',
'AK45029643',
'AK45043843',
'AK45029843',
'AK45040053',
'AK45027053',
'AK45029053',
'AK45028153',
'AK45031353',
'AK45056353',
'AK45038553',
'AK45039553',
'AK45026653',
'AK45052163',
'AK45046163',
'AK45037263',
'AK45026363',
'AK45037463',
'AK45026663',
'AK45034863',
'AK45035863',
'AK45026963',
'AK45037073',
'AK45028173',
'AK45033273',
'AK45045273',
'AK45030473',
'AK45027473',
'AK45037473',
'AK45052673',
'AK45053773',
'AK45035873',
'AK45032973',
'AK45046183',
'AK45031283',
'AK45049283',
'AK45050383',
'AK45038383',
'AK45030483',
'AK45048683',
'AK45026983',
'AK45050393',
'AK45026393',
'AK45038393',
'AK45026493',
'AK45031693',
'AK45026693',
'AK45039693',
'AK45053793',
'AK45034993',
'AK45027104',
'AK45029104',
'AK45049204',
'AK45031404',
'AK45037704',
'AK45041804',
'AK45032804',
'AK45036804',
'AK45059804',
'AK45037904',
'AK45032214',
'AK45031414',
'AK45045414',
'AK45029414',
'AK45053914',
'AK45045914',
'AK45030024',
'AK45030124',
'AK45029324',
'AK45026424',
'AK45041824',
'AK45026824',
'AK45039534',
'AK45042634',
'AK45045834',
'AK45037834',
'AK45053044',
'AK45027244',
'AK45034444',
'AK45028444',
'AK45046644',
'AK45048644',
'AK45051744',
'AK45044844',
'AK45059844',
'AK45046054',
'AK45040254',
'AK45035254',
'AK45039254',
'AK45054354',
'AK45028354',
'AK45044554',
'AK45048554',
'AK45036654',
'AK45039854',
'AK45033954',
'AK45049954',
'AK45027164',
'AK45029264',
'AK45043664',
'AK45028664',
'AK45057764',
'AK45049764',
'AK45047864',
'AK45039864',
'AK45030964',
'AK45029174',
'AK45042274',
'AK45026374',
'AK45041474',
'AK45030674',
'AK45062674',
'AK45038774',
'AK45028874',
'AK45037974',
'AK45038084',
'AK45050384',
'AK45026384',
'AK45045584',
'AK45031684',
'AK45039684',
'AK45033784',
'AK45044784',
'AK45027784',
'AK45038784',
'AK45039884',
'AK45034394',
'AK45038494',
'AK45045894',
'AK45036994',
'AK45029994',
'AK45040005',
'AK45029105',
'AK45061305',
'AK45035305',
'AK45033405',
'AK45026405',
'AK45043905',
'AK45045905',
'AK45037905',
'AK45028905',
'AK45059905',
'AK45030015',
'AK45035015',
'AK45037015',
'AK45028015',
'AK45031115',
'AK45044115',
'AK45050215',
'AK45045415',
'AK45053515',
'AK45032815',
'AK45029815',
'AK45034915',
'AK45027025',
'AK45030125',
'AK45037125',
'AK45029225',
'AK45042325',
'AK45033425',
'AK45050725',
'AK45052725',
'AK45053725',
'AK45061825',
'AK45032825',
'AK45026825',
'AK45029925',
'AK45049335',
'AK45044535',
'AK45053635',
'AK45051935',
'AK45038935',
'AK45041045',
'AK45051045',
'AK45050145',
'AK45047145',
'AK45044345',
'AK45035345',
'AK45037345',
'AK45046445',
'AK45028445',
'AK45039545',
'AK45042645',
'AK45056745',
'AK45030055',
'AK45032055',
'AK45043055',
'AK45027155',
'AK45029255',
'AK45031455',
'AK45043555',
'AK45029655',
'AK45047065',
'AK45035265',
'AK45036365',
'AK45039465',
'AK45028865',
'AK45040965',
'AK45048075',
'AK45042275',
'AK45029275',
'AK45043375',
'AK45035375',
'AK45026475',
'AK45027475',
'AK45028475',
'AK45042675',
'AK45028675',
'AK45029675',
'AK45060775',
'AK45061775',
'AK45055975',
'AK45026975',
'AK45050085',
'AK45051085',
'AK45033485',
'AK45042585',
'AK45041685',
'AK45030095',
'AK45050095',
'AK45047095',
'AK45028495',
'AK45041595',
'AK45032995',
'AK45029106',
'AK45034206',
'AK45036706',
'AK45037706',
'AK45040806',
'AK45037906',
'AK45038906',
'AK45029316',
'AK45039416',
'AK45036716',
'AK45037816',
'AK45026916',
'AK45041426',
'AK45026926',
'AK45047036',
'AK45062136',
'AK45053236',
'AK45034236',
'AK45026336',
'AK45027436',
'AK45039436',
'AK45026536',
'AK45039636',
'AK45039736',
'AK45031836',
'AK45036836',
'AK45062146',
'AK45036346',
'AK45039346',
'AK45026446',
'AK45050546',
'AK45039546',
'AK45026746',
'AK45048846',
'AK45039846',
'AK45028946',
'AK45038056',
'AK45029056',
'AK45038256',
'AK45049256',
'AK45026356',
'AK45046356',
'AK45026456',
'AK45028456',
'AK45038456',
'AK45045556',
'AK45036556',
'AK45038856',
'AK45028956',
'AK45030066',
'AK45050366',
'AK45029466',
'AK45036376',
'AK45039376',
'AK45047476',
'AK45049676',
'AK45027776',
'AK45029876',
'AK45034086',
'AK45060386',
'AK45039686',
'AK45037986',
'AK45030296',
'AK45062296',
'AK45039296',
'AK45026696',
'AK45047796',
'AK45039996',
'AK45036007',
'AK45031107',
'AK45043107',
'AK45026107',
'AK45029107',
'AK45032207',
'AK45039407',
'AK45037607',
'AK45050707',
'AK45035017',
'AK45034217',
'AK45029317',
'AK45031417',
'AK45045417',
'AK45046917',
'AK45038027',
'AK45048027',
'AK45030127',
'AK45042127',
'AK45038127',
'AK45035327',
'AK45039327',
'AK45027427',
'AK45035527',
'AK45030627',
'AK45048627',
'AK45043827',
'AK45028927',
'AK45048927',
'AK45053037',
'AK45027137',
'AK45034237',
'AK45038337',
'AK45030637',
'AK45026637',
'AK45052147',
'AK45041247',
'AK45029547',
'AK45027647',
'AK45029647',
'AK45028747',
'AK45032947',
'AK45026157',
'AK45038257',
'AK45036357',
'AK45038357',
'AK45028457',
'AK45055557',
'AK45039557',
'AK45037957',
'AK45062067',
'AK45030367',
'AK45061367',
'AK45037567',
'AK45038567',
'AK45061667',
'AK45026867',
'AK45046967',
'AK45039967',
'AK45031277',
'AK45053277',
'AK45044277',
'AK45043377',
'AK45029377',
'AK45062477',
'AK45039577',
'AK45030677',
'AK45032777',
'AK45039977',
'AK45031087',
'AK45061187',
'AK45027187',
'AK45048287',
'AK45052487',
'AK45041587',
'AK45031687',
'AK45034687',
'AK45058687',
'AK45055787',
'AK45037787',
'AK45057887',
'AK45031097',
'AK45037597',
'AK45039797',
'AK45034897',
'AK45026897',
'AK45040108',
'AK45060108',
'AK45044108',
'AK45026108',
'AK45060208',
'AK45055208',
'AK45053308',
'AK45038308',
'AK45030408',
'AK45059608',
'AK45031118',
'AK45062318',
'AK45051518',
'AK45030128',
'AK45061728',
'AK45044828',
'AK45036828',
'AK45035038',
'AK45040138',
'AK45049238',
'AK45030338',
'AK45057338',
'AK45039338',
'AK45037538',
'AK45028938',
'AK45061048',
'AK45047048',
'AK45036648',
'AK45035748',
'AK45036948',
'AK45041058',
'AK45038158',
'AK45029258',
'AK45041358',
'AK45026558',
'AK45046758',
'AK45037858',
'AK45053068',
'AK45049168',
'AK45041568',
'AK45028568',
'AK45026768',
'AK45030078',
'AK45027178',
'AK45050278',
'AK45034278',
'AK45027378',
'AK45061478',
'AK45057478',
'AK45060578',
'AK45037678',
'AK45027778',
'AK45042878',
'AK45040188',
'AK45052188',
'AK45042288',
'AK45029288',
'AK45033488',
'AK45034688',
'AK45028888',
'AK45045988',
'AK45031098',
'AK45047098',
'AK45039098',
'AK45052398',
'AK45026398',
'AK45031498',
'AK45036698',
'AK45047698',
'AK45039698',
'AK45026798',
'AK45033898',
'AK45043898',
'AK45037009',
'AK45039209',
'AK45044309',
'AK45050409',
'AK45048409',
'AK45037909',
'AK45031219',
'AK45031519',
'AK45051519',
'AK45038519',
'AK45038619',
'AK45034819',
'AK45029029',
'AK45050229',
'AK45032329',
'AK45030629',
'AK45060729',
'AK45042929',
'AK45036929',
'AK45031039',
'AK45028039',
'AK45039139',
'AK45038339',
'AK45044739',
'AK45051839',
'AK45037839',
'AK45035049',
'AK45044249',
'AK45038349',
'AK45029349',
'AK45028549',
'AK45036749',
'AK45028949',
'AK45052059',
'AK45027059',
'AK45052159',
'AK45027159',
'AK45033259',
'AK45050659',
'AK45042659',
'AK45033959',
'AK45038269',
'AK45038369',
'AK45061469',
'AK45026469',
'AK45027469',
'AK45038769',
'AK45048769',
'AK45038079',
'AK45031479',
'AK45031579',
'AK45026779',
'AK45027779',
'AK45031089',
'AK45040189',
'AK45037189',
'AK45049289',
'AK45026389',
'AK45048689',
'AK45039689',
'AK45028889',
'AK45036989',
'AK45037099',
'AK45034299',
'AK45049299',
'AK45061399',
'AK45031499',
'AK45042499',
'AK45052599',
'AK45056599',
'AK45039699',
'AK45062799',
'AK45029799',
'AK45052899',
'AK45037999',
'AK45017168',
'AK45011000',
'AK45012200',
'AK45014300',
'AK44994500',
'AK45018800',
'AK45016110',
'AK45020410',
'AK45026020',
'AK45014220',
'AK45025820',
'AK45007820',
'AK45003530',
'AK45025530',
'AK45018530',
'AK45023730',
'AK45025150',
'AK45018450',
'AK45025060',
'AK45007360',
'AK45014760',
'AK45024170',
'AK45025170',
'AK45007270',
'AK45025770',
'AK45018870',
'AK45015590',
'AK45016890',
'AK45011990',
'AK45026001',
'AK45006301',
'AK45008501',
'AK45026011',
'AK45020111',
'AK45010711',
'AK45026031',
'AK45025131',
'AK45023231',
'AK45023431',
'AK44997831',
'AK45026041',
'AK45016261',
'AK45024661',
'AK45016861',
'AK45024171',
'AK45016171',
'AK45020871',
'AK45002081',
'AK45022081',
'AK45015981',
'AK45025891',
'AK45022102',
'AK45020202',
'AK45014302',
'AK45021602',
'AK45026012',
'AK45025112',
'AK45015212',
'AK45003312',
'AK45017512',
'AK45024712',
'AK45026022',
'AK45025122',
'AK45007222',
'AK45018322',
'AK45000532',
'AK45009532',
'AK45012632',
'AK45010732',
'AK45021442',
'AK45016842',
'AK45024552',
'AK45024752',
'AK45025952',
'AK45024362',
'AK45024172',
'AK45023472',
'AK45007472',
'AK45018472',
'AK45012382',
'AK44996382',
'AK45007482',
'AK45025782',
'AK45020982',
'AK45025982',
'AK45025792',
'AK45014403',
'AK45022603',
'AK45012713',
'AK45025713',
'AK45016713',
'AK45017523',
'AK45007823',
'AK45025743',
'AK45025943',
'AK45024753',
'AK45011563',
'AK44994763',
'AK45010273',
'AK44997473',
'AK44998283',
'AK45023383',
'AK45012583',
'AK45023193',
'AK45020893',
'AK45019104',
'AK45024204',
'AK45023504',
'AK45010604',
'AK44995924',
'AK44999924',
'AK45025534',
'AK45026044',
'AK45023144',
'AK45010244',
'AK45021744',
'AK45025944',
'AK45024754',
'AK45010264',
'AK45018464',
'AK45010274',
'AK45014474',
'AK45025874',
'AK45023974',
'AK45018084',
'AK45024384',
'AK45025394',
'AK45012594',
'AK45018794',
'AK45024994',
'AK45025994',
'AK45020005',
'AK45014405',
'AK45023505',
'AK44998115',
'AK45017515',
'AK45009615',
'AK45024715',
'AK45002125',
'AK45014225',
'AK44997825',
'AK45025135',
'AK45007835',
'AK45026045',
'AK45025545',
'AK45014645',
'AK45024355',
'AK45025165',
'AK45015565',
'AK45025565',
'AK45008965',
'AK45013475',
'AK45022575',
'AK45013975',
'AK45024385',
'AK45019485',
'AK45008095',
'AK45025906',
'AK45025216',
'AK45024716',
'AK45025126',
'AK45024536',
'AK45025736',
'AK45010936',
'AK45018446',
'AK45014156',
'AK45024356',
'AK45023456',
'AK45018456',
'AK45011656',
'AK45017656',
'AK45024756',
'AK45023266',
'AK45025566',
'AK45024176',
'AK45024476',
'AK44998476',
'AK45023676',
'AK45014776',
'AK45007776',
'AK44999976',
'AK45014186',
'AK45025786',
'AK45013886',
'AK44994886',
'AK44998196',
'AK45001296',
'AK44998496',
'AK45010317',
'AK45022417',
'AK45013027',
'AK45025037',
'AK45025537',
'AK45006247',
'AK45013347',
'AK45025547',
'AK45024847',
'AK45025847',
'AK45016157',
'AK45014757',
'AK45025757',
'AK45011367',
'AK45013367',
'AK45010467',
'AK44998467',
'AK45020077',
'AK45006177',
'AK45025087',
'AK45021287',
'AK45021587',
'AK44995597',
'AK45016208',
'AK45010308',
'AK45010608',
'AK45010908',
'AK45018818',
'AK45020918',
'AK45017918',
'AK45020128',
'AK45015128',
'AK45023328',
'AK45025728',
'AK45019928',
'AK45022038',
'AK45017038',
'AK45015538',
'AK45025538',
'AK45008538',
'AK45010838',
'AK45011158',
'AK45025158',
'AK45016158',
'AK45024358',
'AK45000458',
'AK45024758',
'AK45018868',
'AK45010578',
'AK45010188',
'AK45014188',
'AK45014688',
'AK45024888',
'AK45005498',
'AK45008498',
'AK45015898',
'AK45025909',
'AK45025119',
'AK44996029',
'AK45010729',
'AK45006829',
'AK45025039',
'AK45023439',
'AK45023839',
'AK45010939',
'AK45026049',
'AK45025149',
'AK45022249',
'AK45025649',
'AK45025949',
'AK45009159',
'AK45010259',
'AK45024359',
'AK44999069',
'AK45004169',
'AK45024169',
'AK45018469',
'AK44994569',
'AK45010279',
'AK45022379',
'AK45018379',
'AK44999689',
'AK45022099',
'AK45025099',
'AK45025499',
'AK44932100',
'AK44932110',
'AK44932070',
'AK44932011',
'AK44932211',
'AK44932061',
'AK44932023',
'AK44932223',
'AK44932283',
'AK44931904',
'AK44932124',
'AK44932174',
'AK44932125',
'AK44932075',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20200713_1310_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
