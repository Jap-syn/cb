<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20201209_1415_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK48804445',
'AK48837138',
'AK48836111',
'AK48791429',
'AK48800830',
'AK48986568',
'AK48836300',
'AK48862140',
'AK48863147',
'AK48862357',
'AK48862480',
'AK48862538',
'AK48862369',
'AK48894038',
'AK48861721',
'AK48860571',
'AK48838872',
'AK48862583',
'AK48860684',
'AK48861655',
'AK48835665',
'AK48836747',
'AK48861068',
'AK48836179',
'AK48833064',
'AK48830298',
'AK49306906',
'AK48831640',
'AK48752068',
'AK48761837',
'AK48835696',
'AK48848660',
'AK48804545',
'AK48893348',
'AK48842873',
'AK48841833',
'AK48838680',
'AK48836448',
'AK48831476',
'AK48820691',
'AK48801289',
'AK48781265',
'AK48778063',
'AK48815159',
'AK48861953',
'AK48860993',
'AK48824129',
'AK48832594',
'AK48843835',
'AK48797856',
'AK49307461',
'AK48831332',
'AK48858018',
'AK48765523',
'AK48787847',
'AK48894126',
'AK48832427',
'AK48768834',
'AK48783066',
'AK48858558',
'AK48786132',
'AK48783269',
'AK48859997',
'AK48835217',
'AK48798760',
'AK48893976',
'AK48857491',
'AK48777781',
'AK48852817',
'AK48778624',
'AK48798841',
'AK49306820',
'AK48797888',
'AK48856622',
'AK48783153',
'AK48824913',
'AK48862540',
'AK48861977',
'AK48803885',
'AK48778124',
'AK48783221',
'AK48860806',
'AK48894496',
'AK49306892',
'AK48835132',
'AK48763208',
'AK48824615',
'AK48853588',
'AK48851527',
'AK48821842',
'AK48750765',
'AK48805642',
'AK48766051',
'AK48782721',
'AK48819633',
'AK48859425',
'AK48851624',
'AK48804485',
'AK48809519',
'AK48762661',
'AK48816979',
'AK48814958',
'AK48826431',
'AK48809597',
'AK48766032',
'AK48790493',
'AK48862661',
'AK49307409',
'AK48817186',
'AK48831221',
'AK48785713',
'AK48796801',
'AK48819040',
'AK48774386',
'AK48765957',
'AK48893694',
'AK48748318',
'AK48787846',
'AK48783240',
'AK48792914',
'AK48799717',
'AK48862923',
'AK48768872',
'AK48800497',
'AK48750971',
'AK48788739',
'AK48800573',
'AK48833013',
'AK48832139',
'AK48772991',
'AK48815699',
'AK48821473',
'AK48771362',
'AK48787637',
'AK48797860',
'AK48857023',
'AK48830724',
'AK48794896',
'AK48854365',
'AK48815954',
'AK48859607',
'AK48825317',
'AK48802327',
'AK48803726',
'AK48766624',
'AK48795424',
'AK48848107',
'AK48986277',
'AK48804533',
'AK48855883',
'AK48846456',
'AK48767655',
'AK48748865',
'AK48831296',
'AK48838397',
'AK48791032',
'AK48791412',
'AK48805789',
'AK48778450',
'AK48796413',
'AK48794355',
'AK48831405',
'AK48824138',
'AK48768074',
'AK48783005',
'AK48824320',
'AK48783010',
'AK48813490',
'AK48781159',
'AK48862640',
'AK48785866',
'AK48783588',
'AK48830812',
'AK48835115',
'AK48851357',
'AK48823071',
'AK48862623',
'AK48778610',
'AK48826074',
'AK48783115',
'AK48845324',
'AK48830379',
'AK48831173',
'AK48828024',
'AK48794132',
'AK48859533',
'AK48776703',
'AK48853186',
'AK48863780',
'AK48838988',
'AK48716128',
'AK48858521',
'AK48830521',
'AK48826895',
'AK48799311',
'AK48793202',
'AK48799363',
'AK48795115',
'AK48847981',
'AK48858119',
'AK48818104',
'AK48800011',
'AK48810385',
'AK48813802',
'AK48801359',
'AK48789350',
'AK48844988',
'AK48830850',
'AK48829089',
'AK48829203',
'AK48852052',
'AK48837727',
'AK48847061',
'AK48804913',
'AK48829314',
'AK48809683',
'AK48852399',
'AK48841622',
'AK48799242',
'AK48813774',
'AK48761166',
'AK48844294',
'AK48808856',
'AK48862284',
'AK48830524',
'AK48764740',
'AK48788550',
'AK48818236',
'AK48823215',
'AK48830306',
'AK48845226',
'AK48748854',
'AK48844296',
'AK48827700',
'AK48823541',
'AK48781841',
'AK48760116',
'AK48847005',
'AK48833867',
'AK48894610',
'AK48756930',
'AK48774742',
'AK48809206',
'AK48860133',
'AK49306888',
'AK48834551',
'AK48802584',
'AK48834560',
'AK48761120',
'AK48862211',
'AK48861925',
'AK48824616',
'AK48762110',
'AK48818819',
'AK48827013',
'AK48787968',
'AK48826179',
'AK48817666',
'AK48790402',
'AK48775254',
'AK48821874',
'AK48849874',
'AK48835871',
'AK48816504',
'AK48790364',
'AK48751239',
'AK48848190',
'AK48831765',
'AK48778806',
'AK48715975',
'AK48856439',
'AK48818294',
'AK48797036',
'AK47938970',
'AK47118377',
'AK48844822',
'AK48846559',
'AK48851210',
'AK48845690',
'AK48853541',
'AK48843612',
'AK48857322',
'AK48849742',
'AK48843844',
'AK48854944',
'AK48844889',
'AK48857000',
'AK48846200',
'AK48856200',
'AK48840300',
'AK48844210',
'AK48848610',
'AK48854420',
'AK48851920',
'AK48840030',
'AK48855740',
'AK48858280',
'AK48853580',
'AK48848690',
'AK48854890',
'AK48844990',
'AK48841301',
'AK48851601',
'AK48858211',
'AK48857421',
'AK48854821',
'AK48841131',
'AK48851831',
'AK48846951',
'AK48840761',
'AK48845871',
'AK48852412',
'AK48842512',
'AK48856122',
'AK48845222',
'AK48843522',
'AK48845232',
'AK48843732',
'AK48844542',
'AK48856742',
'AK48846052',
'AK48843852',
'AK48856672',
'AK48843772',
'AK48844872',
'AK48852972',
'AK48858882',
'AK48853892',
'AK48844223',
'AK48845333',
'AK48855633',
'AK48858833',
'AK48843643',
'AK48853643',
'AK48855973',
'AK48852604',
'AK48853804',
'AK48845034',
'AK48851534',
'AK48847934',
'AK48843154',
'AK48844264',
'AK48844464',
'AK48850374',
'AK48848774',
'AK48845684',
'AK48853905',
'AK48840315',
'AK48846445',
'AK48839655',
'AK48855955',
'AK48848265',
'AK48849465',
'AK48840006',
'AK48845606',
'AK48845916',
'AK48850826',
'AK48844826',
'AK48842926',
'AK48839536',
'AK48853746',
'AK48851256',
'AK48846666',
'AK48844076',
'AK48844686',
'AK48840696',
'AK48854327',
'AK48857137',
'AK48844437',
'AK48856437',
'AK48845157',
'AK48843277',
'AK48844287',
'AK48846008',
'AK48844608',
'AK48843908',
'AK48853118',
'AK48848918',
'AK48844728',
'AK48843138',
'AK48848238',
'AK48857858',
'AK48841368',
'AK48839778',
'AK48854098',
'AK48857298',
'AK48856409',
'AK48854059',
'AK48844389',
'AK48853789',
'AK48824783',
'AK48859070',
'AK48789247',
'AK48746012',
'AK48823048',
'AK48747995',
'AK48845048',
'AK48829758',
'AK48810607',
'AK48783487',
'AK48834922',
'AK48849376',
'AK48854428',
'AK48847310',
'AK48802131',
'AK48778832',
'AK48748973',
'AK48757668',
'AK48768909',
'AK48790350',
'AK48795381',
'AK48770824',
'AK48747305',
'AK48813216',
'AK48853753',
'AK48766209',
'AK48782926',
'AK48781408',
'AK48798247',
'AK48800659',
'AK48790113',
'AK48774270',
'AK48839561',
'AK48824870',
'AK48844515',
'AK48800304',
'AK48824346',
'AK48836286',
'AK48829488',
'AK48795897',
'AK48815657',
'AK48715994',
'AK48716069',
'AK48853219',
'AK48856254',
'AK48986332',
'AK48775006',
'AK48856247',
'AK48825933',
'AK48766691',
'AK48817475',
'AK48790303',
'AK48788045',
'AK48844981',
'AK48746235',
'AK48853560',
'AK48838748',
'AK48986484',
'AK48834780',
'AK48765615',
'AK48775511',
'AK48806626',
'AK48850984',
'AK48846348',
'AK48825568',
'AK48862920',
'AK48861061',
'AK48801916',
'AK48840525',
'AK48746201',
'AK48796072',
'AK48845569',
'AK48846299',
'AK48778407',
'AK48756138',
'AK48793562',
'AK48829518',
'AK48858626',
'AK48831706',
'AK48765604',
'AK48832925',
'AK48783147',
'AK48843967',
'AK48768721',
'AK48786676',
'AK48825977',
'AK48835519',
'AK48791488',
'AK48818913',
'AK48835751',
'AK48825622',
'AK48824216',
'AK48764232',
'AK48805392',
'AK48795338',
'AK48794678',
'AK48827954',
'AK48755977',
'AK48750248',
'AK48859657',
'AK48861336',
'AK48811128',
'AK48863516',
'AK48790069',
'AK48893827',
'AK48844966',
'AK48786200',
'AK48861404',
'AK49056271',
'AK48745338',
'AK48761533',
'AK48821758',
'AK48774920',
'AK48784542',
'AK48828140',
'AK48769384',
'AK48860795',
'AK48819932',
'AK48827491',
'AK48848714',
'AK48818046',
'AK48862678',
'AK48838047',
'AK48819141',
'AK48855443',
'AK48818791',
'AK48860657',
'AK48805412',
'AK48861407',
'AK48825256',
'AK48765617',
'AK48816779',
'AK48779061',
'AK48828918',
'AK48836456',
'AK48784981',
'AK48817352',
'AK48784835',
'AK48807859',
'AK49307494',
'AK48780885',
'AK48778626',
'AK48802919',
'AK48804320',
'AK48846069',
'AK48846653',
'AK48798764',
'AK48774151',
'AK48782785',
'AK48791171',
'AK48839532',
'AK48848734',
'AK48850813',
'AK48853007',
'AK48821454',
'AK48768022',
'AK48753717',
'AK48822677',
'AK48856561',
'AK48986436',
'AK48861823',
'AK48818469',
'AK48776213',
'AK48854872',
'AK48831086',
'AK48771106',
'AK48832789',
'AK48757140',
'AK48751340',
'AK48806494',
'AK48772916',
'AK48745420',
'AK48855182',
'AK48842653',
'AK48852030',
'AK48766374',
'AK48821809',
'AK48861025',
'AK48834601',
'AK48778179',
'AK48843760',
'AK48829934',
'AK48826637',
'AK48801845',
'AK48798666',
'AK48781919',
'AK48806394',
'AK48854322',
'AK48849644',
'AK48798146',
'AK48853242',
'AK48855447',
'AK48799719',
'AK48777533',
'AK48986418',
'AK48844122',
'AK48841079',
'AK49306947',
'AK48019266',
'AK48849315',
'AK48846123',
'AK48825356',
'AK48765123',
'AK48806319',
'AK48814327',
'AK47970129',
'AK47939442',
'AK49307230',
'AK49307290',
'AK49307021',
'AK49306952',
'AK49306984',
'AK49306995',
'AK49307066',
'AK49307486',
'AK49307196',
'AK49306917',
'AK49306827',
'AK49307257',
'AK49306977',
'AK49306818',
'AK49307439',
'AK49307099',
'AK48986500',
'AK48986460',
'AK48986170',
'AK48986491',
'AK48986222',
'AK48986562',
'AK48986623',
'AK48986455',
'AK48986306',
'AK48986546',
'AK48986466',
'AK48986427',
'AK48986477',
'AK48986458',
'AK48986468',
'AK48893701',
'AK48893421',
'AK48894361',
'AK48894143',
'AK48893693',
'AK48894074',
'AK48894574',
'AK48894184',
'AK48894065',
'AK48894108',
'AK48892808',
'AK48892728',
'AK48833000',
'AK48859600',
'AK48860800',
'AK48824310',
'AK48839220',
'AK48824620',
'AK48837620',
'AK48827530',
'AK48834040',
'AK48824340',
'AK48862440',
'AK48859440',
'AK48831150',
'AK48833450',
'AK48832750',
'AK48835950',
'AK48860160',
'AK48863170',
'AK48860970',
'AK48860480',
'AK48821480',
'AK48821880',
'AK48835190',
'AK48860290',
'AK48862290',
'AK48862401',
'AK48831601',
'AK48862701',
'AK48837701',
'AK48826511',
'AK48822221',
'AK48863221',
'AK48860521',
'AK48822621',
'AK48828921',
'AK48820331',
'AK48838731',
'AK48829731',
'AK48836141',
'AK48860441',
'AK48860541',
'AK48859741',
'AK48820841',
'AK48837051',
'AK48860461',
'AK48824071',
'AK48862271',
'AK48860371',
'AK48821771',
'AK48860081',
'AK48861281',
'AK48833581',
'AK48839091',
'AK48830191',
'AK48824191',
'AK48861991',
'AK48860502',
'AK48832602',
'AK48858702',
'AK48863112',
'AK48835122',
'AK48829032',
'AK48824432',
'AK48862632',
'AK48830732',
'AK48859732',
'AK48837932',
'AK48831242',
'AK48833342',
'AK48825052',
'AK48822852',
'AK48831162',
'AK48861662',
'AK48824962',
'AK48834272',
'AK48822372',
'AK48826472',
'AK48860672',
'AK48836382',
'AK48830982',
'AK48823092',
'AK48821192',
'AK48825992',
'AK48836303',
'AK48859513',
'AK48861713',
'AK48861233',
'AK48833233',
'AK48834533',
'AK48860743',
'AK48825153',
'AK48833253',
'AK48823353',
'AK48827653',
'AK48832853',
'AK48824163',
'AK48863673',
'AK48860973',
'AK48831183',
'AK48823383',
'AK48860483',
'AK48836983',
'AK48825293',
'AK48821993',
'AK48824304',
'AK48820604',
'AK48835804',
'AK48834214',
'AK48836214',
'AK48822314',
'AK48824514',
'AK48829614',
'AK48830224',
'AK48858224',
'AK48839224',
'AK48825924',
'AK48836634',
'AK48836344',
'AK48862554',
'AK48824754',
'AK48831954',
'AK48836764',
'AK48860374',
'AK48830974',
'AK48833974',
'AK48863184',
'AK48860094',
'AK48827894',
'AK48838305',
'AK48824315',
'AK48831815',
'AK48862725',
'AK48839435',
'AK48820535',
'AK48859635',
'AK48860145',
'AK48820645',
'AK48827745',
'AK48826945',
'AK48860655',
'AK48860265',
'AK48862665',
'AK48826175',
'AK48830275',
'AK48824975',
'AK48835975',
'AK48860285',
'AK48831785',
'AK48837295',
'AK48824895',
'AK48829895',
'AK48831106',
'AK48837106',
'AK48838106',
'AK48824306',
'AK48836706',
'AK48825806',
'AK48827016',
'AK48835916',
'AK48838916',
'AK48839036',
'AK48838136',
'AK48832436',
'AK48828436',
'AK48860446',
'AK48837746',
'AK48861946',
'AK48821256',
'AK48836656',
'AK48860756',
'AK48825956',
'AK48823476',
'AK48838876',
'AK48859086',
'AK48823186',
'AK48860586',
'AK48829496',
'AK48827696',
'AK48860796',
'AK48838007',
'AK48831207',
'AK48863817',
'AK48838917',
'AK48835127',
'AK48837227',
'AK48823927',
'AK48824037',
'AK48862137',
'AK48824237',
'AK48864237',
'AK48836237',
'AK48860557',
'AK48831757',
'AK48829857',
'AK48831177',
'AK48825287',
'AK48829787',
'AK48824097',
'AK48825097',
'AK48862397',
'AK48860597',
'AK48829997',
'AK48835008',
'AK48826008',
'AK48826308',
'AK48820708',
'AK48830708',
'AK48862118',
'AK48827718',
'AK48835918',
'AK48827428',
'AK48830828',
'AK48824338',
'AK48859538',
'AK48861638',
'AK48831738',
'AK48832838',
'AK48826348',
'AK48830958',
'AK48831168',
'AK48829668',
'AK48859768',
'AK48830868',
'AK48820778',
'AK48861388',
'AK48860588',
'AK48836009',
'AK48864019',
'AK48828319',
'AK48824229',
'AK48861629',
'AK48835929',
'AK48835039',
'AK48838139',
'AK48861239',
'AK48836339',
'AK48860539',
'AK48860639',
'AK48828739',
'AK48821939',
'AK48832549',
'AK48822649',
'AK48861949',
'AK48860359',
'AK48837659',
'AK48825959',
'AK48825069',
'AK48861269',
'AK48826269',
'AK48828369',
'AK48862669',
'AK48862679',
'AK48825779',
'AK48861289',
'AK48831389',
'AK48862299',
'AK48838599',
'AK48822999',
'AK48790100',
'AK48771100',
'AK48798100',
'AK48765200',
'AK48773400',
'AK48750900',
'AK48818210',
'AK48762310',
'AK48775410',
'AK48790510',
'AK48803610',
'AK48808020',
'AK48820120',
'AK48758220',
'AK48787130',
'AK48797230',
'AK48788230',
'AK48815930',
'AK48803040',
'AK48804240',
'AK48767240',
'AK48761840',
'AK48802250',
'AK48800350',
'AK48806750',
'AK48803660',
'AK48817760',
'AK48763860',
'AK48783070',
'AK48749170',
'AK48763470',
'AK48782570',
'AK48771670',
'AK48763970',
'AK48812280',
'AK48768380',
'AK48750580',
'AK48758680',
'AK48792290',
'AK48750390',
'AK48801490',
'AK48811890',
'AK48793890',
'AK48819001',
'AK48787101',
'AK48778901',
'AK48795011',
'AK48765511',
'AK48817611',
'AK48807121',
'AK48766421',
'AK48769131',
'AK48789231',
'AK48798831',
'AK48808041',
'AK48779141',
'AK48790241',
'AK48816641',
'AK48801841',
'AK48801451',
'AK48789751',
'AK48750261',
'AK48775661',
'AK48800961',
'AK48781171',
'AK48815281',
'AK48813481',
'AK48808481',
'AK48801681',
'AK48802781',
'AK48817781',
'AK48774981',
'AK48783391',
'AK48771791',
'AK48745891',
'AK48808991',
'AK48745402',
'AK48770602',
'AK48766212',
'AK48747212',
'AK48768312',
'AK48814412',
'AK48774412',
'AK48786612',
'AK48819612',
'AK48755912',
'AK48794422',
'AK48764522',
'AK48806232',
'AK48769532',
'AK48767732',
'AK48815242',
'AK48782342',
'AK48748942',
'AK48799152',
'AK48816652',
'AK48770062',
'AK48793062',
'AK48814062',
'AK48805662',
'AK48770072',
'AK48785272',
'AK48779372',
'AK48763572',
'AK48816972',
'AK48789972',
'AK48769482',
'AK48794392',
'AK48799892',
'AK48816203',
'AK48816603',
'AK48763803',
'AK48763513',
'AK48762713',
'AK48762813',
'AK48772223',
'AK48777423',
'AK48796823',
'AK48798733',
'AK48817833',
'AK48779143',
'AK48801643',
'AK48801253',
'AK48762253',
'AK48816653',
'AK48798753',
'AK48786853',
'AK48800953',
'AK48782953',
'AK48783463',
'AK48786073',
'AK48783473',
'AK48767773',
'AK48802873',
'AK48804783',
'AK48798193',
'AK48817493',
'AK48748104',
'AK48801304',
'AK48802304',
'AK48786504',
'AK48788504',
'AK48798804',
'AK48765014',
'AK48783214',
'AK48798314',
'AK48796224',
'AK48774424',
'AK48761724',
'AK48783724',
'AK48765924',
'AK48816234',
'AK48816334',
'AK48817334',
'AK48790434',
'AK48766934',
'AK48810044',
'AK48783144',
'AK48768654',
'AK48769854',
'AK48799164',
'AK48762464',
'AK48819764',
'AK48797174',
'AK48799174',
'AK48779374',
'AK48814974',
'AK48795974',
'AK48763184',
'AK48788384',
'AK48818194',
'AK48817394',
'AK48784494',
'AK48766035',
'AK48756135',
'AK48768135',
'AK48818635',
'AK48814045',
'AK48784445',
'AK48809745',
'AK48795055',
'AK48752255',
'AK48799755',
'AK48803855',
'AK48810955',
'AK48794565',
'AK48791375',
'AK48779575',
'AK48805775',
'AK48814385',
'AK48767785',
'AK48767195',
'AK48813695',
'AK48754795',
'AK48806795',
'AK48783406',
'AK48799606',
'AK48808116',
'AK48807616',
'AK48804916',
'AK48785326',
'AK48784426',
'AK48761626',
'AK48813036',
'AK48776236',
'AK48747336',
'AK48798836',
'AK48755146',
'AK48787146',
'AK48802246',
'AK48817246',
'AK48784446',
'AK48776546',
'AK48803056',
'AK48798156',
'AK48758556',
'AK48803856',
'AK48804856',
'AK48809466',
'AK48801566',
'AK48798766',
'AK48751966',
'AK48783076',
'AK48783176',
'AK48799176',
'AK48801676',
'AK48798676',
'AK48815776',
'AK48798776',
'AK48765186',
'AK48812196',
'AK48805496',
'AK48809496',
'AK48793596',
'AK48796996',
'AK48803407',
'AK48784707',
'AK48750807',
'AK48796807',
'AK48806907',
'AK48789627',
'AK48786037',
'AK48771337',
'AK48786837',
'AK48800247',
'AK48804647',
'AK48799947',
'AK48786157',
'AK48779157',
'AK48817357',
'AK48808457',
'AK48746757',
'AK48800377',
'AK48814777',
'AK48746687',
'AK48753197',
'AK48779597',
'AK48764897',
'AK48782997',
'AK48816008',
'AK48783108',
'AK48755208',
'AK48801318',
'AK48773718',
'AK48805428',
'AK48793628',
'AK48746728',
'AK48785828',
'AK48815138',
'AK48803438',
'AK48819738',
'AK48760348',
'AK48774448',
'AK48805448',
'AK48767848',
'AK48788158',
'AK48747358',
'AK48748658',
'AK48793858',
'AK48780958',
'AK48762968',
'AK48750278',
'AK48813978',
'AK48759978',
'AK48810388',
'AK48807988',
'AK48768598',
'AK48787109',
'AK48801409',
'AK48768609',
'AK48793909',
'AK48782019',
'AK48764119',
'AK48794419',
'AK48819029',
'AK48768129',
'AK48801729',
'AK48765829',
'AK48819929',
'AK48765139',
'AK48801549',
'AK48819749',
'AK48811849',
'AK48799849',
'AK48817159',
'AK48786569',
'AK48809769',
'AK48802379',
'AK48779379',
'AK48817479',
'AK48815679',
'AK48755679',
'AK48798879',
'AK48788189',
'AK48802289',
'AK48817389',
'AK48764589',
'AK48747789',
'AK48808299',
'AK48792399',
'AK48777399',
'AK48776799',
'AK48798899',
'AK48716130',
'AK48715960',
'AK48715982',
'AK48716033',
'AK48716094',
'AK48716125',
'AK48715955',
'AK48716016',
'AK48716126',
'AK48716156',
'AK48716186',
'AK48716196',
'AK48715987',
'AK48716138',
'AK48716119',
'AK48862000',
'AK47680669',
'AK48514745',
'AK47291510',
'AK47628593',
'AK47620127',
'AK48478228',
'AK48506330',
'AK48393224',
'AK48410200',
'AK48637861',
'AK45993942',
'AB49104791',
'AK48820305',
'AK48632263',
'AK48632261',
'AK48692590',
'AK48900253',
'AK48962680',
'AK49136720',
'AK49193628',
'AK49265845',
'AK49156433',
'AK48896526',
'AK48953099',
'AK48555041',
'AK48135961',
'AK47682251',
'AK49309727',
'AK48987730',
'AK48878995',
'AK48987157',
'AK49259947',
'AK48641184',
'AK48677751',
'AK49259928',
'AK48981250',
'AK49059804',
'AK49096517',
'AK49096515',
'AK49206637',
'AK49206572',
'AK48677708',
'AK48893241',
'AK48976796',
'AK49096578',
'AK49146907',
'AK49184572',
'AK49064802',
'AK48675711',
'AK48641345',
'AK48914604',
'AK48727619',
'AK48641373',
'AK48773706',
'AK49231033',
'AK49147172',
'AK47316440',
'AK48747207',
'AK47624264',
'AK47624278',
'AK49260231',
'AK49260232',
'AK49260224',
'AK49260234',
'AK49260227',
'AK49260228',
'AK49260248',
'AK49294477',
'AK49294478',
'AK49316882',
'AK49316884',
'AK49316885',
'AK48679552',
'AK48591250',
'AK48591025',
'AK48591038',
'AK48591159',
'AK48591879',
'AK48645257',
'AK48679510',
'AK48703925',
'AK48708001',
'AK48778467',
'AK48918936',
'AK48967994',
'AK48967799',
'AK48967816',
'AK49039903',
'AK49126943',
'AK49127063',
'AK49127125',
'AK49126462',
'AK49236633',
'AK49236774',
'AK49127098',
'AK49236723',
'AK49238925',
'AK49268812',
'AK49316880',
'AK49316886',
'AK48907803',
'AK48871080',
'AK49345301',
'AK49255793',
'AK49255367',
'AK48621016',
'AK48864760',
'AK48618233',
'AK48734845',
'AK48720758',
'AK49019808',
'AK48981621',
'AK48999284',
'AK49039097',
'AK49090676',
'AK49090325',
'AK49090111',
'AK49205777',
'AK49206658',
'AK49119489',
'AK49014304',
'AK49208090',
'AK48651348',
'AK48571733',
'AK48455335',
'AK48528622',
'AK48632353',
'AK48920707',
'AK48745112',
'AK49162036',
'AK48090281',
'AK49245377',
'AK49178659',
'AK49194419',
'AK48746148',
'AK49245391',
'AK48617991',
'AK48940465',
'AK48940491',
'AK48940472',
'AK48744765',
'AK48940501',
'AK49020453',
'AK49162156',
'AK48633759',
'AK48940488',
'AK48940496',
'AK49049256',
'AK49127548',
'AK49164674',
'AK49162139',
'AK49352354',
'AK49115242',
'AK49194338',
'AK49147375',
'AK48630452',
'AK48693265',
'AK48692597',
'AK48966138',
'AK49020689',
'AK48301180',
'AK48301181',
'AK48301182',
'AK48301192',
'AK48301183',
'AK48301195',
'AK48301186',
'AK48301196',
'AK48301187',
'AK48301179',
'AK48518611',
'AK48518691',
'AK48518712',
'AK48518573',
'AK48518665',
'AK48518606',
'AK48518588',
'AK48518600',
'AK48602282',
'AK48602300',
'AK48602530',
'AK48602340',
'AK48602350',
'AK48602490',
'AK48602242',
'AK48602362',
'AK48602272',
'AK48602292',
'AK48602323',
'AK48602533',
'AK48602374',
'AK48602405',
'AK48602455',
'AK48602465',
'AK48602587',
'AK48602408',
'AK48602318',
'AK48602418',
'AK48602338',
'AK48602578',
'AK48602598',
'AK48617931',
'AK48617981',
'AK48617973',
'AK48617934',
'AK48618005',
'AK48618065',
'AK48617965',
'AK48617995',
'AK48617976',
'AK48617986',
'AK48618059',
'AK48571527',
'AK48571593',
'AK48571622',
'AK48571627',
'AK48633760',
'AK48633754',
'AK48633756',
'AK48633757',
'AK48658292',
'AK48658313',
'AK48658324',
'AK48658307',
'AK48692531',
'AK48692613',
'AK48692565',
'AK48692556',
'AK48746192',
'AK48745925',
'AK48744929',
'AK48744803',
'AK48746620',
'AK48745140',
'AK48745960',
'AK48746070',
'AK48746121',
'AK48746131',
'AK48745731',
'AK48746151',
'AK48745061',
'AK48745491',
'AK48746591',
'AK48745912',
'AK48745922',
'AK48745662',
'AK48745772',
'AK48745403',
'AK48746213',
'AK48745643',
'AK48746163',
'AK48745883',
'AK48746104',
'AK48746604',
'AK48746614',
'AK48745914',
'AK48745324',
'AK48745724',
'AK48746634',
'AK48744844',
'AK48744854',
'AK48745684',
'AK48746105',
'AK48746325',
'AK48746035',
'AK48745335',
'AK48744945',
'AK48745855',
'AK48744965',
'AK48746075',
'AK48744875',
'AK48746195',
'AK48744706',
'AK48746516',
'AK48745736',
'AK48745046',
'AK48746066',
'AK48746576',
'AK48744976',
'AK48746086',
'AK48745896',
'AK48746407',
'AK48746017',
'AK48745717',
'AK48745747',
'AK48744857',
'AK48746067',
'AK48745787',
'AK48745797',
'AK48745208',
'AK48746638',
'AK48746548',
'AK48745948',
'AK48746168',
'AK48745778',
'AK48745978',
'AK48746509',
'AK48745219',
'AK48746519',
'AK48746129',
'AK48746629',
'AK48745149',
'AK48746359',
'AK48744769',
'AK48744869',
'AK48745969',
'AK48746579',
'AK48745099',
'AK48940483',
'AK48940300',
'AK48940500',
'AK48940430',
'AK48940530',
'AK48940470',
'AK48940490',
'AK48940401',
'AK48940511',
'AK48940421',
'AK48940431',
'AK48940531',
'AK48940441',
'AK48940451',
'AK48940461',
'AK48940481',
'AK48940391',
'AK48940502',
'AK48940512',
'AK48940522',
'AK48940332',
'AK48940462',
'AK48940372',
'AK48940482',
'AK48940492',
'AK48940423',
'AK48940443',
'AK48940473',
'AK48940404',
'AK48940414',
'AK48940434',
'AK48940444',
'AK48940364',
'AK48940274',
'AK48940394',
'AK48940505',
'AK48940415',
'AK48940515',
'AK48940425',
'AK48940525',
'AK48940285',
'AK48940495',
'AK48940406',
'AK48940446',
'AK48940456',
'AK48940476',
'AK48940486',
'AK48940396',
'AK48940407',
'AK48940417',
'AK48940327',
'AK48940427',
'AK48940447',
'AK48940457',
'AK48940467',
'AK48940477',
'AK48940387',
'AK48940397',
'AK48940497',
'AK48940408',
'AK48940508',
'AK48940318',
'AK48940418',
'AK48940528',
'AK48940348',
'AK48940458',
'AK48940498',
'AK48940409',
'AK48940419',
'AK48940519',
'AK48940529',
'AK48940449',
'AK48940289',
'AK48940399',
'AK48940499',
'AK49020659',
'AK49020630',
'AK49020540',
'AK49020380',
'AK49020590',
'AK49020421',
'AK49020521',
'AK49020541',
'AK49020502',
'AK49020702',
'AK49020572',
'AK49020503',
'AK49020703',
'AK49020433',
'AK49020663',
'AK49020593',
'AK49020524',
'AK49020434',
'AK49020574',
'AK49020705',
'AK49020425',
'AK49020525',
'AK49020725',
'AK49020635',
'AK49020475',
'AK49020595',
'AK49020636',
'AK49020446',
'AK49020576',
'AK49020586',
'AK49020438',
'AK49020539',
'AK49020549',
'AK49049320',
'AK49049231',
'AK49049291',
'AK49049372',
'AK49049403',
'AK49049293',
'AK49049254',
'AK49049374',
'AK49049365',
'AK49049306',
'AK49049276',
'AK49049249',
'AK49049334',
'AK49049394',
'AK49081641',
'AK49081651',
'AK49081642',
'AK49081662',
'AK49081692',
'AK49081693',
'AK49081675',
'AK49081695',
'AK49081647',
'AK49081657',
'AK49081767',
'AK49081728',
'AK49081709',
'AK49081739',
'AK49081749',
'AK49081659',
'AK49081669',
'AK49115000',
'AK49115100',
'AK49115020',
'AK49114970',
'AK49114941',
'AK49115251',
'AK49115202',
'AK49114972',
'AK49115233',
'AK49115224',
'AK49115225',
'AK49115006',
'AK49115026',
'AK49115126',
'AK49115236',
'AK49115186',
'AK49114977',
'AK49115238',
'AK49115168',
'AK49162110',
'AK49161830',
'AK49162060',
'AK49161980',
'AK49162001',
'AK49162121',
'AK49161941',
'AK49161971',
'AK49161891',
'AK49161862',
'AK49161843',
'AK49162073',
'AK49162004',
'AK49162114',
'AK49161964',
'AK49161894',
'AK49161994',
'AK49162115',
'AK49161845',
'AK49161865',
'AK49162126',
'AK49162146',
'AK49161896',
'AK49162197',
'AK49162128',
'AK49161858',
'AK49162019',
'AK49162039',
'AK49162059',
'AK49161869',
'AK49161989',
'AK49137774',
'AK49137716',
'AK49137710',
'AK49137850',
'AK49137701',
'AK49137691',
'AK49137752',
'AK49137703',
'AK49137713',
'AK49137744',
'AK49137694',
'AK49137745',
'AK49137755',
'AK49137736',
'AK49137737',
'AK49137789',
'AK49178510',
'AK49178650',
'AK49178512',
'AK49178652',
'AK49178704',
'AK49178615',
'AK49178565',
'AK49178626',
'AK49178646',
'AK49178687',
'AK49194398',
'AK49194450',
'AK49194301',
'AK49194351',
'AK49194491',
'AK49194412',
'AK49194432',
'AK49194282',
'AK49194492',
'AK49194403',
'AK49194323',
'AK49194293',
'AK49194393',
'AK49194414',
'AK49194334',
'AK49194434',
'AK49194344',
'AK49194354',
'AK49194374',
'AK49194474',
'AK49194484',
'AK49194235',
'AK49194255',
'AK49194355',
'AK49194455',
'AK49194365',
'AK49194267',
'AK49194367',
'AK49194487',
'AK49194258',
'AK49194278',
'AK49194359',
'AK49194289',
'AK49222460',
'AK49222412',
'AK49222472',
'AK49222292',
'AK49222495',
'AK49222478',
'AK49222447',
'AK49245410',
'AK49245321',
'AK49245371',
'AK49245414',
'AK49245444',
'AK49245456',
'AK49245396',
'AK49245318',
'AK49245339',
'AK49274860',
'AK49275370',
'AK49274770',
'AK49275041',
'AK49274822',
'AK49274832',
'AK49274842',
'AK49274762',
'AK49274553',
'AK49274824',
'AK49274844',
'AK49275356',
'AK49275257',
'AK49275038',
'AK49274819',
'AK49274839',
'AK49275199',
'AK49137580',
'AK49245323',
'AK48633751',
'AK48602462',
'AK46829143',
'AK48940398',
'AK48301177',
'AK49081595',
'AK49115025',
'AK48633753',
'AK49020652',
'AK49020495',
'AK48940433',
'AK49137791',
'AK48518618',
'AK48602475',
'AK48746376',
'AK48744913',
'AK48744943',
'AK48745031',
'AK48940411',
'AK48940506',
'AK48940514',
'AK49020597',
'AK49081704',
'AK49194493',
'AK49274749',
'AK49137768',
'AK49194445',
'AK48940454',
'AK49312041',
'AK48454971',
'AK48571770',
'AK47004182',
'AK48746011',
'AK49035006',
'AK48682595',
'AK48707918',
'AK48943011',
'AK49073570',
'AK49065657',
'AK49152246',
'AK48707050',
'AK49102749',
'AK48558455',
'AK49237861',
'AK48595292',
'AK48595367',
'AK48646795',
'AK48708663',
'AK48708674',
'AK48798403',
'AK48798197',
'AK48798191',
'AK48953600',
'AK48953484',
'AK48953596',
'AK48953471',
'AK49107490',
'AK49107937',
'AK49267464',
'AK48954694',
'AK48708646',
'AK48684221',
'AK49107434',
'AK48595136',
'AK48671254',
'AK49035523',
'AK49259642',
'AK48776724',
'AK48777117',
'AK48928204',
'AK48928168',
'AK49147611',
'AK49147762',
'AK49309554',
'AK48928181',
'AK48878339',
'AK48966998',
'AK48061103',
'AK48564307',
'AK49293942',
'AK48967086',
'AK48967093',
'AK48803603',
'AK48734561',
'AK49313995',
'AK49150367',
'AK49293946',
'AK49075674',
'AK48418538',
'AK48582506',
'AK48582518',
'AK48770596',
'AK48801270',
'AK48770578',
'AK48860666',
'AK48979870',
'AK48995829',
'AK49071492',
'AK49076053',
'AK48797330',
'AK48797362',
'AK48797792',
'AK48797397',
'AK48572258',
'AK48717303',
'AK48825530',
'AK49049973',
'AK49049977',
'AK49082361',
'AK49162647',
'AK49224328',
'AK49245922',
'AK49466159',
'AK49686039',
'AK49582345',
'AK49067446',
'AK49067142',
'AK49313781',
'AK49107020',
'AK49106382',
'AK49105594',
'AK49106946',
'AK48705475',
'AK48791572',
'AK48703112',
'AK48404406',
'AK48437978',
'AK48455070',
'AK48455068',
'AK48518744',
'AK48571657',
'AK48602450',
'AK48602451',
'AK48602442',
'AK48602444',
'AK48618041',
'AK48632291',
'AK48632294',
'AK48658474',
'AK48658479',
'AK48658489',
'AK48745091',
'AK48745096',
'AK48820450',
'AK48820455',
'AK48936303',
'AK49006374',
'AK49006378',
'AK49049662',
'AK49049657',
'AK49137675',
'AK48551042',
'AK49115195',
'AK48716780',
'AK48716781',
'AK48820459',
'AK48992470',
'AK48571662',
'AB48917200',
'AB48911893',
'AB48918175',
'AB48913437',
'AB48915471',
'AB48916947',
'AB48916659',
'AB48915731',
'AB48917405',
'AB48913267',
'AB48914310',
'AB48913649',
'AB48913780',
'AB48911901',
'AB48913883',
'AB48915347',
'AB48912757',
'AB48914370',
'AB48914448',
'AB48914315',
'AB48912332',
'AB48913214',
'AB48912069',
'AB48911920',
'AB48913255',
'AB48914194',
'AB48912761',
'AB48917459',
'AB48917171',
'AB48915694',
'AB48917701',
'AB48911850',
'AB48916691',
'AB48911858',
'AB48916170',
'AB48916105',
'AB48916047',
'AB48913392',
'AB48912958',
'AB48916707',
'AB48917512',
'AB48915166',
'AB48915634',
'AB48915871',
'AB48915947',
'AB48917059',
'AB48915280',
'AK48951348',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20201209_1415_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
