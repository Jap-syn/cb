<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20200310_1600_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK42564000',
'AK42557000',
'AK42562100',
'AK42564200',
'AK42564300',
'AK42565300',
'AK42556400',
'AK42564500',
'AK42555500',
'AK42529500',
'AK42541600',
'AK42533600',
'AK42554600',
'AK42556700',
'AK42570800',
'AK42533800',
'AK42527800',
'AK42562900',
'AK42554900',
'AK42536900',
'AK42529010',
'AK42560210',
'AK42567210',
'AK42566310',
'AK42536510',
'AK42557610',
'AK42480910',
'AK42557910',
'AK42540020',
'AK42522120',
'AK42573120',
'AK42560220',
'AK42549220',
'AK42559420',
'AK42743520',
'AK42565520',
'AK42556820',
'AK42561130',
'AK42541230',
'AK42566230',
'AK42568330',
'AK42561430',
'AK42573430',
'AK42556430',
'AK42548430',
'AK42559630',
'AK42547830',
'AK42562930',
'AK42481040',
'AK42538240',
'AK42555340',
'AK42550440',
'AK42548640',
'AK42558640',
'AK42480940',
'AK42548940',
'AK42550050',
'AK42561050',
'AK42523050',
'AK42562250',
'AK42529650',
'AK42532750',
'AK42556750',
'AK42548750',
'AK42568750',
'AK42525950',
'AK42566950',
'AK42558950',
'AK42537060',
'AK42564160',
'AK42560260',
'AK42562260',
'AK42563260',
'AK42555360',
'AK42549360',
'AK42550460',
'AK42562460',
'AK42550560',
'AK42551560',
'AK42563560',
'AK42575560',
'AK42559660',
'AK42563860',
'AK42566960',
'AK42550070',
'AK42555070',
'AK42539070',
'AK42556270',
'AK42539270',
'AK42562470',
'AK42564470',
'AK42547570',
'AK42561670',
'AK42559670',
'AK42524970',
'AK42539970',
'AK42530080',
'AK42537080',
'AK42550180',
'AK42559180',
'AK42572380',
'AK42547580',
'AK42561680',
'AK42565680',
'AK42567680',
'AK42530780',
'AK42536880',
'AK42567880',
'AK42566090',
'AK42524290',
'AK42559290',
'AK42555390',
'AK42556390',
'AK42567390',
'AK42555490',
'AK42559490',
'AK42528590',
'AK42562690',
'AK42538690',
'AK42569690',
'AK41772790',
'AK42561890',
'AK42562890',
'AK42547890',
'AK42554990',
'AK42557990',
'AK42560001',
'AK42549001',
'AK42564201',
'AK42536201',
'AK42558201',
'AK42573301',
'AK42554301',
'AK42574301',
'AK42566301',
'AK42559601',
'AK42550701',
'AK42547801',
'AK42550011',
'AK42563011',
'AK42567011',
'AK42568011',
'AK42524211',
'AK42537411',
'AK42548411',
'AK42562511',
'AK42554511',
'AK42535611',
'AK42572711',
'AK42533711',
'AK42563121',
'AK42744121',
'AK42565121',
'AK42527121',
'AK42558121',
'AK42539121',
'AK42565521',
'AK42539621',
'AK42559621',
'AK42569621',
'AK42554721',
'AK42538721',
'AK42533821',
'AK42743821',
'AK42554821',
'AK41767821',
'AK42548921',
'AK42563131',
'AK42558131',
'AK42548231',
'AK42569231',
'AK42533331',
'AK42556431',
'AK42528431',
'AK42558431',
'AK42539431',
'AK42569431',
'AK42524631',
'AK42534631',
'AK42562731',
'AK42524731',
'AK42562831',
'AK42548931',
'AK42553141',
'AK42549141',
'AK42536241',
'AK42557241',
'AK42533341',
'AK42555441',
'AK42556441',
'AK42528441',
'AK42550541',
'AK42541541',
'AK42562541',
'AK42559541',
'AK42575741',
'AK42536741',
'AK42522941',
'AK42564941',
'AK42536151',
'AK42555251',
'AK42548251',
'AK42536351',
'AK42528351',
'AK42561451',
'AK42539551',
'AK42551651',
'AK42563651',
'AK42557651',
'AK42558651',
'AK42560751',
'AK42557751',
'AK42562951',
'AK42563951',
'AK42541161',
'AK42561161',
'AK42534161',
'AK42560261',
'AK42524361',
'AK42554461',
'AK42561661',
'AK42523661',
'AK42557661',
'AK42533861',
'AK42539861',
'AK42570961',
'AK42480961',
'AK42564961',
'AK42557961',
'AK42535071',
'AK42557071',
'AK42550171',
'AK42537171',
'AK42541271',
'AK42568271',
'AK42554371',
'AK42555371',
'AK42562471',
'AK42536471',
'AK42537671',
'AK42557671',
'AK42552771',
'AK42560871',
'AK42552971',
'AK42559081',
'AK42563181',
'AK42567181',
'AK42550281',
'AK42536381',
'AK42537481',
'AK42569481',
'AK42525581',
'AK42555581',
'AK42527581',
'AK42563681',
'AK42564781',
'AK42568781',
'AK42560981',
'AK42563981',
'AK42550091',
'AK42535091',
'AK42558091',
'AK42566191',
'AK42522291',
'AK42556291',
'AK42569391',
'AK42550491',
'AK42522491',
'AK42565591',
'AK42563002',
'AK42539002',
'AK42539102',
'AK42523202',
'AK42573202',
'AK42564202',
'AK41785302',
'AK42559402',
'AK42550502',
'AK42525502',
'AK42559502',
'AK42560602',
'AK42559602',
'AK42540702',
'AK42573802',
'AK42527902',
'AK42564012',
'AK42550112',
'AK42557212',
'AK42560312',
'AK42562512',
'AK42556612',
'AK42559612',
'AK42551712',
'AK42564812',
'AK42525812',
'AK42535812',
'AK42556812',
'AK42539812',
'AK42540022',
'AK42548122',
'AK42537522',
'AK42555622',
'AK42549032',
'AK42555332',
'AK42536432',
'AK42539432',
'AK42550532',
'AK42564532',
'AK42559632',
'AK42564932',
'AK42536932',
'AK42541142',
'AK42562242',
'AK42535442',
'AK42561642',
'AK42559642',
'AK42559742',
'AK42541052',
'AK42535052',
'AK42551152',
'AK42574152',
'AK42560252',
'AK42529252',
'AK42527452',
'AK42572552',
'AK42523552',
'AK42539652',
'AK42559652',
'AK42532752',
'AK42554952',
'AK42528952',
'AK42553062',
'AK42525062',
'AK42533262',
'AK42557262',
'AK42570562',
'AK42522562',
'AK42559662',
'AK42550762',
'AK42559762',
'AK42541862',
'AK42564862',
'AK42536862',
'AK42557862',
'AK41779862',
'AK42563172',
'AK42558172',
'AK42562272',
'AK42557272',
'AK42563372',
'AK42562472',
'AK42555572',
'AK42557672',
'AK42530772',
'AK42551772',
'AK42535772',
'AK42561872',
'AK42562872',
'AK42564872',
'AK42549872',
'AK42535972',
'AK42537972',
'AK42562082',
'AK42556082',
'AK42541182',
'AK42562482',
'AK42567582',
'AK42561782',
'AK42556782',
'AK42536882',
'AK42480982',
'AK42564982',
'AK42536982',
'AK42562092',
'AK42570192',
'AK42564192',
'AK42568192',
'AK42522392',
'AK42565392',
'AK42528392',
'AK42564492',
'AK42564692',
'AK42550792',
'AK42564792',
'AK42541892',
'AK42562892',
'AK42555892',
'AK42536892',
'AK42567892',
'AK42539892',
'AK42560992',
'AK42480992',
'AK42556992',
'AK42537992',
'AK42538303',
'AK42555403',
'AK42537403',
'AK42564603',
'AK42565703',
'AK42560803',
'AK42555803',
'AK42565803',
'AK42549803',
'AK42547903',
'AK42540013',
'AK42541013',
'AK42558113',
'AK42550213',
'AK42560313',
'AK42559313',
'AK42550413',
'AK42554513',
'AK42540713',
'AK42547713',
'AK42562913',
'AK42744023',
'AK42562123',
'AK42541223',
'AK42552223',
'AK42562323',
'AK42566323',
'AK42558523',
'AK42561723',
'AK42554723',
'AK42565723',
'AK42538723',
'AK42536823',
'AK42551923',
'AK42562033',
'AK42538033',
'AK42539133',
'AK42535333',
'AK42565333',
'AK42539333',
'AK42564633',
'AK42532733',
'AK42524833',
'AK42554933',
'AK42527043',
'AK42568043',
'AK42571143',
'AK42563243',
'AK42556243',
'AK42536343',
'AK42557343',
'AK42558343',
'AK42523543',
'AK42554543',
'AK42526543',
'AK42561643',
'AK42554743',
'AK42576743',
'AK42566153',
'AK42541253',
'AK42562253',
'AK42523253',
'AK42563253',
'AK42550353',
'AK42528453',
'AK42548453',
'AK42561653',
'AK42559653',
'AK42569653',
'AK42541753',
'AK41802753',
'AK42559753',
'AK42562853',
'AK42566853',
'AK42567853',
'AK42548853',
'AK42529953',
'AK42524263',
'AK42535263',
'AK42540363',
'AK42573463',
'AK42527463',
'AK42541563',
'AK42547563',
'AK42564763',
'AK42541863',
'AK42535863',
'AK42534963',
'AK42564963',
'AK42567273',
'AK42566473',
'AK42539673',
'AK42550773',
'AK42522873',
'AK42534973',
'AK42557973',
'AK42569973',
'AK42566283',
'AK42541583',
'AK42561783',
'AK42527783',
'AK42557783',
'AK42564983',
'AK42566983',
'AK42539093',
'AK42549093',
'AK42555393',
'AK42562493',
'AK42539493',
'AK42558793',
'AK42572893',
'AK42555893',
'AK42571993',
'AK42564993',
'AK42531004',
'AK42566004',
'AK42549104',
'AK42568204',
'AK42576304',
'AK42562504',
'AK42554504',
'AK42526504',
'AK42548604',
'AK42536704',
'AK42560804',
'AK42550904',
'AK42480904',
'AK42559904',
'AK42531014',
'AK42537014',
'AK42522114',
'AK42562114',
'AK42572214',
'AK42536314',
'AK42549614',
'AK42561714',
'AK42564714',
'AK42557714',
'AK42568714',
'AK42562914',
'AK42525914',
'AK42558024',
'AK42527124',
'AK42558124',
'AK42564224',
'AK42539324',
'AK42550424',
'AK42562924',
'AK42563924',
'AK42573924',
'AK42539924',
'AK42571134',
'AK42557134',
'AK42549134',
'AK42562234',
'AK42564234',
'AK42561334',
'AK42563834',
'AK42554834',
'AK42539934',
'AK42531044',
'AK42537044',
'AK42556244',
'AK42566444',
'AK42528444',
'AK42558444',
'AK42530544',
'AK42550544',
'AK42566544',
'AK42558544',
'AK42550644',
'AK42561644',
'AK42524644',
'AK42565644',
'AK42529644',
'AK42541744',
'AK42539844',
'AK42549844',
'AK42564944',
'AK42540154',
'AK42535154',
'AK42565154',
'AK42539154',
'AK42572254',
'AK42572654',
'AK42564654',
'AK42562854',
'AK42537954',
'AK42539954',
'AK42552064',
'AK42526064',
'AK42540164',
'AK42562164',
'AK42539164',
'AK42561264',
'AK42555264',
'AK42531364',
'AK42528464',
'AK42561564',
'AK42555564',
'AK42564664',
'AK42560764',
'AK42533764',
'AK42550864',
'AK42523864',
'AK42561964',
'AK42571964',
'AK42535964',
'AK42539964',
'AK42644074',
'AK42537074',
'AK42558174',
'AK42565374',
'AK42550474',
'AK42562474',
'AK42540574',
'AK42540774',
'AK42524774',
'AK42537774',
'AK42562874',
'AK42557874',
'AK42525974',
'AK42555974',
'AK42541184',
'AK42566184',
'AK42560284',
'AK42533284',
'AK42534284',
'AK42537284',
'AK42562384',
'AK42536484',
'AK42528484',
'AK42550584',
'AK42563584',
'AK42549584',
'AK42523784',
'AK42548884',
'AK42564984',
'AK42549984',
'AK42541094',
'AK42537094',
'AK42560194',
'AK42562194',
'AK42537194',
'AK42557194',
'AK42562294',
'AK42565294',
'AK42556294',
'AK42560394',
'AK42570394',
'AK42564394',
'AK42537394',
'AK42563594',
'AK42536794',
'AK42559794',
'AK42480894',
'AK42541894',
'AK42556994',
'AK42547994',
'AK42548994',
'AK42562105',
'AK42539105',
'AK42574205',
'AK42577205',
'AK42559305',
'AK42564505',
'AK42525505',
'AK42563605',
'AK42559605',
'AK42564705',
'AK42525705',
'AK42549805',
'AK42562905',
'AK42564905',
'AK42536905',
'AK42527905',
'AK42555115',
'AK42567115',
'AK42563215',
'AK42550315',
'AK42561415',
'AK42536415',
'AK42527515',
'AK42559615',
'AK42551715',
'AK42529815',
'AK42540915',
'AK42564915',
'AK42566915',
'AK42557915',
'AK42549915',
'AK42553025',
'AK42565025',
'AK42562125',
'AK42572125',
'AK42563125',
'AK42539125',
'AK42562225',
'AK42565325',
'AK42562425',
'AK42528425',
'AK42564525',
'AK42549625',
'AK42563725',
'AK42534825',
'AK42536825',
'AK42539825',
'AK42562925',
'AK42564925',
'AK42540035',
'AK42573035',
'AK42565035',
'AK42526035',
'AK42557035',
'AK42566335',
'AK42550435',
'AK42556435',
'AK42560535',
'AK42576535',
'AK42529535',
'AK42550635',
'AK42554635',
'AK42559635',
'AK42540835',
'AK42549835',
'AK42551935',
'AK42564935',
'AK42549935',
'AK42538045',
'AK42555145',
'AK42566145',
'AK42541245',
'AK42549245',
'AK42535945',
'AK42577945',
'AK42536055',
'AK42541555',
'AK42548555',
'AK42538655',
'AK42541755',
'AK42571855',
'AK42554855',
'AK42552955',
'AK42537065',
'AK42533165',
'AK42558165',
'AK42562265',
'AK42550365',
'AK42564465',
'AK42566465',
'AK42560765',
'AK42535865',
'AK42480965',
'AK42556965',
'AK42541075',
'AK42563075',
'AK42534075',
'AK42548075',
'AK42549075',
'AK42536175',
'AK42537175',
'AK42557275',
'AK42537375',
'AK42550475',
'AK42550575',
'AK42554575',
'AK42524675',
'AK42538675',
'AK42533975',
'AK42557085',
'AK42555185',
'AK42561385',
'AK42563385',
'AK42530585',
'AK42538685',
'AK42570785',
'AK42522785',
'AK42531885',
'AK42548885',
'AK42566985',
'AK42525095',
'AK42558095',
'AK42539095',
'AK42549095',
'AK42563295',
'AK42559295',
'AK42564395',
'AK42550495',
'AK42562495',
'AK42550595',
'AK42554695',
'AK42564695',
'AK42536695',
'AK42539795',
'AK42541895',
'AK42554895',
'AK42548895',
'AK42563995',
'AK42564995',
'AK42548995',
'AK42562006',
'AK42558006',
'AK42571106',
'AK42562106',
'AK42539106',
'AK42523206',
'AK42555206',
'AK42560506',
'AK42551506',
'AK42571506',
'AK42554606',
'AK42566606',
'AK42540806',
'AK42555806',
'AK42547906',
'AK42560016',
'AK42571016',
'AK42567016',
'AK42538016',
'AK42549016',
'AK42550116',
'AK42560216',
'AK42541216',
'AK42524216',
'AK42526216',
'AK42538216',
'AK42529316',
'AK42561416',
'AK42555416',
'AK42556416',
'AK42527416',
'AK42529416',
'AK42548516',
'AK42559516',
'AK42541616',
'AK42551616',
'AK42567816',
'AK42562916',
'AK42535916',
'AK42565916',
'AK42536026',
'AK42566026',
'AK42560126',
'AK42524326',
'AK42555426',
'AK42537426',
'AK42528426',
'AK42558426',
'AK42550526',
'AK42539526',
'AK42564926',
'AK42562036',
'AK42566036',
'AK42549036',
'AK42531136',
'AK42575136',
'AK42559236',
'AK42541336',
'AK42561336',
'AK42568336',
'AK42560536',
'AK42564536',
'AK42557536',
'AK42564636',
'AK42557636',
'AK42556936',
'AK42577936',
'AK42744046',
'AK42560246',
'AK42562446',
'AK42550546',
'AK42541646',
'AK42569746',
'AK42539846',
'AK42561946',
'AK42549946',
'AK42562256',
'AK42563256',
'AK42557256',
'AK42572356',
'AK42570556',
'AK42538656',
'AK42561856',
'AK42548856',
'AK42561956',
'AK42563956',
'AK42547956',
'AK42531066',
'AK42541066',
'AK42563066',
'AK42744066',
'AK42558166',
'AK42533366',
'AK42555366',
'AK42535466',
'AK42556466',
'AK42567466',
'AK42569666',
'AK42558766',
'AK42569966',
'AK42526076',
'AK42537076',
'AK42534176',
'AK42563276',
'AK42558276',
'AK42560376',
'AK42541376',
'AK42561376',
'AK42522376',
'AK42565376',
'AK42547476',
'AK42529476',
'AK42550576',
'AK42564576',
'AK42539576',
'AK42541676',
'AK42571676',
'AK42556876',
'AK42564976',
'AK42562286',
'AK42541386',
'AK42551386',
'AK42556386',
'AK42550486',
'AK42561786',
'AK42560886',
'AK42551886',
'AK42536986',
'AK42563096',
'AK42535096',
'AK42564196',
'AK42541296',
'AK42534396',
'AK42550496',
'AK42560496',
'AK42574496',
'AK42564596',
'AK42570696',
'AK42556696',
'AK42541796',
'AK42562896',
'AK42539896',
'AK42558996',
'AK42565007',
'AK42531107',
'AK42557107',
'AK42541207',
'AK42561307',
'AK42552307',
'AK42566307',
'AK42537307',
'AK42561407',
'AK42549407',
'AK42550507',
'AK42562507',
'AK42554607',
'AK42559607',
'AK42557807',
'AK42522907',
'AK42541017',
'AK42568017',
'AK42552117',
'AK42563117',
'AK42558217',
'AK42550417',
'AK42534517',
'AK42529517',
'AK42559517',
'AK42534617',
'AK42565717',
'AK42562917',
'AK42743917',
'AK42558027',
'AK42560327',
'AK42556427',
'AK42562527',
'AK42556527',
'AK42538627',
'AK42559627',
'AK42559727',
'AK42571827',
'AK42522827',
'AK42523827',
'AK42552927',
'AK42558927',
'AK42481037',
'AK42570137',
'AK42564137',
'AK42539137',
'AK42560237',
'AK42572337',
'AK42556437',
'AK42567437',
'AK42560637',
'AK42560737',
'AK42575737',
'AK42528837',
'AK42541937',
'AK42552937',
'AK42548047',
'AK42562147',
'AK42533247',
'AK42557247',
'AK42566347',
'AK42549347',
'AK42550447',
'AK42528447',
'AK42555547',
'AK42568547',
'AK42560647',
'AK42555647',
'AK42562747',
'AK42532947',
'AK42562947',
'AK42528057',
'AK42548057',
'AK42540157',
'AK42562257',
'AK42539257',
'AK42551357',
'AK42530457',
'AK42550457',
'AK42554457',
'AK42528457',
'AK42559557',
'AK42550657',
'AK42551857',
'AK42557857',
'AK41758857',
'AK42573957',
'AK42535067',
'AK42541167',
'AK42535167',
'AK42565167',
'AK42540267',
'AK42562267',
'AK42523267',
'AK42563267',
'AK42565367',
'AK42562467',
'AK42564467',
'AK42555567',
'AK42530667',
'AK42559667',
'AK42530967',
'AK42568967',
'AK42550077',
'AK42564077',
'AK42552177',
'AK42572277',
'AK42536277',
'AK42534377',
'AK42564377',
'AK42550477',
'AK41792577',
'AK42557677',
'AK42568677',
'AK42527777',
'AK42538877',
'AK42549877',
'AK42561977',
'AK42522087',
'AK42563187',
'AK42535187',
'AK42562287',
'AK42560387',
'AK42556387',
'AK42566587',
'AK42538687',
'AK42565787',
'AK42480887',
'AK42548887',
'AK42559987',
'AK42548097',
'AK42541197',
'AK42541297',
'AK42564697',
'AK42557897',
'AK42537997',
'AK42549008',
'AK42527108',
'AK42564208',
'AK42561408',
'AK42538708',
'AK42532808',
'AK42480908',
'AK42531908',
'AK42564018',
'AK42557218',
'AK42539218',
'AK42541318',
'AK42559318',
'AK42556418',
'AK42549418',
'AK42548618',
'AK42532718',
'AK42573718',
'AK42567918',
'AK42538028',
'AK42549128',
'AK42523228',
'AK42562428',
'AK42534428',
'AK42556428',
'AK42559428',
'AK42550628',
'AK42557628',
'AK42559628',
'AK42536728',
'AK42558828',
'AK42480928',
'AK42562928',
'AK42563238',
'AK42565338',
'AK42567438',
'AK41788438',
'AK42562738',
'AK42525738',
'AK42563938',
'AK42531048',
'AK42541048',
'AK42558148',
'AK42560248',
'AK42532248',
'AK42534248',
'AK42566248',
'AK42553348',
'AK42537448',
'AK42525548',
'AK42566548',
'AK42528548',
'AK42529548',
'AK42559548',
'AK42566648',
'AK42553748',
'AK42528748',
'AK42559748',
'AK42556848',
'AK42547948',
'AK42549948',
'AK42571158',
'AK42562258',
'AK42563258',
'AK42525358',
'AK42549358',
'AK42563558',
'AK42548758',
'AK42530958',
'AK42536958',
'AK42534068',
'AK42538068',
'AK42562268',
'AK41780468',
'AK42562468',
'AK42530568',
'AK42541568',
'AK42548568',
'AK42526768',
'AK42555078',
'AK42567078',
'AK42523178',
'AK42563178',
'AK42557178',
'AK42555378',
'AK42555578',
'AK42561678',
'AK42554678',
'AK42522878',
'AK42537978',
'AK42563088',
'AK42535088',
'AK42560288',
'AK42523588',
'AK42534588',
'AK42565688',
'AK41807688',
'AK42557688',
'AK42554988',
'AK42566098',
'AK42529098',
'AK42555198',
'AK42577198',
'AK42561398',
'AK42563398',
'AK42536398',
'AK42550498',
'AK42566498',
'AK42525598',
'AK42538698',
'AK42527898',
'AK42554998',
'AK42539009',
'AK42481109',
'AK42535109',
'AK42537209',
'AK42525409',
'AK42570709',
'AK42538709',
'AK42531809',
'AK42552809',
'AK42525809',
'AK42536809',
'AK42547809',
'AK42552909',
'AK42539909',
'AK42567019',
'AK42541119',
'AK42565119',
'AK42550319',
'AK42541319',
'AK42562319',
'AK42560519',
'AK42480819',
'AK42548819',
'AK42480919',
'AK42536919',
'AK42531029',
'AK42555029',
'AK42541429',
'AK42552429',
'AK42561529',
'AK42557629',
'AK42565729',
'AK42566729',
'AK42577729',
'AK42480829',
'AK42565829',
'AK42526039',
'AK42537139',
'AK42567139',
'AK42539139',
'AK42531439',
'AK42554439',
'AK42555439',
'AK42555539',
'AK42565539',
'AK42560639',
'AK42570639',
'AK42522739',
'AK42540839',
'AK42551839',
'AK42564939',
'AK42541249',
'AK42567249',
'AK42568249',
'AK42555349',
'AK42540449',
'AK42561449',
'AK42529449',
'AK42539449',
'AK42553549',
'AK42565549',
'AK42567649',
'AK42540749',
'AK42562749',
'AK42554749',
'AK42568849',
'AK42539949',
'AK42539159',
'AK42541259',
'AK42556259',
'AK42548259',
'AK42563359',
'AK42550459',
'AK42524459',
'AK42538459',
'AK42559459',
'AK42558559',
'AK42538659',
'AK42559659',
'AK42528759',
'AK42480859',
'AK42548959',
'AK42549069',
'AK42539269',
'AK42529369',
'AK42549469',
'AK42560569',
'AK42548569',
'AK42564669',
'AK42524769',
'AK42563869',
'AK42536869',
'AK42539869',
'AK42559869',
'AK42541079',
'AK42567079',
'AK42564179',
'AK42558179',
'AK42550379',
'AK42524379',
'AK42558779',
'AK42556879',
'AK42537089',
'AK42558089',
'AK42565289',
'AK42536389',
'AK42556389',
'AK42528489',
'AK42539489',
'AK42551689',
'AK42562889',
'AK42555889',
'AK42549099',
'AK42541199',
'AK42566199',
'AK42538199',
'AK42535299',
'AK42565299',
'AK42556399',
'AK42530499',
'AK42550599',
'AK42559599',
'AK42554799',
'AK42537799',
'AK42539899',
'AK42548999',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20200310_1600_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();
