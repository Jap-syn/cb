<?php
chdir(dirname(__DIR__));

// Setup autoloading
require 'init_autoloader.php';

setlocale( LC_ALL, 'ja_JP.UTF-8' );
ini_set( 'default_charset', 'UTF-8' );
mb_internal_encoding( 'UTF-8' );
mb_http_output('UTF-8');
mb_regex_encoding( 'UTF-8' );

ini_set( 'max_execution_time', 0 );


use Coral\Base\Application\BaseApplicationAbstract;
use Coral\Base\BaseLog;
use Zend\Db\Adapter\Adapter;
use Zend\Config\Reader\Ini;
use models\Table\TableUser;
use models\Logic\LogicCancel;
use models\Logic\OrderCancelException;


/**
 * アプリケーションクラスです。
 *
 */
class Application extends BaseApplicationAbstract {
    protected $_application_id = 'tools-CancelRegister-batch';

    /**
     * Application の唯一のインスタンスを取得します。
     *
     * @static
     * @access public
     * @return Application
     */
    public static function getInstance() {
        if( self::$_instance === null ) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }

    /**
     * Application の新しいインスタンスを初期化します。
     *
     * @ignore
     * @access private
     */
    private function __construct() {
        parent::init();
    }

    /**
     * @var Adapter
     */
    public $dbAdapter;

    /**
     * @var BaseLog
     */
    public $logger;


    /**
     * アプリケーションを実行します。
     *
     * @access public
     */
    public function run() {
        $exitCode = 1;

        try {

            // 実行確認
            echo "Run the Cancel batch. Is it OK?(Y/N)";
            $yn = trim(fgets(STDIN));
            if (strtoupper($yn) != 'Y') {
                echo "It has stopped the execution. ";
                exit(0);
            }

            // iniファイルから設定を取得
            $configPath = __DIR__ . '/../module/cbadmin/config/config.ini';

            // データベースアダプタをiniファイルから初期化します
            $data = array();
            if (file_exists($configPath))
            {
                $reader = new Ini();
                $data = $reader->fromFile($configPath);
            }
            $this->dbAdapter = new Adapter($data['database']);

            // ログ設定の読み込み
            $logConfig = $data['log'];
            // 標準ログクラス初期化
            $this->logger = BaseLog::createFromArray( $logConfig );
$this->logger->info('_data_patch_20210225_1130_CancelRegister.php start');

            $globalConfig = include __DIR__ . '/../config/autoload/global.php';
            // 接続時間を設定する
            $rds_session_timezone = $globalConfig['RDS_SESSION_TIMEZONE'];
            if (isset($rds_session_timezone)) {
                $this->dbAdapter->query('SET SESSION time_zone = :time_zone')->execute(array(':time_zone'=>$rds_session_timezone));
            }

            // 設定をシステムプロパティテーブルから読み込み
            $apinfo = $this->getApplicationiInfo($this->dbAdapter, 'cbadmin');
            // iniファイルの内容をマージ
            $data = array_merge($data, $apinfo);

            // ユーザーID取得
            $mdlu = new TableUser($this->dbAdapter);
            $userId = $mdlu->getUserId(TableUser::USERCLASS_SYSTEM, TableUser::SEQ_BATCH_USER);

            $this->dbAdapter->getDriver()->getConnection()->beginTransaction();


            // ------------------------------------------------------------------------->
            // 対象の定義
            $target = array(
'AK47961222',
'AK48822541',
'AK49607647',
'AK50349020',
'AK50371330',
'AK50377689',
'AK50382172',
'AK50384710',
'AK50388104',
'AK50394484',
'AK50396865',
'AK51073810',
'AK51073817',
'AK51074007',
'AK51205144',
'AK51205197',
'AK51205219',
'AK51205534',
'AK51205545',
'AK51205573',
'AK51205845',
'AK51205885',
'AK51205888',
'AK51206125',
'AK51206126',
'AK51206168',
'AK51206233',
'AK51206266',
'AK51206397',
'AK51206429',
'AK51206472',
'AK51206966',
'AK51207092',
'AK51207160',
'AK51207251',
'AK51207601',
'AK51207663',
'AK51207685',
'AK51207725',
'AK51207983',
'AK51208111',
'AK51208129',
'AK51208411',
'AK51208461',
'AK51208462',
'AK51208631',
'AK51208655',
'AK51208710',
'AK51208844',
'AK51208949',
'AK51208962',
'AK51209124',
'AK51209144',
'AK51209188',
'AK51209229',
'AK51209241',
'AK51209276',
'AK51209384',
'AK51209409',
'AK51209423',
'AK51209552',
'AK51209620',
'AK51209741',
'AK51210069',
'AK51210121',
'AK51210160',
'AK51210245',
'AK51210279',
'AK51210301',
'AK51210304',
'AK51210331',
'AK51210340',
'AK51210462',
'AK51210466',
'AK51210497',
'AK51210541',
'AK51210544',
'AK51210666',
'AK51210813',
'AK51210877',
'AK51211083',
'AK51211120',
'AK51211185',
'AK51211223',
'AK51211499',
'AK51211581',
'AK51211590',
'AK51211596',
'AK51211793',
'AK51211900',
'AK51212179',
'AK51212359',
'AK51212422',
'AK51212569',
'AK51212605',
'AK51212715',
'AK51212756',
'AK51212785',
'AK51212837',
'AK51212967',
'AK51212979',
'AK51213010',
'AK51213127',
'AK51213131',
'AK51213150',
'AK51213327',
'AK51213328',
'AK51213507',
'AK51213530',
'AK51213590',
'AK51213638',
'AK51213852',
'AK51214087',
'AK51214246',
'AK51214263',
'AK51214297',
'AK51214358',
'AK51214462',
'AK51214528',
'AK51214587',
'AK51214724',
'AK51214771',
'AK51214792',
'AK51214832',
'AK51215143',
'AK51215351',
'AK51215508',
'AK51215627',
'AK51215743',
'AK51215779',
'AK51215819',
'AK51215891',
'AK51215950',
'AK51215974',
'AK51216167',
'AK51216211',
'AK51216573',
'AK51216727',
'AK51216916',
'AK51216985',
'AK51217085',
'AK51217125',
'AK51217160',
'AK51217263',
'AK51217352',
'AK51217361',
'AK51217380',
'AK51217496',
'AK51217501',
'AK51217519',
'AK51217520',
'AK51217522',
'AK51217533',
'AK51217588',
'AK51217703',
'AK51217718',
'AK51217761',
'AK51217859',
'AK51217861',
'AK51217918',
'AK51217947',
'AK51218101',
'AK51218118',
'AK51218211',
'AK51218283',
'AK51218379',
'AK51218486',
'AK51218493',
'AK51218541',
'AK51218760',
'AK51218766',
'AK51218798',
'AK51218833',
'AK51218976',
'AK51219116',
'AK51219216',
'AK51219361',
'AK51219380',
'AK51219424',
'AK51219478',
'AK51219566',
'AK51219612',
'AK51219615',
'AK51219622',
'AK51219642',
'AK51219771',
'AK51219808',
'AK51219949',
'AK51220048',
'AK51220059',
'AK51220060',
'AK51220311',
'AK51220317',
'AK51220404',
'AK51220867',
'AK51220945',
'AK51221050',
'AK51221052',
'AK51221068',
'AK51221094',
'AK51221138',
'AK51221222',
'AK51221230',
'AK51221243',
'AK51221411',
'AK51221530',
'AK51221690',
'AK51221693',
'AK51221712',
'AK51221957',
'AK51222202',
'AK51222247',
'AK51222432',
'AK51222443',
'AK51222444',
'AK51222525',
'AK51222536',
'AK51222563',
'AK51222621',
'AK51222642',
'AK51222656',
'AK51222658',
'AK51222715',
'AK51222734',
'AK51222738',
'AK51222827',
'AK51222871',
'AK51222958',
'AK51223006',
'AK51223007',
'AK51223112',
'AK51223113',
'AK51223170',
'AK51223358',
'AK51223398',
'AK51223424',
'AK51223425',
'AK51223455',
'AK51223583',
'AK51223747',
'AK51223806',
'AK51223815',
'AK51223867',
'AK51223877',
'AK51223935',
'AK51223976',
'AK51224040',
'AK51224101',
'AK51224197',
'AK51224253',
'AK51224259',
'AK51224315',
'AK51224380',
'AK51224484',
'AK51224500',
'AK51224567',
'AK51224591',
'AK51224598',
'AK51224631',
'AK51224730',
'AK51224734',
'AK51224740',
'AK51224779',
'AK51224858',
'AK51225264',
'AK51225296',
'AK51225365',
'AK51225438',
'AK51225491',
'AK51225504',
'AK51225546',
'AK51225570',
'AK51225668',
'AK51225766',
'AK51225768',
'AK51225782',
'AK51225835',
'AK51225911',
'AK51225954',
'AK51225997',
'AK51226147',
'AK51226219',
'AK51226287',
'AK51226341',
'AK51226345',
'AK51226351',
'AK51226360',
'AK51226429',
'AK51226453',
'AK51226485',
'AK51226550',
'AK51226702',
'AK51226789',
'AK51226899',
'AK51226946',
'AK51226976',
'AK51226978',
'AK51227052',
'AK51227066',
'AK51227133',
'AK51227235',
'AK51227261',
'AK51227281',
'AK51227352',
'AK51227362',
'AK51227380',
'AK51227417',
'AK51227449',
'AK51227480',
'AK51227489',
'AK51227528',
'AK51227559',
'AK51227561',
'AK51227569',
'AK51227599',
'AK51227627',
'AK51227675',
'AK51227711',
'AK51227824',
'AK51227915',
'AK51227926',
'AK51227970',
'AK51227982',
'AK51228253',
'AK51228260',
'AK51228342',
'AK51228496',
'AK51228497',
'AK51228521',
'AK51228543',
'AK51228549',
'AK51228555',
'AK51228610',
'AK51228669',
'AK51228685',
'AK51228701',
'AK51228753',
'AK51228772',
'AK51228785',
'AK51228804',
'AK51228806',
'AK51228823',
'AK51228860',
'AK51228880',
'AK51228919',
'AK51228940',
'AK51228996',
'AK51229027',
'AK51229036',
'AK51229125',
'AK51229131',
'AK51229139',
'AK51229168',
'AK51229172',
'AK51229182',
'AK51229192',
'AK51229194',
'AK51229199',
'AK51229208',
'AK51229240',
'AK51229249',
'AK51229276',
'AK51229436',
'AK51229527',
'AK51229575',
'AK51229755',
'AK51229946',
'AK51229955',
'AK51229997',
'AK51229998',
'AK51230007',
'AK51230017',
'AK51230038',
'AK51230105',
'AK51230110',
'AK51230209',
'AK51230265',
'AK51230348',
'AK51230365',
'AK51230397',
'AK51230460',
'AK51230481',
'AK51230497',
'AK51230505',
'AK51230564',
'AK51230590',
'AK51230638',
'AK51230776',
'AK51230790',
'AK51230897',
'AK51230935',
'AK51230988',
'AK51230990',
'AK51231219',
'AK51231222',
'AK51231237',
'AK51231248',
'AK51231343',
'AK51231401',
'AK51231499',
'AK51231582',
'AK51231592',
'AK51231613',
'AK51231661',
'AK51231720',
'AK51231750',
'AK51231834',
'AK51231973',
'AK51232002',
'AK51232057',
'AK51232069',
'AK51232096',
'AK51232133',
'AK51232182',
'AK51232217',
'AK51232257',
'AK51232383',
'AK51232399',
'AK51232427',
'AK51232435',
'AK51232454',
'AK51232457',
'AK51232467',
'AK51232536',
'AK51232565',
'AK51232571',
'AK51232618',
'AK51232648',
'AK51232696',
'AK51232714',
'AK51232790',
'AK51232792',
'AK51232886',
'AK51233068',
'AK51233116',
'AK51233123',
'AK51233148',
'AK51233167',
'AK51233169',
'AK51233274',
'AK51233304',
'AK51233340',
'AK51233358',
'AK51233589',
'AK51233592',
'AK51233725',
'AK51233739',
'AK51233856',
'AK51233865',
'AK51233887',
'AK51233896',
'AK51234046',
'AK51234144',
'AK51234179',
'AK51234189',
'AK51234320',
'AK51234405',
'AK51234439',
'AK51234463',
'AK51234571',
'AK51234632',
'AK51234685',
'AK51234743',
'AK51234858',
'AK51234867',
'AK51234871',
'AK51234932',
'AK51234991',
'AK51234996',
'AK51235011',
'AK51235067',
'AK51235082',
'AK51235101',
'AK51235152',
'AK51235167',
'AK51235225',
'AK51235236',
'AK51235240',
'AK51235352',
'AK51235362',
'AK51235464',
'AK51235477',
'AK51235608',
'AK51235619',
'AK51235655',
'AK51235656',
'AK51235667',
'AK51236021',
'AK51236107',
'AK51236116',
'AK51236177',
'AK51236218',
'AK51236234',
'AK51236279',
'AK51236307',
'AK51236341',
'AK51236342',
'AK51236349',
'AK51236362',
'AK51236469',
'AK51236515',
'AK51236554',
'AK51236561',
'AK51236584',
'AK51236636',
'AK51236664',
'AK51236689',
'AK51236789',
'AK51236806',
'AK51236820',
'AK51236887',
'AK51236892',
'AK51236895',
'AK51236979',
'AK51236995',
'AK51237029',
'AK51237047',
'AK51237059',
'AK51237063',
'AK51237089',
'AK51237124',
'AK51237126',
'AK51237127',
'AK51237157',
'AK51237415',
'AK51237453',
'AK51237524',
'AK51237694',
'AK51237731',
'AK51237827',
'AK51237863',
'AK51237912',
'AK51237914',
'AK51237996',
'AK51237997',
'AK51238111',
'AK51238116',
'AK51238143',
'AK51238146',
'AK51238148',
'AK51238175',
'AK51238179',
'AK51238186',
'AK51238228',
'AK51238233',
'AK51238280',
'AK51238284',
'AK51238285',
'AK51238293',
'AK51238309',
'AK51238316',
'AK51238369',
'AK51238393',
'AK51238600',
'AK51238611',
'AK51238684',
'AK51238724',
'AK51238736',
'AK51238918',
'AK51238929',
'AK51238949',
'AK51238953',
'AK51238963',
'AK51238975',
'AK51238986',
'AK51239008',
'AK51239146',
'AK51239166',
'AK51239179',
'AK51239218',
'AK51239237',
'AK51239312',
'AK51239320',
'AK51239322',
'AK51239451',
'AK51239522',
'AK51239567',
'AK51239614',
'AK51239629',
'AK51239773',
'AK51239836',
'AK51239870',
'AK51239873',
'AK51239911',
'AK51239986',
'AK51240042',
'AK51240062',
'AK51240163',
'AK51240250',
'AK51240278',
'AK51240307',
'AK51240338',
'AK51240366',
'AK51240368',
'AK51240396',
'AK51240457',
'AK51240480',
'AK51240482',
'AK51240517',
'AK51240560',
'AK51240590',
'AK51240737',
'AK51240778',
'AK51240783',
'AK51240836',
'AK51240869',
'AK51240885',
'AK51240918',
'AK51241177',
'AK51241178',
'AK51241232',
'AK51241235',
'AK51241240',
'AK51241284',
'AK51241333',
'AK51241471',
'AK51241478',
'AK51241556',
'AK51241665',
'AK51241674',
'AK51241714',
'AK51241725',
'AK51241749',
'AK51241925',
'AK51241971',
'AK51242078',
'AK51242129',
'AK51242157',
'AK51242185',
'AK51242338',
'AK51242384',
'AK51242426',
'AK51242437',
'AK51242473',
'AK51242515',
'AK51242528',
'AK51242554',
'AK51242557',
'AK51242559',
'AK51242579',
'AK51242581',
'AK51242583',
'AK51242719',
'AK51242742',
'AK51242784',
'AK51242886',
'AK51242893',
'AK51242932',
'AK51242942',
'AK51242974',
'AK51242984',
'AK51243008',
'AK51243135',
'AK51243210',
'AK51243257',
'AK51243320',
'AK51243360',
'AK51243379',
'AK51243418',
'AK51243479',
'AK51243480',
'AK51243488',
'AK51243496',
'AK51243515',
'AK51243533',
'AK51243552',
'AK51243564',
'AK51243566',
'AK51243567',
'AK51243574',
'AK51243578',
'AK51243584',
'AK51243596',
'AK51243613',
'AK51243616',
'AK51243625',
'AK51243646',
'AK51243655',
'AK51243662',
'AK51243682',
'AK51243689',
'AK51243699',
'AK51244014',
'AK51244037',
'AK51244044',
'AK51244163',
'AK51244225',
'AK51244248',
'AK51244261',
'AK51244299',
'AK51244326',
'AK51244345',
'AK51244540',
'AK51244582',
'AK51244613',
'AK51244747',
'AK51244908',
'AK51244914',
'AK51244945',
'AK51244959',
'AK51244962',
'AK51245185',
'AK51245221',
'AK51245224',
'AK51245349',
'AK51245364',
'AK51245526',
'AK51245576',
'AK51245579',
'AK51245583',
'AK51245642',
'AK51245666',
'AK51245692',
'AK51245722',
'AK51245815',
'AK51245820',
'AK51245886',
'AK51245906',
'AK51245930',
'AK51246062',
'AK51246107',
'AK51246168',
'AK51246286',
'AK51246357',
'AK51246467',
'AK51246513',
'AK51246530',
'AK51246549',
'AK51246575',
'AK51246708',
'AK51246796',
'AK51246872',
'AK51246887',
'AK51246939',
'AK51247084',
'AK51247124',
'AK51247257',
'AK51247385',
'AK51247445',
'AK51247523',
'AK51247541',
'AK51247597',
'AK51247655',
'AK51247689',
'AK51247736',
'AK51247794',
'AK51247804',
'AK51247829',
'AK51247866',
'AK51247940',
'AK51248041',
'AK51248208',
'AK51248260',
'AK51248345',
'AK51248411',
'AK51248454',
'AK51248455',
'AK51248502',
'AK51248516',
'AK51248538',
'AK51248664',
'AK51248667',
'AK51248850',
'AK51249036',
'AK51249076',
'AK51249078',
'AK51249166',
'AK51249268',
'AK51249336',
'AK51249355',
'AK51249362',
'AK51249812',
'AK51250062',
'AK51250078',
'AK51250151',
'AK51250162',
'AK51250177',
'AK51250284',
'AK51250295',
'AK51250351',
'AK51250412',
'AK51250413',
'AK51250443',
'AK51250463',
'AK51250497',
'AK51250503',
'AK51250513',
'AK51250606',
'AK51250618',
'AK51250877',
'AK51250883',
'AK51250897',
'AK51250960',
'AK51250974',
'AK51250977',
'AK51251060',
'AK51251064',
'AK51251418',
'AK51251453',
'AK51251466',
'AK51251561',
'AK51251620',
'AK51251626',
'AK51251634',
'AK51251784',
'AK51251913',
'AK51252005',
'AK51252063',
'AK51252137',
'AK51252170',
'AK51252186',
'AK51252290',
'AK51252332',
'AK51252339',
'AK51252399',
'AK51252425',
'AK51252469',
'AK51252473',
'AK51252506',
'AK51252540',
'AK51252683',
'AK51252799',
'AK51252883',
'AK51252892',
'AK51252894',
'AK51252899',
'AK51252980',
'AK51252992',
'AK51253086',
'AK51253114',
'AK51253224',
'AK51253230',
'AK51253272',
'AK51253315',
'AK51253322',
'AK51253344',
'AK51253363',
'AK51253371',
'AK51253372',
'AK51253375',
'AK51253381',
'AK51253383',
'AK51253409',
'AK51253434',
'AK51253497',
'AK51253508',
'AK51253555',
'AK51253657',
'AK51253764',
'AK51254063',
'AK51254132',
'AK51254206',
'AK51254460',
'AK51254550',
'AK51254551',
'AK51254749',
'AK51254787',
'AK51254848',
'AK51254893',
'AK51254895',
'AK51254911',
'AK51254913',
'AK51254958',
'AK51255052',
'AK51255150',
'AK51255226',
'AK51255242',
'AK51255260',
'AK51255273',
'AK51255277',
'AK51255327',
'AK51255341',
'AK51255369',
'AK51255428',
'AK51255437',
'AK51255466',
'AK51255469',
'AK51255594',
'AK51255627',
'AK51255632',
'AK51255647',
'AK51255730',
'AK51255756',
'AK51255786',
'AK51255839',
'AK51255918',
'AK51256112',
'AK51256157',
'AK51256196',
'AK51256221',
'AK51256244',
'AK51256288',
'AK51256383',
'AK51256555',
'AK51256626',
'AK51256761',
'AK51256861',
'AK51256937',
'AK51256943',
'AK51257098',
'AK51257130',
'AK51257219',
'AK51257228',
'AK51257294',
'AK51257295',
'AK51257317',
'AK51257323',
'AK51257341',
'AK51257345',
'AK51257380',
'AK51257409',
'AK51257415',
'AK51257435',
'AK51257442',
'AK51257461',
'AK51257464',
'AK51257488',
'AK51257489',
'AK51257518',
'AK51257527',
'AK51257541',
'AK51257593',
'AK51257620',
'AK51257639',
'AK51257656',
'AK51257721',
'AK51257955',
'AK51257982',
'AK51258042',
'AK51258228',
'AK51258248',
'AK51258249',
'AK51258305',
'AK51258423',
'AK51258461',
'AK51258489',
'AK51258582',
'AK51258597',
'AK51258639',
'AK51258765',
'AK51258774',
'AK51258813',
'AK51258842',
'AK51258848',
'AK51258857',
'AK51258858',
'AK51258890',
'AK51258896',
'AK51258980',
'AK51258996',
'AK51259040',
'AK51259053',
'AK51259079',
'AK51259124',
'AK51259280',
'AK51259367',
'AK51259368',
'AK51259445',
'AK51259451',
'AK51259452',
'AK51259516',
'AK51259571',
'AK51259576',
'AK51259598',
'AK51259656',
'AK51259659',
'AK51259707',
'AK51259768',
'AK51259827',
'AK51259852',
'AK51259931',
'AK51259938',
'AK51259951',
'AK51259953',
'AK51260004',
'AK51260015',
'AK51260062',
'AK51260063',
'AK51260296',
'AK51260330',
'AK51260378',
'AK51260574',
'AK51260670',
'AK51260680',
'AK51260713',
'AK51260723',
'AK51260746',
'AK51260748',
'AK51260940',
'AK51260970',
'AK51260994',
'AK51261069',
'AK51261088',
'AK51261136',
'AK51261174',
'AK51261227',
'AK51261265',
'AK51261409',
'AK51261600',
'AK51261607',
'AK51261611',
'AK51261620',
'AK51261622',
'AK51261690',
'AK51261713',
'AK51261942',
'AK51262197',
'AK51262236',
'AK51262255',
'AK51262286',
'AK51262313',
'AK51262395',
'AK51262594',
'AK51262621',
'AK51262684',
'AK51262751',
'AK51262785',
'AK51262803',
'AK51262899',
'AK51262954',
'AK51262958',
'AK51263204',
'AK51263346',
'AK51263400',
'AK51263466',
'AK51263514',
'AK51263626',
'AK51263632',
'AK51263641',
'AK51263690',
'AK51263839',
'AK51263847',
'AK51263853',
'AK51263899',
'AK51263908',
'AK51263961',
'AK51263965',
'AK51263983',
'AK51264173',
'AK51264297',
'AK51264315',
'AK51264335',
'AK51264366',
'AK51264386',
'AK51264443',
'AK51264446',
'AK51264586',
'AK51264588',
'AK51264726',
'AK51264732',
'AK51264752',
'AK51264757',
'AK51264778',
'AK51264786',
'AK51264882',
'AK51265086',
'AK51265115',
'AK51265181',
'AK51265285',
'AK51265337',
'AK51265452',
'AK51265492',
'AK51265525',
'AK51265566',
'AK51265567',
'AK51265609',
'AK51265637',
'AK51265665',
'AK51265710',
'AK51265818',
'AK51265908',
'AK51265992',
'AK51266077',
'AK51266080',
'AK51266108',
'AK51266175',
'AK51266227',
'AK51266234',
'AK51266580',
'AK51266680',
'AK51266704',
'AK51266812',
'AK51266954',
'AK51267113',
'AK51267243',
'AK51267324',
'AK51267329',
'AK51267348',
'AK51267384',
'AK51267459',
'AK51267655',
'AK51267723',
'AK51267800',
'AK51267851',
'AK51267892',
'AK51267924',
'AK51267965',
'AK51268057',
'AK51268063',
'AK51268182',
'AK51268195',
'AK51268247',
'AK51268358',
'AK51268406',
'AK51268466',
'AK51268574',
'AK51268619',
'AK51268761',
'AK51268807',
'AK51268810',
'AK51268833',
'AK51268873',
'AK51269213',
'AK51269285',
'AK51269313',
'AK51269573',
'AK51269583',
'AK51269630',
'AK51269743',
'AK51269774',
'AK51269902',
'AK51269912',
'AK51269927',
'AK51269972',
'AK51269983',
'AK51270105',
'AK51270110',
'AK51270162',
'AK51270227',
'AK51270393',
'AK51270394',
'AK51270520',
'AK51270534',
'AK51270612',
'AK51270614',
'AK51270619',
'AK51270745',
'AK51270845',
'AK51270896',
'AK51270979',
'AK51271004',
'AK51271012',
'AK51271038',
'AK51271053',
'AK51271388',
'AK51271400',
'AK51271616',
'AK51271645',
'AK51271690',
'AK51271692',
'AK51271774',
'AK51271779',
'AK51272087',
'AK51272288',
'AK51272359',
'AK51272369',
'AK51272650',
'AK51272671',
'AK51272689',
'AK51272690',
'AK51272723',
'AK51272793',
'AK51272940',
'AK51272974',
'AK51272993',
'AK51273032',
'AK51273060',
'AK51273109',
'AK51273139',
'AK51273217',
'AK51273332',
'AK51273541',
'AK51273626',
'AK51273731',
'AK51273866',
'AK51273901',
'AK51273903',
'AK51273931',
'AK51273992',
'AK51273995',
'AK51274246',
'AK51274501',
'AK51274581',
'AK51274596',
'AK51274674',
'AK51274741',
'AK51274943',
'AK51274966',
'AK51275103',
'AK51275106',
'AK51275633',
'AK51275770',
'AK51275781',
'AK51275965',
'AK51276029',
'AK51276250',
'AK51276316',
'AK51276320',
'AK51276450',
'AK51276598',
'AK51276632',
'AK51276753',
'AK51277489',
'AK51277492',
'AK51277599',
'AK51277613',
'AK51277676',
'AK51277681',
'AK51277716',
'AK51277815',
'AK51277929',
'AK51277932',
'AK51277989',
'AK51278035',
'AK51278041',
'AK51278059',
'AK51278116',
'AK51278129',
'AK51278344',
'AK51278411',
'AK51278506',
'AK51278721',
'AK51278723',
'AK51278743',
'AK51278769',
'AK51278876',
'AK51278913',
'AK51279012',
'AK51279048',
'AK51279168',
'AK51279170',
'AK51279234',
'AK51279374',
'AK51279469',
'AK51279477',
'AK51279508',
'AK51279565',
'AK51279766',
'AK51280026',
'AK51280055',
'AK51280260',
'AK51280520',
'AK51280597',
'AK51280681',
'AK51280765',
'AK51280975',
'AK51281128',
'AK51281328',
'AK51281387',
'AK51281406',
'AK51281755',
'AK51281887',
'AK51281938',
'AK51282040',
'AK51282174',
'AK51282422',
'AK51282458',
'AK51282496',
'AK51282573',
'AK51282580',
'AK51282625',
'AK51282686',
'AK51283065',
'AK51283075',
'AK51283100',
'AK51283435',
'AK51283634',
'AK51283648',
'AK51283794',
'AK51283862',
'AK51283927',
'AK51284106',
'AK51284120',
'AK51284214',
'AK51284417',
'AK51284509',
'AK51284593',
'AK51284631',
'AK51284733',
'AK51284845',
'AK51284972',
'AK51285057',
'AK51285240',
'AK51285370',
'AK51285518',
'AK51285590',
'AK51285627',
'AK51285862',
'AK51285885',
'AK51285960',
'AK51286193',
'AK51286252',
'AK51286698',
'AK51286740',
'AK51286762',
'AK51286947',
'AK51287258',
'AK51287395',
'AK51287603',
'AK51287672',
'AK51287937',
'AK51288275',
'AK51288340',
'AK51288382',
'AK51288676',
'AK51288716',
'AK51288785',
'AK51288864',
'AK51288964',
'AK51288969',
'AK51289256',
'AK51289275',
'AK51289340',
'AK51289349',
'AK51289368',
'AK51289666',
'AK51289807',
'AK51289824',
'AK51289903',
'AK51289909',
'AK51290030',
'AK51290056',
'AK51290290',
'AK51290328',
'AK51290487',
'AK51290608',
'AK51290883',
'AK51290900',
'AK51290933',
'AK51290997',
'AK51291338',
'AK51291559',
'AK51291661',
'AK51291677',
'AK51291773',
'AK51291863',
'AK51292006',
'AK51292123',
'AK51292167',
'AK51292422',
'AK51292457',
'AK51292566',
'AK51292615',
'AK51292626',
'AK51292640',
'AK51292834',
'AK51293193',
'AK51293374',
'AK51293522',
'AK51293539',
'AK51293583',
'AK51293748',
'AK51293891',
'AK51293958',
'AK51294245',
'AK51294870',
'AK51294963',
'AK51295051',
'AK51295296',
'AK51295510',
'AK51295795',
'AK51295902',
'AK51295918',
'AK51296132',
'AK51296369',
'AK51296836',
'AK51296890',
'AK51297334',
'AK51297697',
'AK51298451',
'AK51299705',
'AK51462602',
'AK51462667',
'AK51462678',
'AK51462708',
'AK51462757',
'AK51462856',
'AK51462888',
'AK51462909',
'AK51463142',
'AK51463434',
'AK51463515',
'AK51531074',
'AK51531085',
'AK51531087',
'AK51531101',
'AK51531111',
'AK51531146',
'AK51531188',
'AK51531276',
'AK51531293',
'AK51531294',
'AK51531308',
'AK51531328',
'AK51531348',
'AK51217914',
'AK51240732',
'AK51279413',
            );

            // キャンセル理由の定義
            $reason = '';
            $reasonCode = 8;
            // <-------------------------------------------------------------------------

            $logic = new LogicCancel($this->dbAdapter);

            // 対象データ分ループ
            foreach ($target as $orderId) {
                // $this->logger->info('[' . $orderId . '] Start ');

                // 注文SEQを特定する
                $sql = ' SELECT * FROM T_Order WHERE OrderId = :OrderId ';
                $prm = array(
                    ':OrderId' => $orderId,
                );

                $row = $this->dbAdapter->query($sql)->execute($prm)->current();

                if (!$row) {
                    // 特定できない場合はアラート出力⇒次の行へ
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] OrderId Is Not Found!!');
                    continue;
                }

                // 注文SEQ特定
                $oseq = $row['OrderSeq'];

                // キャンセル申請処理を行う
                try {
                    $logic->applies($oseq, $reason, $reasonCode, 1, false, $userId);
                    $this->logger->info('<CancelRegister> [' . $orderId . '] Complete!! ');
                } catch(OrderCancelException $oce) {
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] Order Is Not Cancel Message = ' . $oce->getMessage());
                    $this->logger->warn('<CancelRegister> [' . $orderId . '] ' . $oce->getTraceAsString());
                }

            }

            // $this->dbAdapter->getDriver()->getConnection()->rollback();
            $this->dbAdapter->getDriver()->getConnection()->commit();

            $exitCode = 0; // 正常終了
$this->logger->info('_data_patch_20210225_1130_CancelRegister.php end');

        } catch( \Exception $e ) {
            try{
                $this->dbAdapter->getDriver()->getConnection()->rollback();
            } catch ( \Exception $err) { }

            // エラーログを出力
            if ( isset($this->logger) ) {
$this->logger->err('<CancelRegister> ' . $e->getMessage());
$this->logger->err('<CancelRegister> ' . $e->getTraceAsString());
            }
        }

        // 終了コードを指定して処理終了
        exit($exitCode);

    }
}

Application::getInstance()->run();

